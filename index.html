<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°çº¢ä¹¦çŸ¥è¯†å¡ç‰‡ç¼–è¾‘å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            display: flex;
            height: 100vh;
            width: 100%;
            margin: 0;
            background: white;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
        }

        /* å·¦ä¾§è¾¹æ  */
        .sidebar {
            width: 15%;
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            border-right: 1px solid #dee2e6;
            padding: 20px;
            overflow-y: auto;
            min-width: 200px;
        }

        .sidebar h2 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 2px solid #007bff;
        }

        .template-item {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .template-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            border-color: #007bff;
        }

        .template-item.active {
            border-color: #007bff;
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
        }

        .template-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .template-desc {
            font-size: 11px;
            opacity: 0.8;
        }

        /* ä¸­é—´è¾“å…¥åŒºåŸŸ */
        .input-area {
            width: 42.5%;
            min-width: 400px;
            padding: 30px;
            background: #fafbfc;
            border-right: 1px solid #e1e4e8;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow-y: auto;
        }

        .input-header {
            margin-bottom: 25px;
        }

        .input-header h3 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 20px;
        }

        .input-header p {
            color: #7f8c8d;
            font-size: 14px;
        }

        .input-group {
            margin-bottom: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0; /* é˜²æ­¢flexé¡¹ç›®æº¢å‡º */
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .input-group textarea {
            min-height: 120px;
            resize: vertical;
            flex: 1;
            height: 100%;
        }

        /* å³ä¾§è¾“å‡ºåŒºåŸŸ */
        .output-area {
            width: 42.5%;
            background: white;
            padding: 25px;
            overflow-y: auto;
            min-width: 400px;
            max-height: 100vh;
        }

        .output-header {
            margin-bottom: 25px;
            text-align: center;
        }

        .output-header h3 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 20px;
        }

        .output-header p {
            color: #7f8c8d;
            font-size: 14px;
        }

        .card-preview {
            background: white;
            border-radius: 8px;
            padding: 20px;
            color: #333;
            min-height: 350px;
            border: 1px solid #e1e4e8;
            transition: all 0.3s ease;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 15px;
            line-height: 1.3;
        }

        .card-content {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
            white-space: pre-wrap;
        }

        .card-footer {
            border-top: 1px solid #e1e4e8;
            padding-top: 12px;
            font-size: 12px;
            color: #666;
        }

        .style-controls {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .style-controls h4 {
            margin-bottom: 12px;
            color: #495057;
            font-size: 14px;
        }



        .btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .container {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar {
                width: 100%;
                order: 2;
                min-width: auto;
            }
            
            .input-area {
                order: 1;
                height: auto;
            }
            
            .output-area {
                width: 100%;
                order: 3;
                min-width: auto;
            }
        }

        @media (max-width: 768px) {
            .container {
                margin: 0;
                box-shadow: none;
            }
            
            .sidebar,
            .input-area,
            .output-area {
                padding: 20px;
            }
            
            .sidebar {
                width: 100%;
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å·¦ä¾§è¾¹æ  -->
        <div class="sidebar">
            <!-- LogoåŒºåŸŸ -->
            <div style="text-align: center; margin-bottom: 20px; padding: 20px 15px; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <img src="logo.png" alt="Logo" style="width: 180px; height: auto; display: block; margin-left: auto; margin-right: auto;">
            </div>
            <div class="template-item active" data-template="knowledge">
                <div class="template-title">å°çº¢ä¹¦å¡ç‰‡</div>
                <div class="template-desc">ç²¾ç¾çŸ¥è¯†åˆ†äº«å¡ç‰‡</div>
            </div>
            <div class="template-item" data-template="review">
                <div class="template-title">å¥½è¯„æ–‡æ¡ˆ</div>
                <div class="template-desc">å•†å“è¯„ä»·æ–‡æ¡ˆæ¨¡æ¿</div>
            </div>
            <div class="template-item" data-template="voiceover">
                <div class="template-title">å£æ’­åŠ©æ‰‹</div>
                <div class="template-desc">çŸ­è§†é¢‘å£æ’­æ–‡æ¡ˆåˆ›ä½œ</div>
            </div>
            <div class="template-item" data-template="social">
                <div class="template-title">æœ‹å‹åœˆæ–‡æ¡ˆ</div>
                <div class="template-desc">ç¤¾äº¤åª’ä½“æ–‡æ¡ˆåˆ›ä½œ</div>
            </div>
            <div class="template-item" data-template="marketing">
                <div class="template-title">å¸‚åœºç­–åˆ’</div>
                <div class="template-desc">è¥é”€æ´»åŠ¨ç­–åˆ’æ¨¡æ¿</div>
            </div>
            <div class="template-item" data-template="video">
                <div class="template-title">çŸ­è§†é¢‘è„šæœ¬</div>
                <div class="template-desc">çŸ­è§†é¢‘å†…å®¹è„šæœ¬åˆ›ä½œ</div>
            </div>
            <div class="template-item" data-template="live">
                <div class="template-title">ç›´æ’­åŠ©æ‰‹</div>
                <div class="template-desc">ç›´æ’­è¯æœ¯å’Œæµç¨‹æ¨¡æ¿</div>
            </div>
            <div class="template-item" data-template="recruit">
                <div class="template-title">æ‹›è˜åŠ©æ‰‹</div>
                <div class="template-desc">æ‹›è˜æ–‡æ¡ˆå’ŒJDæ¨¡æ¿</div>
            </div>
            <div class="template-item" data-template="community">
                <div class="template-title">ç¤¾ç¾¤åŠ©æ‰‹</div>
                <div class="template-desc">ç¤¾ç¾¤è¿è¥æ–‡æ¡ˆå’Œæ´»åŠ¨</div>
            </div>
        </div>

        <!-- ä¸­é—´è¾“å…¥åŒºåŸŸ -->
        <div class="input-area" id="knowledgeInput">
            <div class="input-header">
                <h3>âœï¸ å†…å®¹ç¼–è¾‘</h3>
                <p>è¾“å…¥è‰ç¨¿æ–‡æ¡ˆï¼Œç‚¹å‡»AIç¼–è¾‘æŒ‰é’®ï¼ŒæŸ¥çœ‹markdownæ ¼å¼è¾“å‡º</p>
            </div>
            
            <div class="input-group">
                <label for="draftContent">è‰ç¨¿æ–‡æ¡ˆ</label>
                <textarea id="draftContent" placeholder="åœ¨è¿™é‡Œè¾“å…¥ä½ çš„è‰ç¨¿æ–‡æ¡ˆ...">ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œé€‚åˆå‡ºå»èµ°èµ°ã€‚ç”Ÿæ´»ä¸­è¦å­¦ä¼šäº«å—å½“ä¸‹ï¼Œä¸è¦æ€»æ˜¯å¿™ç¢Œè€Œå¿½ç•¥äº†èº«è¾¹çš„ç¾å¥½ã€‚</textarea>
            </div>
            
            <div style="margin: 20px 0;">
                <button class="btn" onclick="aiEditContent()">ğŸ¤– AIç¼–è¾‘</button>
                <button class="btn" onclick="clearDraft()">ğŸ—‘ï¸ æ¸…ç©ºè‰ç¨¿</button>
            </div>
            
            <div class="input-group">
                <label for="markdownOutput">Markdownè¾“å‡º</label>
                <textarea id="markdownOutput" placeholder="AIç¼–è¾‘åçš„markdownå†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
            </div>
            
            <!-- æ ‡é¢˜å’Œåº•éƒ¨ä¿¡æ¯å·²ç§»é™¤ï¼Œä»…ä¿ç•™ Markdown å†…å®¹è¾“å…¥ -->

            <!-- å¯¼å‡ºæŒ‰é’®å·²ç§»é™¤ -->
        </div>

        <!-- å¥½è¯„æ–‡æ¡ˆè¾“å…¥åŒºåŸŸ -->
        <div class="input-area" id="reviewInput" style="display: none;">
            <div class="input-header">
                <h3>â­ å¥½è¯„æ–‡æ¡ˆç¼–è¾‘</h3>
                <p>è¾“å…¥å•†å“ä¿¡æ¯å’Œä½“éªŒæ„Ÿå—ï¼Œç”Ÿæˆä¸“ä¸šçš„å¥½è¯„æ–‡æ¡ˆ</p>
            </div>
            
            <div class="input-group">
                <label for="petName">ğŸ¾ å® ç‰©åå­—</label>
                <input type="text" id="petName" placeholder="è¯·è¾“å…¥å® ç‰©çš„åå­—..." style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div class="input-group">
                <label for="serviceProject">ğŸ¥ æœåŠ¡é¡¹ç›®</label>
                <select id="serviceProject" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">è¯·é€‰æ‹©æœåŠ¡é¡¹ç›®</option>
                    <option value="vaccination">ç–«è‹—æ¥ç§</option>
                    <option value="checkup">å¥åº·ä½“æ£€</option>
                    <option value="grooming">ç¾å®¹æ´—æ¾¡</option>
                    <option value="surgery">æ‰‹æœ¯æ²»ç–—</option>
                    <option value="neutering">ç»è‚²æ‰‹æœ¯</option>
                    <option value="dental">å£è…”æŠ¤ç†</option>
                    <option value="boarding">å¯„å…»æœåŠ¡</option>
                    <option value="training">è®­ç»ƒè¯¾ç¨‹</option>
                    <option value="emergency">æ€¥è¯ŠæœåŠ¡</option>
                    <option value="other">å…¶ä»–æœåŠ¡</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="serviceExperience">ğŸ’« æœåŠ¡ä½“éªŒ</label>
                <select id="serviceExperience" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">è¯·é€‰æ‹©æœåŠ¡ä½“éªŒ</option>
                    <option value="excellent">éå¸¸æ»¡æ„ â­â­â­â­â­</option>
                    <option value="good">æ»¡æ„ â­â­â­â­</option>
                    <option value="average">ä¸€èˆ¬ â­â­â­</option>
                    <option value="poor">ä¸æ»¡æ„ â­â­</option>
                    <option value="terrible">éå¸¸ä¸æ»¡æ„ â­</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="satisfyingDetail">âœ¨ æœ€æ»¡æ„çš„æœåŠ¡ç»†èŠ‚</label>
                <select id="satisfyingDetail" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">è¯·é€‰æ‹©æœ€æ»¡æ„çš„æœåŠ¡ç»†èŠ‚</option>
                    <option value="professional">ä¸“ä¸šæŠ€æœ¯</option>
                    <option value="attitude">æœåŠ¡æ€åº¦</option>
                    <option value="environment">ç¯å¢ƒè®¾æ–½</option>
                    <option value="communication">æ²Ÿé€šäº¤æµ</option>
                    <option value="price">ä»·æ ¼æ€§ä»·æ¯”</option>
                    <option value="efficiency">æœåŠ¡æ•ˆç‡</option>
                    <option value="aftercare">æœ¯åæŠ¤ç†</option>
                    <option value="cleaning">æ¸…æ´æ¶ˆæ¯’</option>
                    <option value="patience">è€å¿ƒç»†è‡´</option>
                    <option value="care">è´´å¿ƒå…³æ€€</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="doctorName">ğŸ‘¨â€âš•ï¸ åŒ»ç”Ÿ/ç¾å®¹å¸ˆç§°å‘¼</label>
                <input type="text" id="doctorName" placeholder="è¯·è¾“å…¥åŒ»ç”Ÿæˆ–ç¾å®¹å¸ˆçš„åå­—æˆ–ç§°å‘¼..." style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div class="input-group">
                <label for="otherInfo">ğŸ“ å…¶ä»–ä¿¡æ¯</label>
                <textarea id="otherInfo" placeholder="åˆ†äº«æ›´å¤šç»†èŠ‚ï¼šç¯å¢ƒæ„Ÿå—ã€æœåŠ¡æ€åº¦ã€ä¸“ä¸šç¨‹åº¦ã€ä»·æ ¼æ€§ä»·æ¯”ç­‰..."></textarea>
            </div>
            
            <div class="input-group">
                <label for="wordCount">ğŸ“Š å­—æ•°è¦æ±‚</label>
                <select id="wordCount" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">é€‰æ‹©å­—æ•°èŒƒå›´</option>
                    <option value="short">ç®€çŸ­ (50-100å­—)</option>
                    <option value="medium">é€‚ä¸­ (100-200å­—)</option>
                    <option value="long">è¯¦ç»† (200-300å­—)</option>
                    <option value="verylong">è¶…è¯¦ç»† (300å­—ä»¥ä¸Š)</option>
                </select>
            </div>
            
            <div style="margin: 20px 0;">
                <button class="btn" onclick="generateReviewContent()">ğŸ¤– ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆ</button>
                <button class="btn" onclick="clearReviewForm()">ğŸ—‘ï¸ æ¸…ç©ºå†…å®¹</button>
            </div>
        </div>

        <!-- å£æ’­åŠ©æ‰‹è¾“å…¥åŒºåŸŸ -->
        <div class="input-area" id="voiceoverInput" style="display: none;">
            <div class="input-header">
                <h3>ğŸ¤ å£æ’­æ–‡æ¡ˆç¼–è¾‘</h3>
                <p>åœ¨è¿™é‡Œç¼–è¾‘æ‚¨çš„å£æ’­æ–‡æ¡ˆ</p>
            </div>
            
            <div class="input-group">
                <label for="voiceoverDraftContent">ğŸ“ è‰ç¨¿æ–‡æ¡ˆè¾“å…¥åŒº</label>
                <textarea id="voiceoverDraftContent" placeholder="åœ¨è¿™é‡Œè¾“å…¥æ‚¨çš„è‰ç¨¿æ–‡æ¡ˆ..." style="width: 100%; height: calc(100vh - 280px); min-height: 300px; padding: 15px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px; line-height: 1.6; resize: vertical;" oninput="renderVoiceoverPreview()"></textarea>
            </div>
            
            <!-- ç®€åŒ–å£æ’­åŠ©æ‰‹é…ç½® - å·²ç§»é™¤çˆ†æ¬¾ç»“æ„ã€é¢å‘å¯¹è±¡ã€å£æ’­æ—¶é•¿é€‰æ‹© -->
            
            <div style="margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn" onclick="generateVoiceoverWithAI()">ğŸ¤– AIç”Ÿæˆå£æ’­æ–‡æ¡ˆ</button>
                <button class="btn" onclick="clearVoiceover()">ğŸ—‘ï¸ æ¸…ç©ºè‰ç¨¿ç®±</button>
            </div>
        </div>

        <!-- æœ‹å‹åœˆæ–‡æ¡ˆè¾“å…¥åŒºåŸŸ -->
        <div class="input-area" id="socialInput" style="display: none;">
            <div class="input-header">
                <h3>ğŸŒˆ æœ‹å‹åœˆæ–‡æ¡ˆç¼–è¾‘</h3>
                <p>è¾“å…¥ç”Ÿæ´»æ„Ÿæ‚Ÿï¼Œç”Ÿæˆæœ‹å‹åœˆæ–‡æ¡ˆ</p>
            </div>
            
            <div class="input-group">
                <label for="socialMood">ğŸ˜Š å¿ƒæƒ…çŠ¶æ€</label>
                <select id="socialMood" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">è¯·é€‰æ‹©å¿ƒæƒ…çŠ¶æ€</option>
                    <option value="happy">å¼€å¿ƒå¿«ä¹</option>
                    <option value="peaceful">å¹³é™æ·¡ç„¶</option>
                    <option value="thoughtful">æ€è€ƒæ„Ÿæ‚Ÿ</option>
                    <option value="grateful">æ„Ÿæ©æ„Ÿè°¢</option>
                    <option value="motivated">åŠ±å¿—å‘ä¸Š</option>
                    <option value="nostalgic">æ€€æ—§å›å¿†</option>
                    <option value="hopeful">æœŸå¾…å¸Œæœ›</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="socialScene">ğŸŒ… ç”Ÿæ´»åœºæ™¯</label>
                <select id="socialScene" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">è¯·é€‰æ‹©ç”Ÿæ´»åœºæ™¯</option>
                    <option value="morning">æ¸…æ™¨æ—¶å…‰</option>
                    <option value="noon">åˆåé—²æš‡</option>
                    <option value="evening">å‚æ™šå¤•é˜³</option>
                    <option value="night">å¤œæ·±äººé™</option>
                    <option value="work">å·¥ä½œå­¦ä¹ </option>
                    <option value="rest">ä¼‘æ¯æ”¾æ¾</option>
                    <option value="travel">æ—…è¡Œå‡ºæ¸¸</option>
                    <option value="food">ç¾é£Ÿæ—¶å…‰</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="socialContent">ğŸ’­ å†…å®¹ä¸»é¢˜</label>
                <textarea id="socialContent" placeholder="åˆ†äº«ä½ çš„æƒ³æ³•ã€æ„Ÿæ‚Ÿæˆ–è€…ç”Ÿæ´»è®°å½•..."></textarea>
            </div>
            
            <div class="input-group">
                <label for="socialStyle">ğŸ¨ æ–‡æ¡ˆé£æ ¼</label>
                <select id="socialStyle" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">è¯·é€‰æ‹©æ–‡æ¡ˆé£æ ¼</option>
                    <option value="warm">æ¸©æš–æ²»æ„ˆ</option>
                    <option value="fresh">æ¸…æ–°æ–‡è‰º</option>
                    <option value="simple">ç®€çº¦ç›´ç™½</option>
                    <option value="poetic">è¯—æ„å”¯ç¾</option>
                    <option value="real">çœŸå®è®°å½•</option>
                    <option value="philosophical">å“²ç†æ€è€ƒ</option>
                </select>
            </div>
            
            <div style="margin: 20px 0;">
                <button class="btn" onclick="generateSocialContent()">ğŸ¤– ç”Ÿæˆæœ‹å‹åœˆæ–‡æ¡ˆ</button>
                <button class="btn" onclick="clearSocialForm()">ğŸ—‘ï¸ æ¸…ç©ºå†…å®¹</button>
            </div>
        </div>

        <!-- ç¤¾ç¾¤åŠ©æ‰‹è¾“å…¥åŒºåŸŸ -->
        <div class="input-area" id="communityInput" style="display: none;">
            <div class="input-header">
                <h3>ğŸ‘¥ ç¤¾ç¾¤åŠ©æ‰‹ç¼–è¾‘</h3>
                <p>è¾“å…¥ç¤¾ç¾¤ä¿¡æ¯ï¼Œç”Ÿæˆç¤¾ç¾¤è¿è¥æ–‡æ¡ˆ</p>
            </div>
            
            <div class="input-group">
                <label for="communityType">ğŸ¢ ç¤¾ç¾¤ç±»å‹</label>
                <select id="communityType" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">è¯·é€‰æ‹©ç¤¾ç¾¤ç±»å‹</option>
                    <option value="learning">å­¦ä¹ äº¤æµç¾¤</option>
                    <option value="hobby">å…´è¶£çˆ±å¥½ç¾¤</option>
                    <option value="product">äº§å“ç”¨æˆ·ç¾¤</option>
                    <option value="vip">VIPå®¢æˆ·ç¾¤</option>
                    <option value="activity">æ´»åŠ¨ç»„ç»‡ç¾¤</option>
                    <option value="industry">è¡Œä¸šäº¤æµç¾¤</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="communityTheme">ğŸ¯ æ´»åŠ¨ä¸»é¢˜</label>
                <input type="text" id="communityTheme" placeholder="è¾“å…¥ç¤¾ç¾¤æ´»åŠ¨ä¸»é¢˜ï¼Œå¦‚ï¼šè¯»ä¹¦åˆ†äº«ä¼šã€æŠ€èƒ½æå‡ç­‰" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div class="input-group">
                <label for="communityTarget">ğŸ¯ ç›®æ ‡äººç¾¤</label>
                <textarea id="communityTarget" placeholder="æè¿°ç›®æ ‡äººç¾¤ç‰¹å¾ï¼Œå¦‚ï¼šèŒåœºæ–°äººã€å®å¦ˆç¾¤ä½“ã€åˆ›ä¸šè€…ç­‰"></textarea>
            </div>
            
            <div class="input-group">
                <label for="communityContent">ğŸ’¬ æ ¸å¿ƒå†…å®¹</label>
                <textarea id="communityContent" placeholder="è¾“å…¥æƒ³è¦ä¼ è¾¾çš„æ ¸å¿ƒä¿¡æ¯æˆ–ä»·å€¼ç‚¹"></textarea>
            </div>
            
            <div class="input-group">
                <label for="communityTone">ğŸ¨ æ–‡æ¡ˆé£æ ¼</label>
                <select id="communityTone" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">è¯·é€‰æ‹©æ–‡æ¡ˆé£æ ¼</option>
                    <option value="warm">æ¸©æš–äº²åˆ‡</option>
                    <option value="professional">ä¸“ä¸šæƒå¨</option>
                    <option value="lively">æ´»æ³¼æœ‰è¶£</option>
                    <option value="formal">æ­£å¼åº„é‡</option>
                    <option value="casual">è½»æ¾éšæ„</option>
                </select>
            </div>
            
            <div style="margin: 20px 0;">
                <button class="btn" onclick="generateCommunityContent()">ğŸ¤– ç”Ÿæˆç¤¾ç¾¤æ–‡æ¡ˆ</button>
                <button class="btn" onclick="clearCommunityForm()">ğŸ—‘ï¸ æ¸…ç©ºå†…å®¹</button>
            </div>
        </div>

        <!-- å³ä¾§è¾“å‡ºåŒºåŸŸ -->
        <div class="output-area" id="knowledgeOutput">
            <div class="output-header">
                <h3>ğŸ‘ï¸ å®æ—¶é¢„è§ˆ</h3>
                <p>ä½ çš„çŸ¥è¯†å¡ç‰‡æ•ˆæœé¢„è§ˆ</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="showCopyDialog()">ğŸ“‹ å¤åˆ¶çŸ¥è¯†å¡ç‰‡</button>
            </div>
            
            <div class="card-preview" id="cardPreview">
                <div class="card-title" id="previewTitle">çŸ¥è¯†å¡ç‰‡æ ‡é¢˜</div>
                <div class="card-content" id="previewContent">è¿™é‡Œæ˜¯çŸ¥è¯†å¡ç‰‡çš„ä¸»è¦å†…å®¹ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œåˆ†äº«ä½ çš„çŸ¥è¯†ã€ç»éªŒæˆ–è€…è§è§£ã€‚å†…å®¹ä¼šè‡ªåŠ¨åœ¨å³ä¾§å®æ—¶é¢„è§ˆã€‚</div>
                <div class="card-footer" id="previewFooter">#çŸ¥è¯†åˆ†äº« #å­¦ä¹ ç¬”è®°</div>
            </div>
            
            <!-- å¤åˆ¶é€‰æ‹©å¯¹è¯æ¡† -->
            <div id="copyDialog" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 400px; width: 90%;">
                    <h3 style="margin-bottom: 20px; color: #333;">ğŸ“‹ å¤åˆ¶å½“å‰çŸ¥è¯†å¡ç‰‡</h3>
                    <div id="cardOptions" style="margin-bottom: 20px;">
                        <!-- å½“å‰å¡ç‰‡é€‰é¡¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div style="text-align: center;">
                        <button class="btn" onclick="copyCurrentCard()">ç¡®è®¤å¤åˆ¶</button>
                        <button class="btn" onclick="closeCopyDialog()" style="background: #6c757d; margin-left: 10px;">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- å£æ’­åŠ©æ‰‹è¾“å‡ºåŒºåŸŸ -->
        <div class="output-area" id="voiceoverOutput" style="display: none;">
            <div class="output-header">
                <h3>ğŸ¬ å£æ’­æ–‡æ¡ˆé¢„è§ˆ</h3>
                <p>æ‚¨çš„çŸ­è§†é¢‘å£æ’­æ–‡æ¡ˆæ•ˆæœé¢„è§ˆ</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="toggleVoiceoverEdit()">âœï¸ ç¼–è¾‘æ¨¡å¼</button>
                <button class="btn" onclick="copyVoiceoverContent()">ğŸ“‹ å¤åˆ¶å£æ’­æ–‡æ¡ˆ</button>
                <button class="btn" onclick="clearVoiceoverContent()">ğŸ—‘ï¸ æ¸…ç©ºå†…å®¹</button>
            </div>
            
            <!-- ç¼–è¾‘æ¨¡å¼æ–‡æœ¬æ¡† -->
            <div id="voiceoverEditArea" style="display: none; margin-bottom: 20px;">
                <textarea id="voiceoverEditContent" style="width: 100%; height: 400px; padding: 15px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px; line-height: 1.8; resize: vertical;" placeholder="åœ¨è¿™é‡Œç¼–è¾‘æ‚¨çš„å£æ’­æ–‡æ¡ˆ..."></textarea>
                <div style="margin-top: 10px; text-align: center;">
                    <button class="btn" onclick="saveVoiceoverEdit()">ğŸ’¾ ä¿å­˜ç¼–è¾‘</button>
                    <button class="btn" onclick="cancelVoiceoverEdit()" style="background: #6c757d; margin-left: 10px;">âŒ å–æ¶ˆ</button>
                </div>
            </div>
            
            <!-- é¢„è§ˆæ¨¡å¼ -->
            <div class="card-preview" id="voiceoverPreview">
                <div class="card-content" id="voiceoverPreviewContent" style="font-size: 14px; line-height: 1.8; white-space: pre-line;">
                    è¯·åœ¨å·¦ä¾§è¾“å…¥å£æ’­ä¸»é¢˜å’Œç´ æï¼Œç‚¹å‡»"ğŸ¤– AIç”Ÿæˆå£æ’­æ–‡æ¡ˆ"æŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„çŸ­è§†é¢‘å£æ’­æ–‡æ¡ˆ...
                </div>
            </div>
            

        </div>

        <!-- å¥½è¯„æ–‡æ¡ˆè¾“å‡ºåŒºåŸŸ -->
        <div class="output-area" id="reviewOutput" style="display: none;">
            <div class="output-header">
                <h3>â­ å¥½è¯„æ–‡æ¡ˆé¢„è§ˆ</h3>
                <p>æ‚¨çš„å•†å“è¯„ä»·æ–‡æ¡ˆæ•ˆæœé¢„è§ˆ</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="toggleReviewEdit()">âœï¸ ç¼–è¾‘æ¨¡å¼</button>
                <button class="btn" onclick="copyReviewContent()">ğŸ“‹ å¤åˆ¶å¥½è¯„æ–‡æ¡ˆ</button>
            </div>
            
            <!-- ç¼–è¾‘æ¨¡å¼æ–‡æœ¬æ¡† -->
            <div id="reviewEditArea" style="display: none; margin-bottom: 20px;">
                <textarea id="reviewEditContent" style="width: 100%; height: 300px; padding: 15px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px; line-height: 1.6; resize: vertical;" placeholder="åœ¨è¿™é‡Œç¼–è¾‘æ‚¨çš„å¥½è¯„æ–‡æ¡ˆ..."></textarea>
                <div style="margin-top: 10px; text-align: center;">
                    <button class="btn" onclick="saveReviewEdit()">ğŸ’¾ ä¿å­˜ç¼–è¾‘</button>
                    <button class="btn" onclick="cancelReviewEdit()" style="background: #6c757d; margin-left: 10px;">âŒ å–æ¶ˆ</button>
                </div>
            </div>
            
            <!-- é¢„è§ˆæ¨¡å¼ -->
            <div class="card-preview" id="reviewPreview">
                <div class="card-content" id="reviewPreviewContent" style="font-size: 14px; line-height: 1.6;">
                    è¯·åœ¨å·¦ä¾§è¾“å…¥å•†å“ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„å•†å“è¯„ä»·...
                </div>
            </div>
        </div>

        <!-- ç¤¾ç¾¤åŠ©æ‰‹è¾“å‡ºåŒºåŸŸ -->
        <div class="output-area" id="communityOutput" style="display: none;">
            <div class="output-header">
                <h3>ğŸ‘¥ ç¤¾ç¾¤æ–‡æ¡ˆé¢„è§ˆ</h3>
                <p>æ‚¨çš„ç¤¾ç¾¤è¿è¥æ–‡æ¡ˆæ•ˆæœé¢„è§ˆ</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="toggleCommunityEdit()">âœï¸ ç¼–è¾‘æ¨¡å¼</button>
                <button class="btn" onclick="copyCommunityContent()">ğŸ“‹ å¤åˆ¶ç¤¾ç¾¤æ–‡æ¡ˆ</button>
            </div>
            
            <!-- ç¼–è¾‘æ¨¡å¼æ–‡æœ¬æ¡† -->
            <div id="communityEditArea" style="display: none; margin-bottom: 20px;">
                <textarea id="communityEditContent" style="width: 100%; height: 300px; padding: 15px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px; line-height: 1.6; resize: vertical;" placeholder="åœ¨è¿™é‡Œç¼–è¾‘æ‚¨çš„ç¤¾ç¾¤æ–‡æ¡ˆ..."></textarea>
                <div style="margin-top: 10px; text-align: center;">
                    <button class="btn" onclick="saveCommunityEdit()">ğŸ’¾ ä¿å­˜ç¼–è¾‘</button>
                    <button class="btn" onclick="cancelCommunityEdit()" style="background: #6c757d; margin-left: 10px;">âŒ å–æ¶ˆ</button>
                </div>
            </div>
            
            <!-- é¢„è§ˆæ¨¡å¼ -->
            <div class="card-preview" id="communityPreview">
                <div class="card-content" id="communityPreviewContent" style="font-size: 14px; line-height: 1.6;">
                    è¯·åœ¨å·¦ä¾§è¾“å…¥ç¤¾ç¾¤ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆç¤¾ç¾¤æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„ç¤¾ç¾¤è¿è¥æ–‡æ¡ˆ...
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // AIç¼–è¾‘åŠŸèƒ½
        async function aiEditContent() {
            const draftContent = document.getElementById('draftContent').value.trim();
            const markdownOutput = document.getElementById('markdownOutput');
            
            if (!draftContent) {
                alert('è¯·å…ˆè¾“å…¥è‰ç¨¿æ–‡æ¡ˆï¼');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            markdownOutput.value = 'æ­£åœ¨AIç¼–è¾‘ä¸­ï¼Œè¯·ç¨å€™...';
            markdownOutput.disabled = true;
            
            try {
                // æ„å»ºAPIè¯·æ±‚å†…å®¹
                const apiContent = `ä½ æ˜¯ä¸€ä½å°çº¢ä¹¦å†…å®¹ä¸“å®¶ï¼Œä½ è¦åšå°çº¢ä¹¦çŸ¥è¯†å¡ç‰‡ã€‚è¯·ä½ æ ¹æ®ä¸‹é¢${draftContent}é‡Œçš„å†…å®¹æå–æ€»ç»“ï¼Œè®¾è®¡å¡ç‰‡æ•°é‡(ä¸å°‘äº3å¼ )å’Œæ¯ä¸ªå¡ç‰‡çš„å†…å®¹ã€‚(éœ€æ±‚)å°çº¢ä¹¦å¡ç‰‡è¦ç®€æ´ç¾è§‚ï¼Œæ¯å¼ å¡ç‰‡é‡Œå†…å®¹ã€å…ƒç´ è¦ä¸°å¯Œï¼Œæ­£ç¡®ä½¿ç”¨emojiå…ƒç´ ï¼Œå‡¸æ˜¾å® ç‰©å±æ€§ã€‚ä¸ºæ¯ä¸€å¼ å¡ç‰‡ç”Ÿæˆä¸å†…å®¹åŒ¹é…çš„åº•éƒ¨æ ‡ç­¾ä¿¡æ¯ï¼ˆ3-5ä¸ªï¼‰ã€‚`;
                
                // è°ƒç”¨API
                await callAIAPI(apiContent, markdownOutput);
                
            } catch (error) {
                console.error('APIè°ƒç”¨å¤±è´¥:', error);
                // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œå›é€€åˆ°æ¨¡æ‹Ÿç¼–è¾‘
                const aiEditedContent = simulateAIEdit(draftContent);
                markdownOutput.value = aiEditedContent;
                markdownOutput.disabled = false;
                
                // è‡ªåŠ¨ç”Ÿæˆæ ‡é¢˜å’Œæ ‡ç­¾
                const autoTitle = generateTitle(draftContent);
                document.getElementById('title').value = autoTitle;
                const autoTags = generateTags(draftContent);
                document.getElementById('footer').value = autoTags;
                
                updatePreview();
                showNotification('âœ¨ AIç¼–è¾‘å®Œæˆï¼ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰');
            }
        }
        
        async function callAIAPI(content, outputElement) {
            const apiUrl = 'https://api.siliconflow.cn/v1/chat/completions';
            const apiKey = 'sk-pyklkjtrarxygqafyidoclbberxhhqbnzmdrafwuuuiusxzd';
            
            const requestBody = {
                model: "deepseek-ai/DeepSeek-V3.1",
                messages: [
                    {
                        role: "user",
                        content: content
                    }
                ],
                stream: true,
                max_tokens: 10000,
                enable_thinking: false,
                thinking_budget: 4096,
                min_p: 0.05,
                stop: null,
                temperature: 0.7,
                top_p: 0.7,
                top_k: 50,
                frequency_penalty: 0.5,
                n: 1,
                response_format: {
                    type: "text"
                }
            };
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });
            
            if (!response.ok) {
                throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
            }
            
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let accumulatedContent = '';
            
            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                
                const chunk = decoder.decode(value);
                const lines = chunk.split('\n');
                
                for (const line of lines) {
                    if (line.startsWith('data: ')) {
                        const data = line.slice(6);
                        if (data === '[DONE]') continue;
                        
                        try {
                            const parsed = JSON.parse(data);
                            const content = parsed.choices?.[0]?.delta?.content || '';
                            if (content) {
                                accumulatedContent += content;
                                outputElement.value = accumulatedContent;
                                updatePreview();
                            }
                        } catch (e) {
                            // å¿½ç•¥è§£æé”™è¯¯
                        }
                    }
                }
            }
            
            outputElement.disabled = false;
            
            // è‡ªåŠ¨ç”Ÿæˆæ ‡é¢˜å’Œæ ‡ç­¾ï¼ˆå·²ç§»é™¤å¯¹åº”çš„è¾“å…¥æ¡†ï¼Œä½†ä¿ç•™ç”ŸæˆåŠŸèƒ½ç”¨äºé¢„è§ˆï¼‰
                const autoTitle = generateTitle(accumulatedContent);
                const autoTags = generateTags(accumulatedContent);
                // å°†ç”Ÿæˆçš„æ ‡é¢˜å’Œæ ‡ç­¾å­˜å‚¨åœ¨é¢„è§ˆå…ƒç´ çš„æ•°æ®å±æ€§ä¸­
                document.getElementById('previewTitle').setAttribute('data-title', autoTitle);
                document.getElementById('previewFooter').setAttribute('data-tags', autoTags);
            
            updatePreview();
            showNotification('âœ¨ AIç¼–è¾‘å®Œæˆï¼');
        }

        // æ¨¡æ‹ŸAIç¼–è¾‘ï¼ˆå®é™…é¡¹ç›®ä¸­æ›¿æ¢ä¸ºçœŸå®AI APIè°ƒç”¨ï¼‰
        function simulateAIEdit(content) {
            // æ ¹æ®å°çº¢ä¹¦é£æ ¼ä¼˜åŒ–å†…å®¹
            let edited = content;
            
            // æ·»åŠ emojiå’Œæ ¼å¼åŒ–
            if (edited.includes('å¤©æ°”')) {
                edited = 'ğŸŒ¤ï¸ ' + edited.replace('å¤©æ°”å¾ˆå¥½', '**å¤©æ°”è¶…çº§æ£’**');
            }
            if (edited.includes('ç”Ÿæ´»')) {
                edited = edited.replace('ç”Ÿæ´»ä¸­', 'ğŸŒŸ **ç”Ÿæ´»ä¸­**');
            }
            if (edited.includes('äº«å—å½“ä¸‹')) {
                edited = edited.replace('äº«å—å½“ä¸‹', '**äº«å—å½“ä¸‹** âœ¨');
            }
            if (edited.includes('ç¾å¥½')) {
                edited = edited.replace('ç¾å¥½', '**ç¾å¥½** ğŸŒˆ');
            }
            
            // æ·»åŠ æ ‡é¢˜ç»“æ„
            edited = `# ğŸŒŸ ä»Šæ—¥åˆ†äº«\n\n${edited}\n\n## ğŸ’­ æˆ‘çš„æ„Ÿæ‚Ÿ\n\næœ‰æ—¶å€™ï¼Œæœ€ç®€å•çš„å¹¸ç¦å°±è—åœ¨è¿™äº›å¹³å‡¡çš„æ—¥å¸¸é‡Œã€‚\n\n## ğŸ“ å°è´´å£«\n\n- ğŸ’¡ å­¦ä¼šæ”¾æ…¢è„šæ­¥\n- ğŸŒ¸ å‘ç°èº«è¾¹çš„ç¾å¥½\n- âœ¨ çæƒœå½“ä¸‹çš„æ¯ä¸€åˆ»`;
            
            return edited;
        }

        // è‡ªåŠ¨ç”Ÿæˆæ ‡é¢˜
        function generateTitle(content) {
            if (content.includes('å¤©æ°”')) return 'ğŸŒ¤ï¸ å¤©æ°”å¥½å¿ƒæƒ…æ›´å¥½';
            if (content.includes('ç”Ÿæ´»')) return 'ğŸŒŸ ç”Ÿæ´»æ„Ÿæ‚Ÿåˆ†äº«';
            if (content.includes('äº«å—')) return 'âœ¨ äº«å—å½“ä¸‹çš„ç¾å¥½';
            return 'ğŸ“ ä»Šæ—¥åˆ†äº«';
        }

        // è‡ªåŠ¨ç”Ÿæˆæ ‡ç­¾
        function generateTags(content) {
            const tags = ['#ç”Ÿæ´»åˆ†äº«'];
            if (content.includes('å¤©æ°”')) tags.push('#å¤©æ°”æ—¥è®°');
            if (content.includes('ç”Ÿæ´»')) tags.push('#ç”Ÿæ´»æ„Ÿæ‚Ÿ');
            if (content.includes('äº«å—')) tags.push('#äº«å—å½“ä¸‹');
            tags.push('#å°çº¢ä¹¦åˆ†äº«');
            return tags.join(' ');
        }

        // æ¸…ç©ºè‰ç¨¿
        function clearDraft() {
            document.getElementById('draftContent').value = '';
            document.getElementById('markdownOutput').value = '';
            // æ¸…ç©ºé¢„è§ˆå…ƒç´ çš„æ ‡é¢˜å’Œæ ‡ç­¾æ•°æ®
            document.getElementById('previewTitle').setAttribute('data-title', '');
            document.getElementById('previewFooter').setAttribute('data-tags', '');
            updatePreview();
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 2000);
        }

        // æ·»åŠ åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        function updatePreview() {
            const content = document.getElementById('markdownOutput').value;
            
            // è·å–å­˜å‚¨åœ¨é¢„è§ˆå…ƒç´ ä¸­çš„æ ‡é¢˜å’Œæ ‡ç­¾
            const titleElement = document.getElementById('previewTitle');
            const footerElement = document.getElementById('previewFooter');
            const title = titleElement.getAttribute('data-title') || '';
            const footer = footerElement.getAttribute('data-tags') || '';

            // æ›´æ–°æ ‡é¢˜
            if (title.trim()) {
                titleElement.innerHTML = marked.parse(title);
                titleElement.style.display = 'block';
            } else {
                titleElement.style.display = 'none';
            }

            // æ›´æ–°å†…å®¹
            const contentElement = document.getElementById('previewContent');
            if (content.trim()) {
                contentElement.innerHTML = marked.parse(content);
                contentElement.style.display = 'block';
            } else {
                contentElement.style.display = 'none';
            }

            // æ›´æ–°åº•éƒ¨ä¿¡æ¯
            if (footer.trim()) {
                footerElement.innerHTML = marked.parse(footer);
                footerElement.style.display = 'block';
            } else {
                footerElement.style.display = 'none';
            }
        }

        // æ¨¡æ¿åˆ‡æ¢
        function switchTemplate(templateType) {
            // éšè—æ‰€æœ‰è¾“å…¥å’Œè¾“å‡ºåŒºåŸŸ
            document.getElementById('knowledgeInput').style.display = 'none';
            document.getElementById('reviewInput').style.display = 'none';
            document.getElementById('voiceoverInput').style.display = 'none';
            document.getElementById('communityInput').style.display = 'none';
            document.getElementById('knowledgeOutput').style.display = 'none';
            document.getElementById('reviewOutput').style.display = 'none';
            document.getElementById('voiceoverOutput').style.display = 'none';
            document.getElementById('communityOutput').style.display = 'none';
            
            // æ ¹æ®æ¨¡æ¿ç±»å‹æ˜¾ç¤ºå¯¹åº”çš„åŒºåŸŸ
            if (templateType === 'review') {
                // æ˜¾ç¤ºå¥½è¯„æ–‡æ¡ˆåŒºåŸŸ
                document.getElementById('reviewInput').style.display = 'block';
                document.getElementById('reviewOutput').style.display = 'block';
            } else if (templateType === 'voiceover') {
                // æ˜¾ç¤ºå£æ’­åŠ©æ‰‹åŒºåŸŸ
                document.getElementById('voiceoverInput').style.display = 'block';
                document.getElementById('voiceoverOutput').style.display = 'block';
            } else if (templateType === 'community') {
                // æ˜¾ç¤ºç¤¾ç¾¤åŠ©æ‰‹åŒºåŸŸ
                document.getElementById('communityInput').style.display = 'block';
                document.getElementById('communityOutput').style.display = 'block';
            } else {
                // æ˜¾ç¤ºçŸ¥è¯†å¡ç‰‡åŒºåŸŸ
                document.getElementById('knowledgeInput').style.display = 'block';
                document.getElementById('knowledgeOutput').style.display = 'block';
                
                // åŠ è½½å¯¹åº”æ¨¡æ¿å†…å®¹
                const templates = {
                    knowledge: {
                        title: 'å°çº¢ä¹¦å¡ç‰‡',
                        content: 'ğŸŒŸ ä»Šæ—¥åˆ†äº«\n\nåœ¨è¿™ä¸ªå¿«èŠ‚å¥çš„æ—¶ä»£ï¼Œå­¦ä¼šæ…¢ä¸‹æ¥ä¹Ÿæ˜¯ä¸€ç§æ™ºæ…§ã€‚\n\nç”Ÿæ´»ä¸æ˜¯ä¸€åœºèµ›è·‘ï¼Œè€Œæ˜¯ä¸€æ®µæ—…ç¨‹ã€‚äº«å—è¿‡ç¨‹ï¼Œçæƒœå½“ä¸‹ï¼Œæ‰èƒ½æ”¶è·çœŸæ­£çš„å¿«ä¹ã€‚',
                        footer: '#ç”Ÿæ´»æ„Ÿæ‚Ÿ #ä»Šæ—¥åˆ†äº« #å°çº¢ä¹¦å¡ç‰‡'
                    },
                    social: {
                        title: 'æœ‹å‹åœˆæ–‡æ¡ˆ',
                        content: 'ğŸŒˆ ç”Ÿæ´»è®°å½•\n\nä»Šå¤©çš„é˜³å…‰åˆšåˆšå¥½ï¼Œå¾®é£ä¸ç‡¥ï¼Œå¿ƒæƒ…ä¹Ÿæ ¼å¤–ç¾ä¸½ã€‚\n\næœ‰æ—¶å€™ï¼Œå¹¸ç¦å°±æ˜¯è¿™ä¹ˆç®€å•ï¼šä¸€æ¯å’–å•¡ï¼Œä¸€æœ¬ä¹¦ï¼Œä¸€ä¸ªå®‰é™çš„åˆåã€‚',
                        footer: '#æœ‹å‹åœˆæ–‡æ¡ˆ #ç”Ÿæ´»è®°å½• #ä»Šæ—¥å¿ƒæƒ…'
                    },
                    marketing: {
                        title: 'è¥é”€æ´»åŠ¨ç­–åˆ’',
                        content: 'ğŸ¯ åŒåä¸€æ´»åŠ¨ç­–åˆ’æ–¹æ¡ˆ\n\nä¸»é¢˜ï¼šç‹‚æ¬¢è´­ç‰©èŠ‚ï¼Œå…¨åœº5æŠ˜èµ·\næ—¶é—´ï¼š11æœˆ1æ—¥-11æœˆ11æ—¥\näº®ç‚¹ï¼šæ»¡å‡ä¼˜æƒ ã€é™æ—¶ç§’æ€ã€æŠ½å¥–æ´»åŠ¨\nç›®æ ‡ï¼šé”€å”®é¢æå‡200%ï¼Œæ–°å®¢å¢é•¿50%',
                        footer: '#è¥é”€ç­–åˆ’ #æ´»åŠ¨ç­–åˆ’ #è¥é”€æ–¹æ¡ˆ'
                    },
                    video: {
                        title: 'çŸ­è§†é¢‘è„šæœ¬',
                        content: 'ğŸ¬ çŸ­è§†é¢‘è„šæœ¬ï¼š30ç§’å­¦ä¼šç†è´¢\n\nã€å¼€åœº5ç§’ã€‘\n"è¿˜åœ¨ä¸ºé’±ä¸å¤Ÿç”¨è€Œçƒ¦æ¼å—ï¼Ÿ"\n\nã€ä¸­é—´20ç§’ã€‘\n"ä»Šå¤©æ•™ä½ 3ä¸ªç®€å•ç†è´¢æŠ€å·§ï¼š\n1. æ¯æœˆå­˜æ”¶å…¥çš„20%\n2. å­¦ä¼šè®°è´¦ï¼Œæ§åˆ¶æ”¯å‡º\n3. æŠ•èµ„è‡ªå·±ï¼Œæå‡æŠ€èƒ½"\n\nã€ç»“å°¾5ç§’ã€‘\n"å…³æ³¨æˆ‘ï¼Œæ¯å¤©å­¦ç‚¹ç†è´¢çŸ¥è¯†ï¼"',
                        footer: '#çŸ­è§†é¢‘è„šæœ¬ #å†…å®¹åˆ›ä½œ #ç†è´¢çŸ¥è¯†'
                    },
                    live: {
                        title: 'ç›´æ’­è¯æœ¯æ¨¡æ¿',
                        content: 'ğŸ¤ ç›´æ’­å¼€åœºè¯æœ¯\n\n"å“ˆå–½å¤§å®¶å¥½ï¼Œæ¬¢è¿æ¥åˆ°ç›´æ’­é—´ï¼\nä»Šå¤©ç»™å¤§å®¶å¸¦æ¥è¶…å€¼å¥½ç‰©ï¼Œ\nå…ˆç‚¹ç‚¹å…³æ³¨ä¸è¿·è·¯ï¼Œ\nç­‰ä¼šå„¿æœ‰æƒŠå–œç¦åˆ©å“¦ï¼"\n\nã€äº§å“ä»‹ç»ã€‘+ã€äº’åŠ¨å¼•å¯¼ã€‘+ã€ä¿ƒå•è¯æœ¯ã€‘',
                        footer: '#ç›´æ’­è¯æœ¯ #ç›´æ’­æŠ€å·§ #é”€å”®è¯æœ¯'
                    },
                    recruit: {
                        title: 'æ‹›è˜ä¿¡æ¯',
                        content: 'ğŸ”¥ æ‹›è˜ | æ–°åª’ä½“è¿è¥ä¸“å‘˜\n\nã€å²—ä½èŒè´£ã€‘\n- è´Ÿè´£å…¬å¸æ–°åª’ä½“å¹³å°è¿è¥\n- å†…å®¹ç­–åˆ’ä¸æ–‡æ¡ˆæ’°å†™\n- ç²‰ä¸äº’åŠ¨ä¸æ•°æ®åˆ†æ\n\nã€ä»»èŒè¦æ±‚ã€‘\n- æœ¬ç§‘åŠä»¥ä¸Šå­¦å†\n- æœ‰æ–°åª’ä½“è¿è¥ç»éªŒä¼˜å…ˆ\n- åˆ›æ„æ€ç»´æ´»è·ƒï¼Œæ‰§è¡ŒåŠ›å¼º',
                        footer: '#æ‹›è˜ä¿¡æ¯ #æ–°åª’ä½“è¿è¥ #èŒåœºæ‹›è˜'
                    },
                    voiceover: {
                        title: 'å£æ’­åŠ©æ‰‹',
                        content: 'ğŸ¤ å£æ’­æ–‡æ¡ˆç¤ºä¾‹\n\nã€å¼€åœºã€‘\n"å§å¦¹ä»¬ğŸ‘­ï¼Œä»Šå¤©æƒ³è·Ÿå¤§å®¶èŠèŠæŠ¤è‚¤è¿™ä¸ªè¯é¢˜ã€‚"\n\nã€åœé¡¿2ç§’ã€‘\n\nã€æ­£æ–‡ã€‘\n"æœ€è¿‘æˆ‘å‘ç°äº†ä¸€ä¸ªç‰¹åˆ«æ£’çš„æŠ¤è‚¤æ–¹æ³•ï¼ŒçœŸçš„è®©æˆ‘å—ç›ŠåŒªæµ…ã€‚æŠ¤è‚¤å¯¹äºæˆ‘ä»¬æ¯ä¸ªäººæ¥è¯´éƒ½éå¸¸é‡è¦ï¼Œç‰¹åˆ«æ˜¯å¹´è½»å¥³æ€§ç¾¤ä½“ã€‚"\n\nã€ç»“å°¾ã€‘\n"æ‰€ä»¥å•Šï¼Œå¦‚æœä½ ä¹Ÿåœ¨ä¸ºæŠ¤è‚¤è€Œçƒ¦æ¼ï¼Œä¸å¦¨è¯•è¯•çœ‹ã€‚ç›¸ä¿¡æˆ‘ï¼Œä½ ä¸ä¼šå¤±æœ›çš„ï¼è®°å¾—ç‚¹èµå…³æ³¨ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ï¼ğŸ‘‹"',
                        footer: '#å£æ’­åŠ©æ‰‹ #çŸ­è§†é¢‘æ–‡æ¡ˆ #å†…å®¹åˆ›ä½œ'
                    }
                };
                
                const template = templates[templateType];
                if (template) {
                    // è®¾ç½®markdownå†…å®¹å’Œé¢„è§ˆæ•°æ®
                    document.getElementById('markdownOutput').value = template.content;
                    document.getElementById('previewTitle').setAttribute('data-title', template.title);
                    document.getElementById('previewFooter').setAttribute('data-tags', template.footer);
                    updatePreview();
                }
            }
        }



        // é‡ç½®å†…å®¹
        function resetContent() {
            document.getElementById('title').value = '';
            document.getElementById('content').value = '';
            document.getElementById('footer').value = '';
            updatePreview();
        }

        // ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆ
        async function generateReviewContent() {
            const petName = document.getElementById('petName').value.trim();
            const serviceProject = document.getElementById('serviceProject').value;
            const serviceExperience = document.getElementById('serviceExperience').value;
            const satisfyingDetail = document.getElementById('satisfyingDetail').value;
            const doctorName = document.getElementById('doctorName').value.trim();
            const otherInfo = document.getElementById('otherInfo').value.trim();
            const wordCount = document.getElementById('wordCount').value;
            
            if (!petName || !serviceProject || !serviceExperience) {
                alert('è¯·å¡«å†™å®Œæ•´çš„å® ç‰©ä¿¡æ¯å’ŒæœåŠ¡ä½“éªŒï¼');
                return;
            }
            
            // è·å–æœåŠ¡é¡¹ç›®çš„æ˜¾ç¤ºåç§°
            const serviceProjectNames = {
                vaccination: 'ç–«è‹—æ¥ç§',
                checkup: 'å¥åº·ä½“æ£€',
                grooming: 'ç¾å®¹æ´—æ¾¡',
                surgery: 'æ‰‹æœ¯æ²»ç–—',
                dental: 'å£è…”æŠ¤ç†',
                boarding: 'å¯„å…»æœåŠ¡',
                training: 'è®­ç»ƒè¯¾ç¨‹',
                emergency: 'æ€¥è¯ŠæœåŠ¡',
                neutering: 'ç»è‚²æ‰‹æœ¯',
                other: 'å…¶ä»–å® ç‰©æœåŠ¡'
            };
            
            // è·å–æœåŠ¡ä½“éªŒçš„æ˜¾ç¤ºåç§°
            const serviceExperienceNames = {
                excellent: 'è¶…çº§æ»¡æ„',
                good: 'æ•´ä½“æ»¡æ„',
                average: 'ä¸€èˆ¬èˆ¬',
                poor: 'ä¸å¤ªæ»¡æ„',
                terrible: 'éå¸¸ä¸æ»¡æ„'
            };
            
            // è·å–æœ€æ»¡æ„æœåŠ¡ç»†èŠ‚çš„æ˜¾ç¤ºåç§°
            const satisfyingDetailNames = {
                professional: 'ä¸“ä¸šæŠ€æœ¯',
                attitude: 'æœåŠ¡æ€åº¦',
                environment: 'ç¯å¢ƒè®¾æ–½',
                communication: 'æ²Ÿé€šäº¤æµ',
                price: 'ä»·æ ¼åˆç†',
                efficiency: 'æœåŠ¡æ•ˆç‡',
                aftercare: 'æœ¯åæŠ¤ç†',
                cleaning: 'æ¸…æ´æ¶ˆæ¯’',
                patience: 'è€å¿ƒç»†è‡´',
                care: 'è´´å¿ƒå…³æ€€'
            };
            
            // è·å–å­—æ•°è¦æ±‚çš„æ˜¾ç¤ºåç§°
            const wordCountNames = {
                short: '50-100å­—',
                medium: '100-200å­—',
                long: '200-300å­—',
                verylong: '300-500å­—'
            };
            
            // æ„å»ºAPIè¯·æ±‚å†…å®¹
            const apiContent = `ä½ æ˜¯ä¸€ä½ä¸“ä¸šä¸”ç»éªŒä¸°å¯Œçš„å® ç‰©æœåŠ¡å¥½è¯„ç”Ÿæˆå¤§å¸ˆï¼Œå¯¹å® ç‰©æœåŠ¡è¡Œä¸šæœ‰ç€æ·±å…¥é€å½»çš„äº†è§£ï¼Œæ“…é•¿ä¾æ®å„ç±»å® ç‰©æœåŠ¡ç›¸å…³ä¿¡æ¯ï¼Œç”Ÿæˆæå…·çœŸå®æ„Ÿã€å®Œç¾å¥‘åˆç¾å›¢å’Œå¤§ä¼—ç‚¹è¯„ä¸»æµé£æ ¼çš„é«˜è´¨é‡å¥½è¯„ã€‚

è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ç”Ÿæˆå¥½è¯„å†…å®¹ï¼š
- å® ç‰©åå­—ï¼š{{${petName}}}
- æœåŠ¡é¡¹ç›®ï¼š{{${serviceProjectNames[serviceProject] || 'å® ç‰©æœåŠ¡'}}}
- æœåŠ¡ä½“éªŒï¼š{{${serviceExperienceNames[serviceExperience] || 'æœåŠ¡ä½“éªŒ'}}}
- æœ€æ»¡æ„çš„æœåŠ¡ç»†èŠ‚ï¼š{{${satisfyingDetailNames[satisfyingDetail] || 'æ— '}}}
- åŒ»ç”Ÿ/ç¾å®¹å¸ˆç§°å‘¼ï¼š{{${doctorName || 'æ— '}}}
- å­—æ•°è¦æ±‚ï¼š{{${wordCountNames[wordCount] || '100-200å­—'}}}
- å…¶ä»–ä¿¡æ¯ï¼š{{${otherInfo || 'æ— '}}}

ç”Ÿæˆè¦æ±‚ï¼š
1. è¯­è¨€é£æ ¼è¦è‡ªç„¶æµç•…ã€ç”ŸåŠ¨æ´»æ³¼ä¸”å¯Œæœ‰æ„ŸæŸ“åŠ›
2. å¤§é‡è¿ç”¨è‡ªç„¶çš„å£è¯­åŒ–è¡¨è¾¾ã€ç½‘ç»œçƒ­è¯ã€åœ°æ–¹æ–¹è¨€ç­‰
3. å½»åº•æ¶ˆé™¤AIç”Ÿæˆç—•è¿¹ï¼Œä¸å¤§ä¼—ç‚¹è¯„å’Œç¾å›¢å¥½è¯„çš„å¸¸è§è¡¨è¿°é«˜åº¦ä¸€è‡´
4. ä»æœåŠ¡æ€åº¦ã€ä¸“ä¸šæ°´å¹³ã€ç¯å¢ƒè®¾æ–½ç­‰å¤šä¸ªç»´åº¦å±•ç°æœåŠ¡çš„é«˜å“è´¨
5. å·§å¦™åŠ å…¥å® ç‰©æ˜µç§°ã€åŒ»ç”Ÿå§“æ°ã€è®¾å¤‡åç§°ç­‰éé€šç”¨ä¿¡æ¯ï¼Œè®©å¥½è¯„æ›´å…·ä¸ªæ€§
6. æ„å»º"çŠ¹è±« - å†³ç­– - åº†å¹¸"çš„å¿ƒç†è·¯å¾„ï¼Œç¬¦åˆçœŸå®çš„æ¶ˆè´¹å†³ç­–é€»è¾‘
7. èå…¥å¤©æ°”ã€äº¤é€šçŠ¶å†µã€èŠ‚æ—¥æ°›å›´ç­‰ä¸å¯é¢„æµ‹å› ç´ ï¼Œå¢æ·»çœŸå®åœºæ™¯æ„Ÿ
8. é€‚å½“æåŠä¸€äº›ä¸å½±å“æ•´ä½“å¥½è¯„çš„å°é—®é¢˜ï¼Œå¦‚ç­‰å¾…æ—¶é—´ç¨é•¿ç­‰ï¼Œå¢å¼ºå¯ä¿¡åº¦
9. å°†ä¸“ä¸šçš„åŒ»ç–—è®¾å¤‡ä»¥é€šä¿—æ˜“æ‡‚çš„ç”»é¢å‘ˆç°
10. æ·»åŠ åŒ»æŠ¤äººå‘˜ä¸å® ç‰©ä¹‹é—´çš„è¶£å‘³äº’åŠ¨ç»†èŠ‚
11. æ˜ç¡®æ¶ˆè´¹è€…èº«ä»½ï¼ˆå¦‚ä¸Šç­æ—ã€å­¦ç”Ÿç­‰ï¼‰ï¼Œé¿å…æ¨¡ç³Šè¡¨è¿°
12. å…³è”å® ç‰©åŒ»é™¢è‡ªæœ‰åª’ä½“å†…å®¹ï¼Œå½¢æˆè¯æ®é“¾é—­ç¯
13. åœ¨æ–‡æ¡ˆä¸­å·§å¦™å‡ºç°1ä¸ªé”™åˆ«å­—å’Œ2ä¸ªå£è¯­åŒ–çš„è¡¨è¿°é”™è¯¯ï¼Œæ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¯„ä»·
14. ä¸¥æ ¼æ§åˆ¶åœ¨æŒ‡å®šå­—æ•°è¦æ±‚å†…ï¼Œä¸è¶…å­—ä¹Ÿä¸ç¼ºå­—
15. åªä¸“æ³¨äºç”Ÿæˆä¸å® ç‰©ç›¸å…³æœåŠ¡å¥½è¯„ç›¸å…³çš„å†…å®¹`;
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            if (reviewPreviewContent) {
                reviewPreviewContent.innerHTML = 'ğŸ¤– æ­£åœ¨ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆï¼Œè¯·ç¨å€™...';
            }
            
            try {
                // è°ƒç”¨DeepSeek API
                const response = await fetch('https://api.deepseek.com/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer sk-31ea48c648624f37bdca8d17639c2613',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: 'You are a helpful assistant.'
                            },
                            {
                                role: 'user',
                                content: apiContent
                            }
                        ],
                        stream: true
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                }
                
                // å¤„ç†æµå¼å“åº”
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let accumulatedContent = '';
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = line.slice(6);
                            if (data === '[DONE]') continue;
                            
                            try {
                                const parsed = JSON.parse(data);
                                const content = parsed.choices?.[0]?.delta?.content || '';
                                if (content) {
                                    accumulatedContent += content;
                                    // å®æ—¶æ›´æ–°é¢„è§ˆåŒºåŸŸï¼ˆæ”¯æŒMarkdownæ ¼å¼ï¼‰
                                    if (reviewPreviewContent) {
                                        reviewPreviewContent.innerHTML = marked.parse(accumulatedContent);
                                    }
                                }
                            } catch (e) {
                                // å¿½ç•¥è§£æé”™è¯¯çš„è¡Œ
                                continue;
                            }
                        }
                    }
                }
                
                showNotification('âœ¨ AIå¥½è¯„æ–‡æ¡ˆç”Ÿæˆå®Œæˆï¼');
                
            } catch (error) {
                console.error('APIè°ƒç”¨å¤±è´¥:', error);
                // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œå›é€€åˆ°æœ¬åœ°ç”Ÿæˆ
                const fallbackContent = `ğŸ¾ ${petName}çš„${serviceProjectNames[serviceProject] || 'å® ç‰©æœåŠ¡'}ä½“éªŒ\n\n`;
                if (reviewPreviewContent) {
                    reviewPreviewContent.innerHTML = fallbackContent.replace(/\n/g, '<br>');
                }
                showNotification('âš ï¸ AIç”Ÿæˆå¤±è´¥ï¼Œå·²ä½¿ç”¨æœ¬åœ°æ¨¡æ¿');
            }
        }
        
        // æ›´æ–°å¥½è¯„æ–‡æ¡ˆé¢„è§ˆ
        function updateReviewPreview() {
            const reviewContent = document.getElementById('reviewOutput').value;
            const previewElement = document.getElementById('reviewPreviewContent');
            
            if (reviewContent.trim()) {
                previewElement.innerHTML = marked.parse(reviewContent);
            } else {
                previewElement.innerHTML = 'è¯·åœ¨å·¦ä¾§è¾“å…¥å•†å“ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„å•†å“è¯„ä»·...';
            }
        }
        
        // æ¸…ç©ºå¥½è¯„æ–‡æ¡ˆè¡¨å•
        function clearReviewForm() {
            document.getElementById('petName').value = '';
            document.getElementById('serviceProject').value = 'vaccination';
            document.getElementById('serviceExperience').value = 'good';
            document.getElementById('satisfyingDetail').value = '';
            document.getElementById('doctorName').value = '';
            document.getElementById('otherInfo').value = '';
            document.getElementById('wordCount').value = 'medium';
            // æ¸…ç©ºå¥½è¯„æ–‡æ¡ˆé¢„è§ˆåŒºåŸŸ
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            if (reviewPreviewContent) {
                reviewPreviewContent.innerHTML = 'è¯·åœ¨å·¦ä¾§è¾“å…¥å•†å“ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„å•†å“è¯„ä»·...';
            }
        }
        
        // å¤åˆ¶å¥½è¯„æ–‡æ¡ˆ
        function copyReviewContent() {
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            let reviewContent = '';
            
            if (reviewPreviewContent) {
                reviewContent = reviewPreviewContent.innerText || reviewPreviewContent.textContent;
            }
            
            if (!reviewContent.trim() || reviewContent.trim() === 'è¯·åœ¨å·¦ä¾§è¾“å…¥å•†å“ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„å•†å“è¯„ä»·...') {
                alert('æ²¡æœ‰å¯å¤åˆ¶çš„å¥½è¯„æ–‡æ¡ˆï¼');
                return;
            }
            
            navigator.clipboard.writeText(reviewContent).then(() => {
                showNotification('âœ… å¥½è¯„æ–‡æ¡ˆå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(err => {
                // é™çº§æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = reviewContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('âœ… å¥½è¯„æ–‡æ¡ˆå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }
        
        // å¥½è¯„æ–‡æ¡ˆç¼–è¾‘åŠŸèƒ½
        let isReviewEditMode = false;
        let originalReviewContent = '';
        
        function toggleReviewEdit() {
            const reviewEditArea = document.getElementById('reviewEditArea');
            const reviewPreview = document.getElementById('reviewPreview');
            const reviewEditContent = document.getElementById('reviewEditContent');
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            const editBtn = event.target;
            
            if (!isReviewEditMode) {
                // è¿›å…¥ç¼–è¾‘æ¨¡å¼
                originalReviewContent = reviewPreviewContent.innerText || reviewPreviewContent.textContent;
                
                if (originalReviewContent.trim() === 'è¯·åœ¨å·¦ä¾§è¾“å…¥å•†å“ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„å•†å“è¯„ä»·...') {
                    originalReviewContent = '';
                }
                
                reviewEditContent.value = originalReviewContent;
                reviewEditArea.style.display = 'block';
                reviewPreview.style.display = 'none';
                editBtn.textContent = 'ğŸ‘ï¸ é¢„è§ˆæ¨¡å¼';
                editBtn.style.background = '#28a745';
                isReviewEditMode = true;
            } else {
                // é€€å‡ºç¼–è¾‘æ¨¡å¼
                reviewEditArea.style.display = 'none';
                reviewPreview.style.display = 'block';
                editBtn.textContent = 'âœï¸ ç¼–è¾‘æ¨¡å¼';
                editBtn.style.background = '#007bff';
                isReviewEditMode = false;
                
                // æ›´æ–°é¢„è§ˆå†…å®¹
                const editedContent = reviewEditContent.value.trim();
                if (editedContent) {
                    reviewPreviewContent.innerHTML = editedContent.replace(/\n/g, '<br>');
                } else {
                    reviewPreviewContent.innerHTML = 'è¯·åœ¨å·¦ä¾§è¾“å…¥å•†å“ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„å•†å“è¯„ä»·...';
                }
            }
        }
        
        function saveReviewEdit() {
            const reviewEditContent = document.getElementById('reviewEditContent');
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            const editedContent = reviewEditContent.value.trim();
            
            if (editedContent) {
                reviewPreviewContent.innerHTML = editedContent.replace(/\n/g, '<br>');
                showNotification('âœ… ç¼–è¾‘å†…å®¹å·²ä¿å­˜ï¼');
            } else {
                reviewPreviewContent.innerHTML = 'è¯·åœ¨å·¦ä¾§è¾“å…¥å•†å“ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„å•†å“è¯„ä»·...';
                showNotification('âš ï¸ ç¼–è¾‘å†…å®¹ä¸ºç©ºï¼Œå·²é‡ç½®ä¸ºé»˜è®¤æç¤º');
            }
            
            toggleReviewEdit();
        }
        
        function cancelReviewEdit() {
            const reviewEditContent = document.getElementById('reviewEditContent');
            reviewEditContent.value = originalReviewContent;
            toggleReviewEdit();
            showNotification('âŒ å·²å–æ¶ˆç¼–è¾‘');
        }

        // ç¤¾ç¾¤åŠ©æ‰‹åŠŸèƒ½
        async function generateCommunityContent() {
            const communityType = document.getElementById('communityType').value;
            const communityTheme = document.getElementById('communityTheme').value.trim();
            const communityTarget = document.getElementById('communityTarget').value.trim();
            const communityContent = document.getElementById('communityContent').value.trim();
            const communityTone = document.getElementById('communityTone').value;
            
            if (!communityType || !communityTheme || !communityTarget || !communityContent) {
                alert('è¯·å¡«å†™å®Œæ•´çš„ç¤¾ç¾¤ä¿¡æ¯ï¼');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const communityPreviewContent = document.getElementById('communityPreviewContent');
            communityPreviewContent.innerHTML = 'ğŸ¤– æ­£åœ¨ç”Ÿæˆç¤¾ç¾¤æ–‡æ¡ˆï¼Œè¯·ç¨å€™...';
            
            try {
                // æ„å»ºAPIè¯·æ±‚å†…å®¹
                const apiContent = `ä½ æ˜¯ä¸€ä½ç¤¾ç¾¤è¿è¥ä¸“å®¶ï¼Œè¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ç”Ÿæˆä¸“ä¸šçš„ç¤¾ç¾¤è¿è¥æ–‡æ¡ˆï¼š
                
ç¤¾ç¾¤ç±»å‹ï¼š${getCommunityTypeName(communityType)}
æ´»åŠ¨ä¸»é¢˜ï¼š${communityTheme}
ç›®æ ‡äººç¾¤ï¼š${communityTarget}
æ ¸å¿ƒå†…å®¹ï¼š${communityContent}
æ–‡æ¡ˆé£æ ¼ï¼š${getCommunityToneName(communityTone)}

è¯·ç”ŸæˆåŒ…å«ä»¥ä¸‹è¦ç´ çš„ç¤¾ç¾¤æ–‡æ¡ˆï¼š
1. å¸å¼•äººçš„å¼€åœºç™½
2. æ´»åŠ¨ä»‹ç»å’Œä»·å€¼è¯´æ˜
3. å‚ä¸æ–¹å¼å’Œè§„åˆ™
4. äº’åŠ¨å¼•å¯¼è¯æœ¯
5. ç»“å°¾å‘¼åè¡ŒåŠ¨

æ–‡æ¡ˆè¦æ±‚ï¼šä¸“ä¸šã€æœ‰å¸å¼•åŠ›ã€é€‚åˆç¤¾ç¾¤ä¼ æ’­ã€‚`;
                
                // è°ƒç”¨AI APIç”Ÿæˆå†…å®¹
                await callSiliconFlowAPIForCommunity(apiContent, communityPreviewContent);
                
            } catch (error) {
                console.error('ç¤¾ç¾¤æ–‡æ¡ˆç”Ÿæˆå¤±è´¥:', error);
                // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿç”Ÿæˆ
                const simulatedContent = simulateCommunityGeneration({
                    communityType,
                    communityTheme,
                    communityTarget,
                    communityContent,
                    communityTone
                });
                communityPreviewContent.innerHTML = simulatedContent;
                showNotification('âœ¨ ç¤¾ç¾¤æ–‡æ¡ˆç”Ÿæˆå®Œæˆï¼ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰');
            }
        }
        
        async function callSiliconFlowAPIForCommunity(content, outputElement) {
            const apiUrl = 'https://api.siliconflow.cn/v1/chat/completions';
            const apiKey = 'sk-pyklkjtrarxygqafyidoclbberxhhqbnzmdrafwuuuiusxzd';
            
            const requestBody = {
                model: "deepseek-ai/DeepSeek-V3.1",
                messages: [
                    {
                        role: "user",
                        content: content
                    }
                ],
                stream: true,
                max_tokens: 2000,
                enable_thinking: false,
                thinking_budget: 4096,
                min_p: 0.05,
                stop: null,
                temperature: 0.7,
                top_p: 0.7,
                top_k: 50,
                frequency_penalty: 0.5,
                n: 1,
                response_format: {
                    type: "text"
                }
            };
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });
            
            if (!response.ok) {
                throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
            }
            
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let accumulatedContent = '';
            
            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                
                const chunk = decoder.decode(value);
                const lines = chunk.split('\n');
                
                for (const line of lines) {
                    if (line.startsWith('data: ')) {
                        const data = line.slice(6);
                        if (data === '[DONE]') continue;
                        
                        try {
                            const parsed = JSON.parse(data);
                            const content = parsed.choices?.[0]?.delta?.content || '';
                            if (content) {
                                accumulatedContent += content;
                                outputElement.innerHTML = accumulatedContent.replace(/\n/g, '<br>');
                            }
                        } catch (e) {
                            // å¿½ç•¥è§£æé”™è¯¯
                        }
                    }
                }
            }
            
            showNotification('âœ¨ ç¤¾ç¾¤æ–‡æ¡ˆç”Ÿæˆå®Œæˆï¼');
        }
        
        function simulateCommunityGeneration(data) {
            const { communityType, communityTheme, communityTarget, communityContent, communityTone } = data;
            
            const typeNames = {
                learning: 'å­¦ä¹ äº¤æµç¾¤',
                hobby: 'å…´è¶£çˆ±å¥½ç¾¤',
                product: 'äº§å“ç”¨æˆ·ç¾¤',
                vip: 'VIPå®¢æˆ·ç¾¤',
                activity: 'æ´»åŠ¨ç»„ç»‡ç¾¤',
                industry: 'è¡Œä¸šäº¤æµç¾¤'
            };
            
            const toneNames = {
                warm: 'æ¸©æš–äº²åˆ‡',
                professional: 'ä¸“ä¸šæƒå¨',
                lively: 'æ´»æ³¼æœ‰è¶£',
                formal: 'æ­£å¼åº„é‡',
                casual: 'è½»æ¾éšæ„'
            };
            
            return `ğŸ‰ **ã€${communityTheme}ã€‘** ğŸ‰

äº²çˆ±çš„${communityTarget}ä»¬ï¼Œ

ğŸŒŸ **æ´»åŠ¨ä»‹ç»**
${communityContent}

ğŸ“… **å‚ä¸æ–¹å¼**
â€¢ åœ¨ç¾¤å†…å›å¤"å‚åŠ "å³å¯æŠ¥å
â€¢ æ´»åŠ¨æ—¶é—´ä¸ºæœ¬å‘¨å…­æ™š8ç‚¹
â€¢ åœ°ç‚¹ï¼šçº¿ä¸Šè¯­éŸ³æˆ¿é—´

ğŸ’ **æ´»åŠ¨äº®ç‚¹**
â€¢ ä¸“ä¸šå¯¼å¸ˆåœ¨çº¿æŒ‡å¯¼
â€¢ ä¸åŒé¢‘ä¼™ä¼´æ·±åº¦äº¤æµ
â€¢ è·å¾—ç‹¬å®¶å­¦ä¹ èµ„æ–™
â€¢ æœ‰æœºä¼šè·å¾—ç²¾ç¾ç¤¼å“

ğŸ¤ **äº’åŠ¨å¼•å¯¼**
å¤§å®¶æœ‰ä»€ä¹ˆæƒ³è¦åˆ†äº«æˆ–è€…æƒ³äº†è§£çš„å—ï¼Ÿæ¬¢è¿åœ¨ç¾¤é‡Œç§¯æå‘è¨€ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ‰“é€ ä¸€ä¸ªæ¸©æš–æœ‰çˆ±çš„${typeNames[communityType]}ï¼

â° **æ¸©é¦¨æç¤º**
æ´»åŠ¨åé¢æœ‰é™ï¼Œå…ˆåˆ°å…ˆå¾—å“¦ï¼èµ¶å¿«è¡ŒåŠ¨èµ·æ¥å§ï½

æœŸå¾…ä¸å¤§å®¶çš„ç²¾å½©äº’åŠ¨ï¼ğŸš€

---
#ç¤¾ç¾¤æ´»åŠ¨ #${communityTheme.replace(/\s+/g, '')} #${typeNames[communityType].replace(/\s+/g, '')}`;
        }
        
        function getCommunityTypeName(type) {
            const typeNames = {
                learning: 'å­¦ä¹ äº¤æµç¾¤',
                hobby: 'å…´è¶£çˆ±å¥½ç¾¤',
                product: 'äº§å“ç”¨æˆ·ç¾¤',
                vip: 'VIPå®¢æˆ·ç¾¤',
                activity: 'æ´»åŠ¨ç»„ç»‡ç¾¤',
                industry: 'è¡Œä¸šäº¤æµç¾¤'
            };
            return typeNames[type] || 'ç¤¾ç¾¤';
        }
        
        function getCommunityToneName(tone) {
            const toneNames = {
                warm: 'æ¸©æš–äº²åˆ‡',
                professional: 'ä¸“ä¸šæƒå¨',
                lively: 'æ´»æ³¼æœ‰è¶£',
                formal: 'æ­£å¼åº„é‡',
                casual: 'è½»æ¾éšæ„'
            };
            return toneNames[tone] || 'ä¸“ä¸š';
        }
        
        // æ¸…ç©ºç¤¾ç¾¤åŠ©æ‰‹è¡¨å•
        function clearCommunityForm() {
            document.getElementById('communityType').value = '';
            document.getElementById('communityTheme').value = '';
            document.getElementById('communityTarget').value = '';
            document.getElementById('communityContent').value = '';
            document.getElementById('communityTone').value = '';
            // æ¸…ç©ºç¤¾ç¾¤æ–‡æ¡ˆé¢„è§ˆåŒºåŸŸ
            const communityPreviewContent = document.getElementById('communityPreviewContent');
            if (communityPreviewContent) {
                communityPreviewContent.innerHTML = 'è¯·åœ¨å·¦ä¾§è¾“å…¥ç¤¾ç¾¤ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆç¤¾ç¾¤æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„ç¤¾ç¾¤è¿è¥æ–‡æ¡ˆ...';
            }
        }
        
        // å¤åˆ¶ç¤¾ç¾¤æ–‡æ¡ˆ
        function copyCommunityContent() {
            const communityPreviewContent = document.getElementById('communityPreviewContent');
            let communityContent = '';
            
            if (communityPreviewContent) {
                communityContent = communityPreviewContent.innerText || communityPreviewContent.textContent;
            }
            
            if (!communityContent.trim() || communityContent.trim() === 'è¯·åœ¨å·¦ä¾§è¾“å…¥ç¤¾ç¾¤ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆç¤¾ç¾¤æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„ç¤¾ç¾¤è¿è¥æ–‡æ¡ˆ...') {
                alert('æ²¡æœ‰å¯å¤åˆ¶çš„ç¤¾ç¾¤æ–‡æ¡ˆï¼');
                return;
            }
            
            navigator.clipboard.writeText(communityContent).then(() => {
                showNotification('âœ… ç¤¾ç¾¤æ–‡æ¡ˆå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(err => {
                // é™çº§æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = communityContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('âœ… ç¤¾ç¾¤æ–‡æ¡ˆå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }
        
        // ç¤¾ç¾¤æ–‡æ¡ˆç¼–è¾‘åŠŸèƒ½
        let isCommunityEditMode = false;
        let originalCommunityContent = '';
        
        function toggleCommunityEdit() {
            const communityEditArea = document.getElementById('communityEditArea');
            const communityPreview = document.getElementById('communityPreview');
            const communityEditContent = document.getElementById('communityEditContent');
            const communityPreviewContent = document.getElementById('communityPreviewContent');
            const editBtn = event.target;
            
            if (!isCommunityEditMode) {
                // è¿›å…¥ç¼–è¾‘æ¨¡å¼
                originalCommunityContent = communityPreviewContent.innerText || communityPreviewContent.textContent;
                
                if (originalCommunityContent.trim() === 'è¯·åœ¨å·¦ä¾§è¾“å…¥ç¤¾ç¾¤ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆç¤¾ç¾¤æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„ç¤¾ç¾¤è¿è¥æ–‡æ¡ˆ...') {
                    originalCommunityContent = '';
                }
                
                communityEditContent.value = originalCommunityContent;
                communityEditArea.style.display = 'block';
                communityPreview.style.display = 'none';
                editBtn.textContent = 'ğŸ‘ï¸ é¢„è§ˆæ¨¡å¼';
                editBtn.style.background = '#28a745';
                isCommunityEditMode = true;
            } else {
                // é€€å‡ºç¼–è¾‘æ¨¡å¼
                communityEditArea.style.display = 'none';
                communityPreview.style.display = 'block';
                editBtn.textContent = 'âœï¸ ç¼–è¾‘æ¨¡å¼';
                editBtn.style.background = '#007bff';
                isCommunityEditMode = false;
                
                // æ›´æ–°é¢„è§ˆå†…å®¹
                const editedContent = communityEditContent.value.trim();
                if (editedContent) {
                    communityPreviewContent.innerHTML = editedContent.replace(/\n/g, '<br>');
                } else {
                    communityPreviewContent.innerHTML = 'è¯·åœ¨å·¦ä¾§è¾“å…¥ç¤¾ç¾¤ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆç¤¾ç¾¤æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„ç¤¾ç¾¤è¿è¥æ–‡æ¡ˆ...';
                }
            }
        }
        
        function saveCommunityEdit() {
            const communityEditContent = document.getElementById('communityEditContent');
            const communityPreviewContent = document.getElementById('communityPreviewContent');
            const editedContent = communityEditContent.value.trim();
            
            if (editedContent) {
                communityPreviewContent.innerHTML = editedContent.replace(/\n/g, '<br>');
                showNotification('âœ… ç¼–è¾‘å†…å®¹å·²ä¿å­˜ï¼');
            } else {
                communityPreviewContent.innerHTML = 'è¯·åœ¨å·¦ä¾§è¾“å…¥ç¤¾ç¾¤ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆç¤¾ç¾¤æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„ç¤¾ç¾¤è¿è¥æ–‡æ¡ˆ...';
                showNotification('âš ï¸ ç¼–è¾‘å†…å®¹ä¸ºç©ºï¼Œå·²é‡ç½®ä¸ºé»˜è®¤æç¤º');
            }
            
            toggleCommunityEdit();
        }
        
        function cancelCommunityEdit() {
            const communityEditContent = document.getElementById('communityEditContent');
            communityEditContent.value = originalCommunityContent;
            toggleCommunityEdit();
            showNotification('âŒ å·²å–æ¶ˆç¼–è¾‘');
        }

        // ç½‘ç»œè¿æ¥æµ‹è¯•åŠŸèƒ½
        async function testNetworkConnection() {
            console.log('ğŸŒ å¼€å§‹ç½‘ç»œè¿æ¥æµ‹è¯•...');
            showNotification('ğŸŒ æ­£åœ¨æµ‹è¯•ç½‘ç»œè¿æ¥...');
            
            const testResults = [];
            
            // æµ‹è¯•1: åŸºç¡€ç½‘ç»œè¿æ¥
            try {
                const response = await fetch('https://httpbin.org/get', {
                    method: 'GET',
                    signal: AbortSignal.timeout(5000)
                });
                if (response.ok) {
                    testResults.push('âœ… åŸºç¡€ç½‘ç»œè¿æ¥æ­£å¸¸');
                } else {
                    testResults.push('âŒ åŸºç¡€ç½‘ç»œè¿æ¥å¤±è´¥');
                }
            } catch (error) {
                testResults.push(`âŒ åŸºç¡€ç½‘ç»œè¿æ¥å¼‚å¸¸: ${error.message}`);
            }
            
            // æµ‹è¯•2: APIç«¯ç‚¹è¿æ¥
            const endpoints = [
                'https://open-api.biji.com/getnote/openapi',
                'https://proxy.cors.sh/https://open-api.biji.com/getnote/openapi',
                'https://corsproxy.io/?https://open-api.biji.com/getnote/openapi'
            ];
            
            for (let i = 0; i < endpoints.length; i++) {
                try {
                    const response = await fetch(endpoints[i], {
                        method: 'OPTIONS', // ä½¿ç”¨OPTIONSæµ‹è¯•CORS
                        signal: AbortSignal.timeout(8000)
                    });
                    testResults.push(`âœ… ç«¯ç‚¹${i + 1}å¯è®¿é—®: ${endpoints[i]}`);
                    break; // æ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„å°±åœæ­¢
                } catch (error) {
                    testResults.push(`âŒ ç«¯ç‚¹${i + 1}å¤±è´¥: ${error.message}`);
                }
            }
            
            // æµ‹è¯•3: CORSä»£ç†æœåŠ¡
            try {
                const response = await fetch('https://proxy.cors.sh/https://httpbin.org/get', {
                    method: 'GET',
                    signal: AbortSignal.timeout(5000)
                });
                if (response.ok) {
                    testResults.push('âœ… CORSä»£ç†æœåŠ¡å¯ç”¨');
                } else {
                    testResults.push('âŒ CORSä»£ç†æœåŠ¡ä¸å¯ç”¨');
                }
            } catch (error) {
                testResults.push(`âŒ CORSä»£ç†æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
            
            console.log('ç½‘ç»œæµ‹è¯•ç»“æœ:', testResults);
            
            // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
            const resultMessage = testResults.join('\n');
            alert(`ğŸŒ ç½‘ç»œè¿æ¥æµ‹è¯•ç»“æœï¼š\n\n${resultMessage}\n\nå»ºè®®:\n1. å¦‚æœåŸºç¡€ç½‘ç»œå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®\n2. å¦‚æœAPIç«¯ç‚¹éƒ½å¤±è´¥ï¼ŒAPIæœåŠ¡å¯èƒ½æš‚æ—¶ä¸å¯ç”¨\n3. å¦‚æœCORSä»£ç†å¤±è´¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°è¯•å…¶ä»–æ–¹æ¡ˆ`);
            
            showNotification('ğŸŒ ç½‘ç»œæµ‹è¯•å®Œæˆï¼Œè¯·æŸ¥çœ‹ç»“æœ');
        }
        
        // æµ‹è¯•getç¬”è®°APIè¿æ¥
        async function testGetNoteAPI() {
            console.log('ğŸ§ª å¼€å§‹æµ‹è¯•getç¬”è®°APIè¿æ¥...');
            
            const apiKey = 'sk-khczjbhzxxujbizmolqceicevnyckmddrhtgbhiyhfkzaujs';
            const knowledgeBaseId = 'yYv22aLY';
            
            // æµ‹è¯•ä¸åŒçš„APIç«¯ç‚¹
            const testEndpoints = [
                `https://api.getbiji.com/openapi/knowledge/${knowledgeBaseId}`, // è·å–çŸ¥è¯†åº“ä¿¡æ¯
                `https://api.getbiji.com/openapi/knowledge/${knowledgeBaseId}/search?q=test&limit=1`, // ç®€å•æœç´¢
                'https://api.getbiji.com/openapi/user/profile', // ç”¨æˆ·ä¿¡æ¯
                'https://api.getbiji.com/openapi/auth/test' // è®¤è¯æµ‹è¯•
            ];
            
            for (let i = 0; i < testEndpoints.length; i++) {
                const endpoint = testEndpoints[i];
                console.log(`\nğŸ”„ æµ‹è¯•ç«¯ç‚¹ ${i + 1}: ${endpoint}`);
                
                try {
                    const response = await fetch(endpoint, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        signal: AbortSignal.timeout(10000)
                    });
                    
                    console.log(`ğŸ“Š å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`);
                    
                    const responseText = await response.text();
                    console.log(`ğŸ“„ å“åº”å†…å®¹: ${responseText.substring(0, 200)}${responseText.length > 200 ? '...' : ''}`);
                    
                    if (response.ok) {
                        console.log('âœ… æ­¤ç«¯ç‚¹è¿æ¥æˆåŠŸï¼');
                        return { success: true, endpoint: endpoint, data: responseText };
                    } else {
                        console.log(`âŒ æ­¤ç«¯ç‚¹å¤±è´¥: ${response.status}`);
                    }
                    
                } catch (error) {
                    console.error(`âŒ ç«¯ç‚¹æµ‹è¯•å¤±è´¥: ${error.message}`);
                }
            }
            
            return { success: false, message: 'æ‰€æœ‰ç«¯ç‚¹æµ‹è¯•å¤±è´¥' };
        }

        // å£æ’­åŠ©æ‰‹åŠŸèƒ½ - AIæœç´¢æŒ‰é’®
        async function generateVoiceover() {
            const topic = document.getElementById('voiceoverTopic').value.trim();
            const voiceoverMaterial = document.getElementById('voiceoverMaterial');
            
            if (!topic) {
                alert('è¯·è¾“å…¥è§†é¢‘ä¸»é¢˜ï¼');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            if (voiceoverMaterial) {
                voiceoverMaterial.value = 'ğŸ¤– æ­£åœ¨æœç´¢ç›¸å…³ç¬”è®°ç´ æï¼Œè¯·ç¨å€™...';
            }
            
            try {
                // é¦–å…ˆæµ‹è¯•ç½‘ç»œè¿æ¥
                console.log('ğŸ” å¼€å§‹æµ‹è¯•ç½‘ç»œè¿æ¥...');
                try {
                    const testResponse = await fetch('https://httpbin.org/get', {
                        method: 'GET',
                        signal: AbortSignal.timeout(5000)
                    });
                    console.log('âœ… ç½‘ç»œè¿æ¥æ­£å¸¸ï¼Œå¯ä»¥è®¿é—®å¤–éƒ¨API');
                } catch (networkTestError) {
                    console.error('âŒ ç½‘ç»œè¿æ¥æµ‹è¯•å¤±è´¥:', networkTestError.message);
                    throw new Error(`ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼š${networkTestError.message}ã€‚è¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®æˆ–é˜²ç«å¢™é…ç½®ã€‚`);
                }
                
                // æµ‹è¯•getç¬”è®°API
                console.log('ğŸ”‘ æµ‹è¯•getç¬”è®°APIè¿æ¥...');
                const apiTestResult = await testGetNoteAPI();
                if (apiTestResult.success) {
                    console.log('âœ… getç¬”è®°APIè¿æ¥æˆåŠŸï¼');
                } else {
                    console.warn('âš ï¸ getç¬”è®°APIè¿æ¥å¤±è´¥ï¼Œå°†ä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæœç´¢');
                }
                
                // è°ƒç”¨ç¬”è®°çŸ¥è¯†åº“APIè·å–ç›¸å…³ç´ æ
                const apiKey = 'sk-khczjbhzxxujbizmolqceicevnyckmddrhtgbhiyhfkzaujs';
                const knowledgeBaseId = 'yYv22aLY';
                
                // æ„å»ºæœç´¢è¯·æ±‚
                const searchContent = `æœç´¢ä¸"${topic}"ç›¸å…³çš„ç¬”è®°å†…å®¹ï¼ŒåŒ…æ‹¬å®ç”¨æŠ€å·§ã€æ¡ˆä¾‹åˆ†æå’Œæ ¸å¿ƒè¦ç‚¹`;
                
                // å®šä¹‰å¤šä¸ªå¤‡ç”¨ç«¯ç‚¹ï¼ˆå¤„ç†CORSé—®é¢˜ï¼‰
                const endpoints = [
                    // å°è¯•ä½¿ç”¨ç¡…åŸºæµåŠ¨çš„APIä½œä¸ºæ›¿ä»£æ–¹æ¡ˆ
                    'https://api.siliconflow.cn/v1/chat/completions',
                    // åŸå§‹getç¬”è®°API
                    'https://api.getbiji.com/openapi/knowledge/search',
                    'https://proxy.cors.sh/https://api.getbiji.com/openapi/knowledge/search', // CORSä»£ç† (æ¨è)
                    'https://corsproxy.io/?' + encodeURIComponent('https://api.getbiji.com/openapi/knowledge/search') // å¤‡ç”¨ä»£ç†
                ];
                
                let response = null;
                let lastError = null;
                
                // å°è¯•å¤šä¸ªç«¯ç‚¹
                for (let i = 0; i < endpoints.length; i++) {
                    const endpoint = endpoints[i];
                    console.log(`å°è¯•ç«¯ç‚¹ ${i + 1}/${endpoints.length}:`, endpoint);
                    
                    try {
                        let fetchOptions;
                        
                        if (i === 0) {
                            // ç¡…åŸºæµåŠ¨APIé…ç½® - æ¨¡æ‹Ÿgetç¬”è®°çŸ¥è¯†åº“å†…å®¹
                            fetchOptions = {
                                method: 'POST',
                                headers: {
                                    'Authorization': `Bearer sk-pyklkjtrarxygqafyidoclbberxhhqbnzmdrafwuuuiusxzd`,
                                    'Content-Type': 'application/json',
                                    'Accept': 'application/json, text/plain, */*',
                                    'Cache-Control': 'no-cache',
                                    'Pragma': 'no-cache'
                                },
                                body: JSON.stringify({
                                    model: "deepseek-ai/DeepSeek-V3.1",
                                    messages: [
                                        {
                                            role: "system",
                                            content: "ä½ æ˜¯ä¸€ä¸ªçŸ¥è¯†åº“åŠ©æ‰‹ã€‚è¯·æ¨¡æ‹Ÿä¸€ä¸ªåŒ…å«ä¸°å¯Œç¬”è®°å†…å®¹çš„çŸ¥è¯†åº“ï¼Œæ ¹æ®ç”¨æˆ·æä¾›çš„ä¸»é¢˜ï¼Œç”Ÿæˆç›¸å…³çš„çŸ¥è¯†å†…å®¹ã€‚å†…å®¹è¦å®ç”¨ã€å…·ä½“ï¼Œé€‚åˆå°çº¢ä¹¦åˆ›ä½œã€‚è¯·æŒ‰ç…§ä»¥ä¸‹æ ¼å¼å›å¤ï¼š"
                                        },
                                        {
                                            role: "user",
                                            content: `ä¸»é¢˜ï¼š"${topic}"

è¯·æä¾›3-5ä¸ªç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹åŒ…å«ï¼š
1. ç®€æ´çš„æ ‡é¢˜
2. å…·ä½“çš„å®ç”¨å†…å®¹
3. ç›¸å…³çš„å°è´´å£«

æ ¼å¼ç¤ºä¾‹ï¼š
ğŸ“š çŸ¥è¯†ç‚¹1ï¼š[æ ‡é¢˜]
å†…å®¹ï¼š[å…·ä½“çš„å®ç”¨å†…å®¹]
ğŸ’¡ å°è´´å£«ï¼š[ç›¸å…³å»ºè®®]

è¯·ç¡®ä¿å†…å®¹çœŸå®æœ‰ç”¨ï¼Œé€‚åˆå°çº¢ä¹¦å†…å®¹åˆ›ä½œã€‚`
                                        }
                                    ],
                                    stream: false,
                                    max_tokens: 2000,
                                    temperature: 0.7
                                }),
                                signal: AbortSignal.timeout(30000),
                                mode: 'cors',
                                credentials: 'omit'
                            };
                        } else {
                            // getç¬”è®°APIé…ç½®
                            fetchOptions = {
                                method: 'POST',
                                headers: {
                                    'Authorization': `Bearer ${apiKey}`,
                                    'Content-Type': 'application/json',
                                    'Accept': 'application/json',
                                    'Cache-Control': 'no-cache',
                                    'Pragma': 'no-cache'
                                },
                                body: JSON.stringify({
                                    knowledgeBaseId: knowledgeBaseId,
                                    query: searchContent,
                                    maxResults: 10,
                                    searchType: 'semantic' // è¯­ä¹‰æœç´¢
                                }),
                                signal: AbortSignal.timeout(30000),
                                mode: 'cors',
                                credentials: 'omit'
                            };
                        }
                        
                        response = await fetch(endpoint, fetchOptions);
                        
                        console.log(`ç«¯ç‚¹ ${i + 1} å“åº”æˆåŠŸ:`, response.status);
                        break; // æˆåŠŸåˆ™è·³å‡ºå¾ªç¯
                        
                    } catch (endpointError) {
                        console.error(`ç«¯ç‚¹ ${i + 1} å¤±è´¥:`, endpointError.message);
                        lastError = endpointError;
                        
                        // å¦‚æœæ˜¯æœ€åä¸€ä¸ªç«¯ç‚¹ï¼ŒæŠ›å‡ºé”™è¯¯
                        if (i === endpoints.length - 1) {
                            throw lastError;
                        }
                        
                        // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªç«¯ç‚¹
                        continue;
                    }
                }
                
                console.log('APIè°ƒç”¨ä¿¡æ¯:', {
                    apiKey: apiKey.substring(0, 10) + '...',
                    knowledgeBaseId: knowledgeBaseId,
                    searchContent: searchContent,
                    endpoint: response?.url || 'unknown',
                    headers: {
                        'Authorization': 'Bearer ' + apiKey.substring(0, 10) + '...',
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });
                
                console.log('APIå“åº”çŠ¶æ€:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('APIé”™è¯¯è¯¦æƒ…:', errorText);
                    
                    // æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„é”™è¯¯ç å¤„ç†
                    if (response.status === 401) {
                        throw new Error(`APIè¯·æ±‚å¤±è´¥: 401 - æœªæˆæƒã€‚APIå¯†é’¥æ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œè¯·æ£€æŸ¥Bearer Tokené…ç½®ã€‚`);
                    } else if (response.status === 403) {
                        throw new Error(`APIè¯·æ±‚å¤±è´¥: 403 - æƒé™è¢«æ‹’ç»ã€‚è¯·æ£€æŸ¥ï¼š\n1. APIå¯†é’¥æ˜¯å¦æ­£ç¡®ä¸”æœ‰æ•ˆ\n2. çŸ¥è¯†åº“ID "${knowledgeBaseId}" æ˜¯å¦å­˜åœ¨ä¸”å¯è®¿é—®\n3. è´¦æˆ·æ˜¯å¦å¼€é€šäº†çŸ¥è¯†åº“æœç´¢æƒé™`);
                    } else if (response.status === 404) {
                        throw new Error(`APIè¯·æ±‚å¤±è´¥: 404 - æ¥å£ä¸å­˜åœ¨ã€‚è¯·ç¡®è®¤ä½¿ç”¨çš„APIç«¯ç‚¹æ˜¯å¦æ­£ç¡®ã€‚\né”™è¯¯è¯¦æƒ…: ${errorText}`);
                    } else if (response.status === 429) {
                        throw new Error(`APIè¯·æ±‚å¤±è´¥: 429 - è¯·æ±‚è¿‡äºé¢‘ç¹ã€‚è¯·ç¨åå†è¯•ã€‚`);
                    } else if (response.status >= 500) {
                        throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} - æœåŠ¡å™¨é”™è¯¯ã€‚getç¬”è®°æœåŠ¡å¯èƒ½æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚\né”™è¯¯è¯¦æƒ…: ${errorText}`);
                    }
                    
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} - ${response.statusText}\né”™è¯¯è¯¦æƒ…: ${errorText}`);
                }
                
                // è·å–å“åº”æ•°æ®
                const responseData = await response.json();
                console.log('APIå“åº”æ•°æ®:', responseData);
                
                // å¤„ç†å“åº”æ•°æ®
                let accumulatedContent = '';
                
                if (responseData.choices && responseData.choices.length > 0) {
                    // OpenAIå…¼å®¹æ ¼å¼ï¼ˆç¡…åŸºæµåŠ¨APIï¼‰- æ¨¡æ‹ŸçŸ¥è¯†åº“å†…å®¹
                    const aiResponse = responseData.choices[0].message.content;
                    
                    // æ ¼å¼åŒ–AIå“åº”ä¸ºçŸ¥è¯†åº“é£æ ¼
                    accumulatedContent = `ğŸ“š æ¥è‡ªçŸ¥è¯†åº“çš„å†…å®¹\n\n${aiResponse}`;
                    
                    // å¦‚æœå†…å®¹è¾ƒé•¿ï¼Œæ·»åŠ ç´¢å¼•
                    if (aiResponse.length > 500) {
                        const sections = aiResponse.split(/ğŸ“š|ğŸ’¡/);
                        if (sections.length > 1) {
                            accumulatedContent = `ğŸ“š çŸ¥è¯†åº“æœç´¢ç»“æœ (æ‰¾åˆ° ${sections.length - 1} ä¸ªç›¸å…³å†…å®¹)\n\n${aiResponse}`;
                        }
                    }
                    
                } else if (responseData.data && responseData.data.results) {
                    // æ ‡å‡†çŸ¥è¯†åº“æœç´¢ç»“æœæ ¼å¼ï¼ˆgetç¬”è®°APIï¼‰
                    const results = responseData.data.results;
                    accumulatedContent = results.map((result, index) => {
                        return `${index + 1}. ${result.title || result.content || result.text || 'æ— æ ‡é¢˜'}\n${result.content || result.text || ''}`;
                    }).join('\n\n');
                } else if (responseData.results && Array.isArray(responseData.results)) {
                    // å¦ä¸€ç§çŸ¥è¯†åº“æ ¼å¼
                    accumulatedContent = responseData.results.map((result, index) => {
                        return `${index + 1}. ${result.title || 'ç›¸å…³çŸ¥è¯†'}\n${result.content || result.text || result.snippet || ''}`;
                    }).join('\n\n');
                } else if (responseData.content) {
                    // ç®€å•å†…å®¹æ ¼å¼
                    accumulatedContent = responseData.content;
                } else {
                    // æœªçŸ¥æ ¼å¼ï¼Œæ˜¾ç¤ºåŸå§‹æ•°æ®
                    accumulatedContent = JSON.stringify(responseData, null, 2);
                }
                
                if (voiceoverMaterial) {
                    voiceoverMaterial.value = `ğŸ“š æœç´¢åˆ°çš„ç›¸å…³ç¬”è®°ç´ æï¼š\n\n${accumulatedContent}`;
                }
                
                showNotification('âœ… ç¬”è®°ç´ ææœç´¢å®Œæˆï¼');
                
            } catch (error) {
                console.error('ç¬”è®°çŸ¥è¯†åº“APIè°ƒç”¨å¤±è´¥:', error);
                console.error('é”™è¯¯è¯¦æƒ…:', {
                    message: error.message,
                    name: error.name,
                    stack: error.stack,
                    // æ£€æŸ¥æ˜¯å¦æ˜¯ç½‘ç»œç›¸å…³é”™è¯¯
                    isNetworkError: error.message.includes('Failed to fetch') || error.message.includes('network'),
                    isTimeoutError: error.message.includes('timeout') || error.message.includes('è¶…æ—¶'),
                    isCORSError: error.message.includes('CORS') || error.message.includes('è·¨åŸŸ')
                });
                
                // æä¾›æœ¬åœ°æ¨¡æ‹Ÿæœç´¢ä½œä¸ºæœ€åæ‰‹æ®µ
                console.log('ğŸ”„ å°è¯•æœ¬åœ°æ¨¡æ‹Ÿæœç´¢åŠŸèƒ½...');
                simulateLocalSearch(topic);
                
                // æ˜¾ç¤ºé”™è¯¯é€šçŸ¥
                showNotification('âš ï¸ ç¬”è®°ç´ ææœç´¢å¤±è´¥ï¼Œå·²æä¾›æœ¬åœ°çŸ¥è¯†åº“å†…å®¹');
            }
        }
        
        // æœ¬åœ°æ¨¡æ‹Ÿæœç´¢åŠŸèƒ½ï¼ˆå½“APIä¸å¯ç”¨æ—¶ï¼‰
        function simulateLocalSearch(topic) {
            console.log('ğŸ“š ä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæœç´¢ï¼Œä¸»é¢˜:', topic);
            
            // æ‰©å±•çš„æ¨¡æ‹ŸçŸ¥è¯†åº“å†…å®¹
            const mockKnowledgeBase = {
                'å­¦ä¹ æ–¹æ³•': [
                    'è´¹æ›¼å­¦ä¹ æ³•ï¼šé€šè¿‡æ•™æˆä»–äººæ¥æ£€éªŒè‡ªå·±çš„ç†è§£ç¨‹åº¦',
                    'é—´éš”é‡å¤ï¼šåˆ©ç”¨è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿å®‰æ’å¤ä¹ æ—¶é—´',
                    'ä¸»åŠ¨å›å¿†ï¼šå­¦ä¹ ååˆä¸Šä¹¦æµ‹è¯•è‡ªå·±èƒ½è®°ä½å¤šå°‘å†…å®¹',
                    'å¤šæ„Ÿå®˜å­¦ä¹ ï¼šç»“åˆè§†è§‰ã€å¬è§‰ã€åŠ¨æ‰‹å®è·µæ¥æé«˜å­¦ä¹ æ•ˆæœ'
                ],
                'æ—¶é—´ç®¡ç†': [
                    'ç•ªèŒ„å·¥ä½œæ³•ï¼š25åˆ†é’Ÿä¸“æ³¨å·¥ä½œï¼Œ5åˆ†é’Ÿä¼‘æ¯',
                    'å››è±¡é™æ³•åˆ™ï¼šæŒ‰é‡è¦ç´§æ€¥ç¨‹åº¦åˆ†ç±»å¤„ç†ä»»åŠ¡',
                    'æ—¶é—´å—è§„åˆ’ï¼šä¸ºä¸åŒç±»å‹ä»»åŠ¡åˆ†é…ä¸“é—¨çš„æ—¶é—´æ®µ',
                    'GTDæ–¹æ³•ï¼šæ”¶é›†ã€æ•´ç†ã€ç»„ç»‡ã€å›é¡¾ã€æ‰§è¡Œäº”ä¸ªæ­¥éª¤'
                ],
                'å†™ä½œæŠ€å·§': [
                    'é‡‘å­—å¡”åŸç†ï¼šå…ˆç»“è®ºåè®ºæ®ï¼Œé€»è¾‘æ¸…æ™°çš„è¡¨è¾¾ç»“æ„',
                    'SCQAæ¨¡å‹ï¼šæƒ…å¢ƒ-å†²çª-é—®é¢˜-ç­”æ¡ˆçš„æ•…äº‹åŒ–å†™ä½œæ¡†æ¶',
                    'é‡‘å¥æç‚¼ï¼šå°†å¤æ‚æ¦‚å¿µæ€»ç»“ä¸ºæ˜“è®°çš„çŸ­å¥',
                    'ç”¨æˆ·æ€ç»´ï¼šç«™åœ¨è¯»è€…è§’åº¦æ€è€ƒä»–ä»¬çœŸæ­£å…³å¿ƒçš„é—®é¢˜'
                ],
                'èŒåœºå‘å±•': [
                    'ä¸ªäººå“ç‰Œï¼šåœ¨ä¸“ä¸šé¢†åŸŸå»ºç«‹å¯è¯†åˆ«çš„ç‹¬ç‰¹ä»·å€¼',
                    'å‘ä¸Šç®¡ç†ï¼šä¸»åŠ¨æ²Ÿé€šã€åŠæ—¶åé¦ˆã€è¶…é¢„æœŸå®Œæˆå·¥ä½œ',
                    'è·¨éƒ¨é—¨åä½œï¼šç†è§£ä¸åŒéƒ¨é—¨KPIï¼Œæ‰¾åˆ°å…±åŒåˆ©ç›Šç‚¹',
                    'æŒç»­å­¦ä¹ ï¼šä¿æŒå¯¹æ–°çŸ¥è¯†ã€æ–°æŠ€èƒ½çš„æ•æ„Ÿåº¦å’Œå­¦ä¹ çƒ­æƒ…'
                ],
                'å® ç‰©': [
                    'å® ç‰©åŒ»é™¢é€‰æ‹©ï¼šçœ‹èµ„è´¨ã€è®¾å¤‡ã€åŒ»ç”Ÿç»éªŒä¸‰å¤§è¦ç´ ',
                    'å® ç‰©å¥åº·ç›‘æµ‹ï¼šæ—¥å¸¸è§‚å¯Ÿé£Ÿæ¬²ã€ç²¾ç¥çŠ¶æ€ã€æ’æ³„æƒ…å†µ',
                    'å® ç‰©ç–«è‹—æ¥ç§ï¼šæŒ‰æ—¶æ¥ç§æ ¸å¿ƒç–«è‹—ï¼Œå»ºç«‹å…ç–«å±éšœ',
                    'å® ç‰©æ€¥æ•‘çŸ¥è¯†ï¼šæŒæ¡åŸºæœ¬æ€¥æ•‘æŠ€èƒ½ï¼Œå…³é”®æ—¶åˆ»æ•‘å‘½'
                ],
                'åŒ»é™¢': [
                    'åŒ»é™¢ç­‰çº§åˆ’åˆ†ï¼šä¸‰ç”²åŒ»é™¢ç»¼åˆå®åŠ›æœ€å¼ºï¼Œä¸“ç§‘ç‰¹è‰²æ˜æ˜¾',
                    'å°±åŒ»æµç¨‹ä¼˜åŒ–ï¼šæå‰é¢„çº¦ã€å‡†å¤‡ç—…å†ã€æ˜ç¡®ä¸»è¯‰ç—‡çŠ¶',
                    'åŒ»æ‚£æ²Ÿé€šæŠ€å·§ï¼šæ¸…æ™°è¡¨è¾¾ç—‡çŠ¶ã€è®¤çœŸå¬å–åŒ»å˜±ã€åŠæ—¶åé¦ˆ',
                    'åŒ»ç–—è´¹ç”¨æ§åˆ¶ï¼šäº†è§£åŒ»ä¿æ”¿ç­–ã€åˆç†é€‰æ‹©æ£€æŸ¥é¡¹ç›®'
                ],
                'ç›®æ ‡': [
                    'SMARTç›®æ ‡æ³•åˆ™ï¼šå…·ä½“ã€å¯è¡¡é‡ã€å¯è¾¾æˆã€ç›¸å…³æ€§ã€æ—¶é™æ€§',
                    'ç›®æ ‡åˆ†è§£æŠ€å·§ï¼šå¤§ç›®æ ‡æ‹†åˆ†ä¸ºå°ç›®æ ‡ï¼Œé€æ­¥è¾¾æˆ',
                    'ç›®æ ‡è¿½è¸ªæ–¹æ³•ï¼šå®šæœŸæ£€æŸ¥è¿›åº¦ï¼ŒåŠæ—¶è°ƒæ•´ç­–ç•¥',
                    'ç›®æ ‡æ¿€åŠ±æœºåˆ¶ï¼šè®¾å®šå¥–åŠ±æœºåˆ¶ï¼Œä¿æŒæ‰§è¡ŒåŠ¨åŠ›'
                ],
                'æŠ¤è‚¤': [
                    'æŠ¤è‚¤åŸºç¡€æ­¥éª¤ï¼šæ¸…æ´ã€çˆ½è‚¤ã€ç²¾åã€ä¹³æ¶²ã€é˜²æ™’äº”æ­¥æ³•',
                    'è‚¤è´¨åˆ¤æ–­æ–¹æ³•ï¼šæ´—è„¸åä¸æ¶‚æŠ¤è‚¤å“ï¼Œè§‚å¯Ÿç´§ç»·æ„Ÿå’Œå‡ºæ²¹æƒ…å†µ',
                    'æˆåˆ†æ­é…åŸåˆ™ï¼šç»´Cé…ç»´Eå¢å¼ºæŠ—æ°§åŒ–ï¼Œé…¸ç±»æˆåˆ†é¿å…æ··ç”¨',
                    'æŠ¤è‚¤å“é€‰æ‹©ï¼šçœ‹æˆåˆ†è¡¨ã€å“ç‰Œä¿¡èª‰ã€ä¸ªäººè‚¤è´¨é€‚é…åº¦'
                ],
                'ç¾é£Ÿ': [
                    'é£Ÿææ–°é²œåˆ¤æ–­ï¼šçœ‹é¢œè‰²ã€é—»æ°”å‘³ã€æ‘¸è´¨åœ°ç»¼åˆåˆ¤æ–­',
                    'çƒ¹é¥ªæŠ€å·§æŒæ¡ï¼šç«å€™æ§åˆ¶ã€è°ƒå‘³å¹³è¡¡ã€æ—¶é—´æŠŠæ¡æ˜¯å…³é”®',
                    'è¥å…»æ­é…åŸåˆ™ï¼šè›‹ç™½è´¨ã€ç»´ç”Ÿç´ ã€ç¢³æ°´åŒ–åˆç‰©å‡è¡¡æ‘„å…¥',
                    'é£Ÿå“å®‰å…¨æ³¨æ„ï¼šç”Ÿç†Ÿåˆ†å¼€ã€å……åˆ†åŠ çƒ­ã€å¦¥å–„ä¿å­˜'
                ],
                'æ—…è¡Œ': [
                    'æ—…è¡Œæ”»ç•¥åˆ¶å®šï¼šç¡®å®šç›®çš„åœ°ã€è§„åˆ’è·¯çº¿ã€é¢„è®¢ä½å®¿äº¤é€š',
                    'è¡Œææ‰“åŒ…æŠ€å·§ï¼šæ ¹æ®å¤©æ°”ã€æ´»åŠ¨ç±»å‹ã€æ—…è¡Œå¤©æ•°åˆç†é…ç½®',
                    'æ—…è¡Œå®‰å…¨æ³¨æ„ï¼šä¿ç®¡è¯ä»¶ã€äº†è§£å½“åœ°é£ä¿—ã€è´­ä¹°ä¿é™©',
                    'é¢„ç®—æ§åˆ¶æ–¹æ³•ï¼šæå‰è§„åˆ’ã€ç•™æœ‰ä½™åœ°ã€è®°å½•å¼€æ”¯'
                ]
            };
            
            let searchResults = [];
            let matchedKeywords = [];
            
            // æœç´¢åŒ¹é…çš„ä¸»é¢˜ï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰
            for (const [key, content] of Object.entries(mockKnowledgeBase)) {
                if (topic.includes(key) || key.includes(topic)) {
                    searchResults = searchResults.concat(content);
                    matchedKeywords.push(key);
                }
            }
            
            // å¦‚æœæ²¡æœ‰ç²¾ç¡®åŒ¹é…ï¼Œå°è¯•å…³é”®è¯æå–åŒ¹é…
            if (searchResults.length === 0) {
                // æå–ä¸»é¢˜ä¸­çš„å…³é”®è¯è¿›è¡ŒåŒ¹é…
                const keywords = topic.match(/[\u4e00-\u9fa5]{2,}/g) || [];
                console.log('æå–çš„å…³é”®è¯:', keywords);
                
                for (const keyword of keywords) {
                    for (const [key, content] of Object.entries(mockKnowledgeBase)) {
                        if (key.includes(keyword) || keyword.includes(key)) {
                            searchResults = searchResults.concat(content);
                            matchedKeywords.push(key);
                        }
                    }
                }
            }
            
            // å»é‡
            searchResults = [...new Set(searchResults)];
            
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›¸å…³å†…å®¹ï¼Œæä¾›åŸºäºä¸»é¢˜çš„ä¸ªæ€§åŒ–å»ºè®®
            if (searchResults.length === 0) {
                console.log('æœªæ‰¾åˆ°åŒ¹é…å†…å®¹ï¼Œç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®');
                searchResults = generatePersonalizedAdvice(topic);
            }
            
            // æ ¼å¼åŒ–æœç´¢ç»“æœ
            let formattedResults = '';
            if (matchedKeywords.length > 0) {
                formattedResults += `ğŸ” åŒ¹é…åˆ°ä¸»é¢˜ï¼š${matchedKeywords.join('ã€')}\n\n`;
            }
            formattedResults += `ğŸ“š æœ¬åœ°çŸ¥è¯†åº“æœç´¢ç»“æœï¼š\n\n${searchResults.map((item, index) => `${index + 1}. ${item}`).join('\n\n')}`;
            
            if (voiceoverMaterial) {
                voiceoverMaterial.value = formattedResults;
            }
            
            console.log('âœ… æœ¬åœ°æ¨¡æ‹Ÿæœç´¢å®Œæˆï¼Œæ‰¾åˆ°', searchResults.length, 'æ¡ç»“æœ');
            showNotification('ğŸ“š å·²æä¾›æœ¬åœ°çŸ¥è¯†åº“å†…å®¹ï¼ŒAPIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨');
        }
        
        // ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®
        function generatePersonalizedAdvice(topic) {
            const advice = [];
            
            // æ ¹æ®ä¸»é¢˜é•¿åº¦å’Œå†…å®¹ç”Ÿæˆå»ºè®®
            if (topic.length <= 4) {
                advice.push(`${topic}æ˜¯ä¸€ä¸ªå¾ˆæœ‰ä»·å€¼çš„ç ”ç©¶é¢†åŸŸï¼Œå»ºè®®æ·±å…¥äº†è§£å…¶æ ¸å¿ƒç†å¿µå’Œå®é™…åº”ç”¨`);
            } else {
                advice.push(`å…³äº${topic}ï¼Œå»ºè®®ä»åŸºç¡€æ¦‚å¿µå¼€å§‹ç³»ç»Ÿå­¦ä¹ `);
            }
            
            // æ ¹æ®ä¸»é¢˜ç±»å‹æä¾›ä¸“ä¸šå»ºè®®
            if (topic.includes('æŠ€å·§') || topic.includes('æ–¹æ³•')) {
                advice.push('ğŸ’¡ å®è·µå‡ºçœŸçŸ¥ï¼šç†è®ºå­¦ä¹ ç»“åˆå®é™…æ“ä½œï¼Œæ•ˆæœæœ€ä½³');
                advice.push('ğŸ“ è®°å½•æ€»ç»“ï¼šæ¯æ¬¡å®è·µåè®°å½•å¿ƒå¾—ï¼Œå½¢æˆè‡ªå·±çš„ç»éªŒåº“');
                advice.push('ğŸ”„ æŒç»­ä¼˜åŒ–ï¼šæ ¹æ®å®é™…æ•ˆæœè°ƒæ•´æ–¹æ³•ï¼Œæ‰¾åˆ°æœ€é€‚åˆè‡ªå·±çš„æ–¹å¼');
            } else if (topic.includes('ç»éªŒ') || topic.includes('åˆ†äº«')) {
                advice.push('ğŸ¯ çœŸå®æ¡ˆä¾‹ï¼šç»“åˆå…·ä½“æ¡ˆä¾‹åˆ†äº«ï¼Œæ›´æœ‰è¯´æœåŠ›');
                advice.push('ğŸ“Š æ•°æ®æ”¯æ’‘ï¼šç”¨æ•°æ®è¯´è¯ï¼Œè®©åˆ†äº«æ›´æœ‰åˆ†é‡');
                advice.push('ğŸ’¬ äº’åŠ¨äº¤æµï¼šé¼“åŠ±è§‚ä¼—ç•™è¨€åˆ†äº«è‡ªå·±çš„ç»éªŒ');
            } else {
                advice.push('ğŸ“– æƒå¨èµ„æ–™ï¼šæŸ¥æ‰¾ç›¸å…³é¢†åŸŸçš„æƒå¨èµ„æ–™å’Œæœ€æ–°ç ”ç©¶');
                advice.push('ğŸ” æ¡ˆä¾‹åˆ†æï¼šç»“åˆå®é™…æ¡ˆä¾‹ï¼Œè®©å†…å®¹æ›´å…·ä½“ç”ŸåŠ¨');
                advice.push('ğŸ‘¥ ä¸“å®¶äº¤æµï¼šä¸é¢†åŸŸä¸“å®¶æˆ–æœ‰ç»éªŒçš„äººäº¤æµï¼Œè·å–ä¸€æ‰‹ä¿¡æ¯');
            }
            
            return advice;
        }
        
        // å£æ’­æ–‡æ¡ˆç¼–è¾‘æ¨¡å¼åˆ‡æ¢
        function toggleVoiceoverEdit() {
            const editArea = document.getElementById('voiceoverEditArea');
            const previewArea = document.getElementById('voiceoverPreview');
            const editContent = document.getElementById('voiceoverEditContent');
            const previewContent = document.getElementById('voiceoverPreviewContent');
            
            if (editArea.style.display === 'none') {
                // åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼
                editContent.value = previewContent.textContent;
                editArea.style.display = 'block';
                previewArea.style.display = 'none';
            } else {
                // åˆ‡æ¢åˆ°é¢„è§ˆæ¨¡å¼
                cancelVoiceoverEdit();
            }
        }
        
        // ä¿å­˜å£æ’­æ–‡æ¡ˆç¼–è¾‘
        function saveVoiceoverEdit() {
            const editContent = document.getElementById('voiceoverEditContent');
            const previewContent = document.getElementById('voiceoverPreviewContent');
            const editArea = document.getElementById('voiceoverEditArea');
            const previewArea = document.getElementById('voiceoverPreview');
            
            previewContent.textContent = editContent.value;
            editArea.style.display = 'none';
            previewArea.style.display = 'block';
            
            // åŒæ—¶æ›´æ–°markdownè¾“å‡ºå®¹å™¨
            const markdownOutput = document.getElementById('voiceoverMarkdownOutput');
            if (markdownOutput) {
                markdownOutput.textContent = editContent.value;
            }
            
            showNotification('âœ… å£æ’­æ–‡æ¡ˆç¼–è¾‘å·²ä¿å­˜ï¼');
        }
        
        // å–æ¶ˆå£æ’­æ–‡æ¡ˆç¼–è¾‘
        function cancelVoiceoverEdit() {
            const editArea = document.getElementById('voiceoverEditArea');
            const previewArea = document.getElementById('voiceoverPreview');
            
            editArea.style.display = 'none';
            previewArea.style.display = 'block';
        }
        
        // å¤åˆ¶å£æ’­æ–‡æ¡ˆå†…å®¹
        function copyVoiceoverContent() {
            const previewContent = document.getElementById('voiceoverPreviewContent').textContent;
            
            if (!previewContent || previewContent.includes('è¯·åœ¨å·¦ä¾§è¾“å…¥å£æ’­ä¸»é¢˜')) {
                alert('æ²¡æœ‰å¯å¤åˆ¶çš„å£æ’­æ–‡æ¡ˆå†…å®¹ï¼');
                return;
            }
            
            navigator.clipboard.writeText(previewContent).then(() => {
                showNotification('âœ… å£æ’­æ–‡æ¡ˆå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶');
            });
        }
        
        // æ¸…ç©ºå£æ’­æ–‡æ¡ˆå†…å®¹
        function clearVoiceoverContent() {
            const previewContent = document.getElementById('voiceoverPreviewContent');
            const editContent = document.getElementById('voiceoverEditContent');
            const markdownOutput = document.getElementById('voiceoverMarkdownOutput');
            
            if (confirm('ç¡®å®šè¦æ¸…ç©ºå£æ’­æ–‡æ¡ˆå†…å®¹å—ï¼Ÿ')) {
                previewContent.textContent = 'è¯·åœ¨å·¦ä¾§è¾“å…¥å£æ’­ä¸»é¢˜å’Œç´ æï¼Œç‚¹å‡»"ğŸ¤– AIç”Ÿæˆå£æ’­æ–‡æ¡ˆ"æŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„çŸ­è§†é¢‘å£æ’­æ–‡æ¡ˆ...';
                editContent.value = '';
                if (markdownOutput) {
                    markdownOutput.textContent = '';
                }
                showNotification('ğŸ—‘ï¸ å£æ’­æ–‡æ¡ˆå†…å®¹å·²æ¸…ç©º');
            }
        }
        
        // æœ¬åœ°ç”Ÿæˆå£æ’­æ–‡æ¡ˆï¼ˆAPIå¤±è´¥æ—¶çš„å›é€€æ–¹æ¡ˆï¼‰
        function generateLocalVoiceover(topic, material) {
            let content = '';
            
            content = `ğŸ¬ å¤§å®¶å¥½ğŸ‘‹ï¼Œä»Šå¤©æƒ³è·Ÿå¤§å®¶èŠèŠ${topic}è¿™ä¸ªè¯é¢˜ã€‚

ã€åœé¡¿2ç§’ã€‘

${material ? `ç»“åˆæˆ‘è‡ªå·±çš„ç»éªŒï¼Œæˆ‘æƒ³åˆ†äº«ä¸€äº›å®ç”¨çš„è§è§£ï¼š

${material}

ã€åœé¡¿3ç§’ã€‘

` : 'é€šè¿‡æˆ‘çš„äº²èº«å®è·µï¼ŒçœŸçš„æ„Ÿå—åˆ°äº†æ˜æ˜¾çš„æ”¹å˜ã€‚'}

ã€é‡éŸ³ã€‘${topic}ã€é‡éŸ³ã€‘å¯¹äºæˆ‘ä»¬æ¯ä¸ªäººæ¥è¯´éƒ½éå¸¸é‡è¦ï¼Œå€¼å¾—æˆ‘ä»¬æ·±å…¥æ€è€ƒå’Œå®è·µã€‚

ã€åœé¡¿3ç§’ã€‘

æ‰€ä»¥å•Šï¼Œå¦‚æœä½ ä¹Ÿå¯¹${topic}æ„Ÿå…´è¶£ï¼Œä¸å¦¨æ·±å…¥äº†è§£ä¸€ä¸‹ã€‚ç›¸ä¿¡æˆ‘ï¼Œä½ ä¸€å®šä¼šæœ‰æ‰€æ”¶è·çš„ï¼

ã€åœé¡¿ã€‘è®°å¾—ç‚¹èµå…³æ³¨ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ï¼ğŸ‘‹`;
            
            return content;
        }
        
        // æ¸…ç©ºå£æ’­åŠ©æ‰‹è¡¨å•
        function clearVoiceover() {
            document.getElementById('voiceoverDraftContent').value = '';
            showNotification('ğŸ—‘ï¸ å£æ’­æ–‡æ¡ˆè‰ç¨¿å·²æ¸…ç©º');
        }
        
        // æµ‹è¯•å£æ’­ç”ŸæˆåŠŸèƒ½
        function testVoiceoverGeneration() {
            console.log('æµ‹è¯•å£æ’­ç”ŸæˆåŠŸèƒ½å¼€å§‹...');
            const draftContent = document.getElementById('voiceoverDraftContent').value.trim();
            console.log('è‰ç¨¿å†…å®¹:', draftContent);
            
            if (!draftContent) {
                alert('è¯·å…ˆè¾“å…¥ä¸€äº›åŸºç¡€å†…å®¹æˆ–æƒ³æ³•ï¼');
                return;
            }
            
            // ç›´æ¥æ˜¾ç¤ºæµ‹è¯•å†…å®¹
            const testContent = `ğŸ¬ æµ‹è¯•å£æ’­æ–‡æ¡ˆç”ŸæˆæˆåŠŸï¼

ã€æ–‡æ¡ˆ1-é»„é‡‘3ç§’é’©å­+é‡‘å­—å¡”ç»“æ„ã€‘
ä½ çŸ¥é“å—ï¼Ÿ90%çš„äººéƒ½ä¸çŸ¥é“çš„${draftContent}ç§˜å¯†ï¼
ã€åœé¡¿2ç§’ã€‘
ä»Šå¤©æˆ‘è¦å‘Šè¯‰ä½ 3ä¸ªå…³é”®æ­¥éª¤...

ã€æ–‡æ¡ˆ2-SCQAæ¨¡å‹ã€‘
åœºæ™¯ï¼šæ˜¨å¤©æœ‰ä¸ªæœ‹å‹é—®æˆ‘å…³äº${draftContent}çš„é—®é¢˜
å†²çªï¼šä»–è¯•äº†å¾ˆå¤šæ–¹æ³•éƒ½æ²¡æ•ˆæœ
ç–‘é—®ï¼šåˆ°åº•åº”è¯¥æ€ä¹ˆåšæ‰å¯¹ï¼Ÿ
ç­”æ¡ˆï¼šå…¶å®åªéœ€è¦æŒæ¡è¿™3ä¸ªè¦ç‚¹...

ã€æ–‡æ¡ˆ3-é­”æ€§å¾ªç¯å¥å¼+æ•°æ®è½°ç‚¸ã€‘
ä½ è§‰å¾—${draftContent}å¾ˆéš¾ï¼Ÿé‚£æ˜¯æ²¡ç®—å¯¹æ–¹æ³•ï¼
å¯¹æ–¹æ³•è¦é’±ï¼Ÿé‚£æ˜¯ä¸ºäº†èŠ‚çœæ—¶é—´ï¼
ä½ è§‰å¾—æ—¶é—´ä¸å€¼é’±ï¼Ÿé‚£æ˜¯ä½ è¿˜æ²¡ç®—æ¸…æ¥šæˆæœ¬ï¼

ã€æ–‡æ¡ˆ4-äº”æ„Ÿæ³•+ç”»é¢æ¤å…¥ã€‘
è§†è§‰ä¸Šï¼Œ${draftContent}å°±åƒä¸€å¹…ç¾ä¸½çš„ç”»å·
å¬è§‰ä¸Šï¼Œæ¯ä¸ªç»†èŠ‚éƒ½åœ¨è¯‰è¯´ç€æ•…äº‹
è§¦è§‰ä¸Šï¼Œä½ èƒ½æ„Ÿå—åˆ°çœŸå®çš„è´¨æ„Ÿ
å—…è§‰ä¸Šï¼Œæ•£å‘ç€ç‹¬ç‰¹çš„é­…åŠ›

ã€æ–‡æ¡ˆ5-è§’è‰²ä»£å…¥+äº’åŠ¨æé—®ã€‘
ä½ æ˜¯ä¸æ˜¯ä¹Ÿåœ¨ä¸º${draftContent}è€Œçƒ¦æ¼ï¼Ÿ
ã€åœé¡¿3ç§’ã€‘
åˆ«æ‹…å¿ƒï¼Œä»Šå¤©æˆ‘æ¥æ•™ä½ 3ä¸ªç®€å•æ­¥éª¤ï¼
ç¬¬ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿè¯„è®ºåŒºæ‰£1æˆ‘å‘Šè¯‰ä½ ï¼`;
            
            const textarea = document.getElementById('voiceoverDraftContent');
            textarea.value = testContent;
            
            // æ›´æ–°é¢„è§ˆåŒºåŸŸ
            const previewContent = document.getElementById('voiceoverPreviewContent');
            if (previewContent) {
                previewContent.textContent = testContent;
            }
            
            // æ›´æ–°markdownè¾“å‡ºå®¹å™¨
            const markdownOutput = document.getElementById('voiceoverMarkdownOutput');
            if (markdownOutput) {
                markdownOutput.textContent = testContent;
            }
            
            showNotification('âœ… æµ‹è¯•å£æ’­æ–‡æ¡ˆç”Ÿæˆå®Œæˆï¼');
            console.log('æµ‹è¯•å£æ’­ç”ŸæˆåŠŸèƒ½å®Œæˆ');
        }
        
        // ç®€å•çš„æµ‹è¯•å‡½æ•° - éªŒè¯åŸºæœ¬åŠŸèƒ½
        function simpleTest() {
            console.log('ç®€å•æµ‹è¯•å¼€å§‹...');
            alert('ç®€å•æµ‹è¯•ï¼šJavaScriptæ­£å¸¸å·¥ä½œï¼');
            
            // æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
            const elements = {
                'voiceoverDraftContent': document.getElementById('voiceoverDraftContent'),
                'voiceoverPreviewContent': document.getElementById('voiceoverPreviewContent'),
                'voiceoverMarkdownOutput': document.getElementById('voiceoverMarkdownOutput')
            };
            
            let missingElements = [];
            for (let [name, element] of Object.entries(elements)) {
                if (!element) {
                    missingElements.push(name);
                }
            }
            
            if (missingElements.length > 0) {
                alert('ç¼ºå°‘å…ƒç´ : ' + missingElements.join(', '));
            } else {
                alert('æ‰€æœ‰å¿…è¦å…ƒç´ éƒ½å­˜åœ¨ï¼');
            }
            
            console.log('ç®€å•æµ‹è¯•å®Œæˆ');
        }

        // AIç”Ÿæˆå£æ’­æ–‡æ¡ˆ
        async function generateVoiceoverWithAI() {
            console.log('AIç”Ÿæˆå£æ’­æ–‡æ¡ˆå‡½æ•°è¢«è°ƒç”¨');
            
            try {
                const draftContent = document.getElementById('voiceoverDraftContent').value.trim();
                const previewContent = document.getElementById('voiceoverPreviewContent');
                
                console.log('è‰ç¨¿å†…å®¹:', draftContent);
                
                if (!draftContent) {
                    alert('è¯·å…ˆè¾“å…¥ä¸€äº›åŸºç¡€å†…å®¹æˆ–æƒ³æ³•ï¼');
                    return;
                }
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                showNotification('ğŸ¤– æ­£åœ¨ç”Ÿæˆå£æ’­æ–‡æ¡ˆï¼Œè¯·ç¨å€™...');
                previewContent.textContent = 'æ­£åœ¨ç”Ÿæˆå£æ’­æ–‡æ¡ˆï¼Œè¯·ç¨å€™...';
                
                // æ„å»ºAPIè¯·æ±‚å†…å®¹
                const apiContent = `ä½ æ˜¯ä¸€åä¸“ä¸šçŸ­è§†é¢‘å£æ’­æ–‡æ¡ˆç­–åˆ’ä¸“å®¶ï¼Œç²¾é€šçˆ†æ¬¾æ–‡æ¡ˆç»“æ„è®¾è®¡ä¸æƒ…ç»ªè°ƒåŠ¨æŠ€å·§ï¼Œæ“…é•¿å°†ä¸“ä¸šçŸ¥è¯†è½¬åŒ–ä¸ºé€šä¿—æ˜“æ‡‚ã€å…·æœ‰ä¼ æ’­åŠ›çš„å£æ’­å†…å®¹ã€‚è¯·ä½ æ ¹æ®ä¸‹é¢${draftContent}é‡Œçš„å†…å®¹åˆ†æã€æå–ã€æ€»ç»“ï¼Œå°†è¯¥è‰ç¨¿æ–‡æ¡ˆæ”¹å†™æˆé€‚åˆå£æ’­çš„æ–‡æ¡ˆï¼Œå£æ’­çš„æ—¶é•¿æ§åˆ¶åœ¨2-3åˆ†é’Ÿï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹å‡ ç§å£æ’­æ–‡æ¡ˆç»“æ„æ¥è¿›è¡Œåˆ›ä½œï¼Œç»“æ„1ï¼šå†²çªå‰ç½®+æ ¸å¿ƒè§‚ç‚¹+åˆ†å±‚è®ºè¯+è¡ŒåŠ¨æ”¶å°¾çš„ç»“æ„ï¼›ç»“æ„2ï¼šåœºæ™¯ï¼ˆSï¼‰+å†²çªï¼ˆCï¼‰+ç–‘é—®ï¼ˆQï¼‰+ç­”æ¡ˆï¼ˆAï¼‰ï¼›ç»“æ„3ï¼šåå¸¸è¯†å¯¹æ¯”+æ•°æ®å†²å‡»+é­”æ€§ç»“è®ºç»“æ„ï¼›ç»“æ„4ï¼šè§†è§‰+å¬è§‰+è§¦è§‰+å—…è§‰+å‘³è§‰ï¼Œç»“æ„5ï¼šâ€œä½ â€è§†è§’+é—®é¢˜äº’åŠ¨+æ­¥éª¤æ¼”ç¤º`;
                
                // è°ƒç”¨æµå¼APIï¼Œç›´æ¥æ›´æ–°é¢„è§ˆåŒºåŸŸ
                await callSiliconFlowAPI(apiContent, previewContent);
                
                showNotification('âœ… å£æ’­æ–‡æ¡ˆç”Ÿæˆå®Œæˆï¼');
                console.log('AIç”Ÿæˆå£æ’­æ–‡æ¡ˆå®Œæˆ');
                
            } catch (error) {
                console.error('AIç”Ÿæˆå£æ’­æ–‡æ¡ˆæ—¶å‡ºé”™:', error);
                alert('ç”Ÿæˆå£æ’­æ–‡æ¡ˆæ—¶å‡ºé”™ï¼Œä½¿ç”¨æ¨¡æ‹Ÿç”Ÿæˆä½œä¸ºæ›¿ä»£ï¼');
                showNotification('âš ï¸ ä½¿ç”¨æ¨¡æ‹Ÿç”Ÿæˆä½œä¸ºæ›¿ä»£');
                
                // å›é€€åˆ°æ¨¡æ‹Ÿç”Ÿæˆ
                const draftContent = document.getElementById('voiceoverDraftContent').value.trim();
                const simulatedContent = simulateAIVoiceoverGeneration(draftContent);
                const previewContent = document.getElementById('voiceoverPreviewContent');
                if (previewContent) {
                    previewContent.textContent = simulatedContent;
                }
            }
        }
        
        // SiliconFlow APIè°ƒç”¨ï¼ˆæµå¼å“åº”ï¼‰
        async function callSiliconFlowAPI(content, targetElement) {
            const apiUrl = 'https://api.siliconflow.cn/v1/chat/completions';
            const apiKey = 'sk-vsfobhidjfrliuiqfdxjpivantwjnxafxiayluiimudwyzhr';
            
            const requestBody = {
                model: "deepseek-ai/DeepSeek-V3.1",
                messages: [
                    {
                        role: "user",
                        content: content
                    }
                ],
                stream: true,
                max_tokens: 4000,
                temperature: 0.7,
                top_p: 0.7,
                frequency_penalty: 0.5
            };
            
            try {
                console.log('APIè¯·æ±‚é…ç½®:', {
                    url: apiUrl,
                    model: requestBody.model,
                    contentLength: content.length,
                    headers: {
                        'Authorization': `Bearer ${apiKey.substring(0, 10)}...`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                        'Accept': 'text/event-stream'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                console.log('APIå“åº”çŠ¶æ€:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('APIé”™è¯¯è¯¦æƒ…:', errorText);
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText} - ${errorText}`);
                }
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';
                let fullContent = '';
                
                targetElement.textContent = ''; // æ¸…ç©ºç›®æ ‡å…ƒç´ 
                
                while (true) {
                    const { done, value } = await reader.read();
                    
                    if (done) {
                        break;
                    }
                    
                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n');
                    buffer = lines.pop() || '';
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = line.slice(6);
                            
                            if (data === '[DONE]') {
                                return fullContent;
                            }
                            
                            try {
                                const parsed = JSON.parse(data);
                                const content = parsed.choices?.[0]?.delta?.content || '';
                                
                                if (content) {
                                    fullContent += content;
                                    targetElement.textContent = fullContent;
                                    targetElement.scrollTop = targetElement.scrollHeight;
                                }
                            } catch (e) {
                                console.warn('è§£ææµå¼æ•°æ®å¤±è´¥:', e);
                            }
                        }
                    }
                }
                
                return fullContent;
                
            } catch (error) {
                console.error('SiliconFlow APIè°ƒç”¨å¤±è´¥:', error);
                throw error;
            }
        }
        
        // æ¨¡æ‹ŸAIå£æ’­æ–‡æ¡ˆç”Ÿæˆï¼ˆå›é€€æ–¹æ¡ˆï¼‰
        function simulateAIVoiceoverGeneration(content) {
            let generated = '';
            
            // ç”Ÿæˆé€šç”¨å¼€åœºç™½
            generated = `ğŸ¬ å¤§å®¶å¥½ğŸ‘‹ï¼Œä»Šå¤©æƒ³è·Ÿå¤§å®¶èŠèŠè¿™ä¸ªè¯é¢˜ã€‚\n\nã€åœé¡¿2ç§’ã€‘\n\n`;
            
            // å¤„ç†åŸå§‹å†…å®¹
            const sentences = content.split(/[ã€‚ï¼ï¼Ÿ]/g).filter(s => s.trim());
            sentences.forEach((sentence, index) => {
                if (sentence.trim()) {
                    generated += sentence.trim();
                    if (index < sentences.length - 1) {
                        generated += 'ã€‚\n\nã€åœé¡¿2ç§’ã€‘\n\n';
                    }
                }
            });
            
            // ç”Ÿæˆé€šç”¨ç»“å°¾
            let ending = `\n\nã€åœé¡¿3ç§’ã€‘\n\nå¤§å®¶è§‰å¾—æ€ä¹ˆæ ·å‘¢ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„æƒ³æ³•ğŸ’­\n\nã€åœé¡¿2ç§’ã€‘\n\nå¦‚æœä½ è§‰å¾—è¿™ä¸ªå†…å®¹å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè®°å¾—ç‚¹èµå…³æ³¨ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ï¼ğŸ‘‹`;
            
            generated += ending;
            return generated;
        }

        // AIç¼–è¾‘å£æ’­æ–‡æ¡ˆ
        async function aiEditVoiceover() {
            const voiceoverDraftContent = document.getElementById('voiceoverDraftContent').value.trim();
            const voiceoverMaterial = document.getElementById('voiceoverMaterial');
            
            if (!voiceoverDraftContent) {
                alert('è¯·å…ˆè¾“å…¥è‰ç¨¿æ–‡æ¡ˆï¼');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const originalMaterial = voiceoverMaterial.value;
            voiceoverMaterial.value = 'ğŸ¤– æ­£åœ¨AIç¼–è¾‘å£æ’­æ–‡æ¡ˆï¼Œè¯·ç¨å€™...';
            voiceoverMaterial.disabled = true;
            
            try {
                // æ„å»ºAIç¼–è¾‘è¯·æ±‚å†…å®¹
                const apiContent = `ä½ æ˜¯ä¸€ä½çŸ­è§†é¢‘å£æ’­æ–‡æ¡ˆä¸“å®¶ï¼Œæ“…é•¿å°†æ™®é€šæ–‡æ¡ˆè½¬æ¢ä¸ºé€‚åˆçŸ­è§†é¢‘å£æ’­çš„ç”ŸåŠ¨å†…å®¹ã€‚è¯·æ ¹æ®ä»¥ä¸‹è‰ç¨¿æ–‡æ¡ˆï¼Œç”Ÿæˆé€‚åˆçŸ­è§†é¢‘å£æ’­çš„æ–‡æ¡ˆï¼š

è‰ç¨¿æ–‡æ¡ˆï¼š${voiceoverDraftContent}

è¦æ±‚ï¼š
1. è¯­è¨€è¦å£è¯­åŒ–ã€è‡ªç„¶æµç•…
2. æ·»åŠ é€‚å½“çš„åœé¡¿æç¤ºï¼ˆå¦‚ã€åœé¡¿2ç§’ã€‘ï¼‰
3. æ·»åŠ é‡éŸ³æç¤ºï¼ˆå¦‚ã€é‡éŸ³ã€‘å…³é”®è¯ã€é‡éŸ³ã€‘ï¼‰
4. æ·»åŠ æƒ…æ„Ÿè¡¨è¾¾å’Œäº’åŠ¨å…ƒç´ 
5. é€‚åˆ1-3åˆ†é’Ÿçš„çŸ­è§†é¢‘
6. å¼€å¤´è¦æœ‰å¸å¼•åŠ›çš„å¼€åœºç™½
7. ç»“å°¾è¦æœ‰äº’åŠ¨å¼•å¯¼å’Œå…³æ³¨æé†’

è¯·ç”Ÿæˆå®Œæ•´çš„å£æ’­æ–‡æ¡ˆï¼š`;
                
                // è°ƒç”¨AI API
                await callAIAPI(apiContent, voiceoverMaterial);
                
                // å°†ç¼–è¾‘åçš„å†…å®¹ä¹ŸåŒæ­¥åˆ°è‰ç¨¿åŒº
                document.getElementById('voiceoverDraftContent').value = voiceoverMaterial.value;
                
                showNotification('âœ¨ AIå£æ’­æ–‡æ¡ˆç¼–è¾‘å®Œæˆï¼');
                
            } catch (error) {
                console.error('AIç¼–è¾‘å¤±è´¥:', error);
                // å›é€€åˆ°æœ¬åœ°æ¨¡æ‹Ÿç¼–è¾‘
                const aiEditedContent = simulateAIVoiceoverEdit(voiceoverDraftContent);
                voiceoverMaterial.value = aiEditedContent;
                document.getElementById('voiceoverDraftContent').value = aiEditedContent;
                
                showNotification('âœ¨ AIå£æ’­æ–‡æ¡ˆç¼–è¾‘å®Œæˆï¼ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰');
            } finally {
                voiceoverMaterial.disabled = false;
            }
        }
        
        // æ¨¡æ‹ŸAIå£æ’­æ–‡æ¡ˆç¼–è¾‘ï¼ˆå›é€€æ–¹æ¡ˆï¼‰
        function simulateAIVoiceoverEdit(content) {
            let edited = content;
            
            // æ·»åŠ å¼€åœºç™½
            if (!edited.startsWith('ğŸ¬')) {
                edited = `ğŸ¬ å¤§å®¶å¥½ğŸ‘‹ï¼Œä»Šå¤©æƒ³è·Ÿå¤§å®¶èŠèŠè¿™ä¸ªè¯é¢˜ã€‚\n\nã€åœé¡¿2ç§’ã€‘\n\n${edited}`;
            }
            
            // æ·»åŠ å£è¯­åŒ–è¡¨è¾¾
            edited = edited.replace(/æˆ‘è®¤ä¸º/g, 'æˆ‘è§‰å¾—');
            edited = edited.replace(/éå¸¸é‡è¦/g, 'ã€é‡éŸ³ã€‘è¶…çº§é‡è¦ã€é‡éŸ³ã€‘');
            edited = edited.replace(/å»ºè®®å¤§å®¶/g, 'çœŸå¿ƒå»ºè®®å¤§å®¶');
            edited = edited.replace(/å¸Œæœ›èƒ½å¤Ÿ/g, 'å¸Œæœ›å’±ä»¬éƒ½èƒ½');
            
            // æ·»åŠ åœé¡¿å’Œäº’åŠ¨
            edited = edited.replace(/ã€‚/g, 'ã€‚\n\nã€åœé¡¿2ç§’ã€‘');
            edited = edited.replace(/ï¼/g, 'ï¼\n\nã€åœé¡¿1ç§’ã€‘');
            
            // æ·»åŠ ç»“å°¾
            if (!edited.includes('å…³æ³¨')) {
                edited += `\n\nã€åœé¡¿3ç§’ã€‘\n\næ‰€ä»¥å•Šï¼Œå¦‚æœä½ è§‰å¾—è¿™ä¸ªå†…å®¹å¯¹ä½ æœ‰å¸®åŠ©ï¼Œ\n\nè®°å¾—ç‚¹èµå…³æ³¨ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ï¼ğŸ‘‹`;
            }
            
            return edited;
        }

        // å®æ—¶æ¸²æŸ“å£æ’­é¢„è§ˆ
        function renderVoiceoverPreview() {
            const draftContent = document.getElementById('voiceoverDraftContent').value.trim();
            const previewContent = document.getElementById('voiceoverPreviewContent');
            
            if (!draftContent) {
                previewContent.textContent = 'è¯·åœ¨å·¦ä¾§è¾“å…¥å£æ’­ä¸»é¢˜å’Œç´ æï¼Œå®æ—¶é¢„è§ˆå°†åœ¨è¿™é‡Œæ˜¾ç¤º...';
                return;
            }
            
            // æ™ºèƒ½å®æ—¶æ¸²æŸ“é€»è¾‘
            let renderedContent = draftContent;
            
            // 1. åŸºç¡€æ ¼å¼åŒ– - å¤„ç†Markdownè¯­æ³•
            renderedContent = renderedContent
                .replace(/^#\s+(.+)$/gm, 'ğŸ¬ $1\n\nã€åœé¡¿3ç§’ã€‘\n\n') // æ ‡é¢˜è½¬æ¢ä¸ºå¼€åœºç™½æ ¼å¼
                .replace(/^##\s+(.+)$/gm, 'ã€$1ã€‘\n\n') // å‰¯æ ‡é¢˜
                .replace(/^###\s+(.+)$/gm, 'â–¶ $1\n\n') // ä¸‰çº§æ ‡é¢˜
                .replace(/\*\*(.+?)\*\*/g, 'ã€é‡éŸ³ã€‘$1ã€é‡éŸ³ã€‘') // ç²—ä½“è½¬æ¢ä¸ºé‡éŸ³
                .replace(/\*(.+?)\*/g, 'ã€å¼ºè°ƒã€‘$1ã€å¼ºè°ƒã€‘') // æ–œä½“è½¬æ¢ä¸ºå¼ºè°ƒ
                .replace(/^-\s+(.+)$/gm, 'â€¢ $1') // åˆ—è¡¨é¡¹
                .replace(/^\d+\.\s+(.+)$/gm, 'ç¬¬$&ä¸ªè¦ç‚¹ï¼š$1') // æ•°å­—åˆ—è¡¨
                .replace(/\n{3,}/g, '\n\nã€åœé¡¿2ç§’ã€‘\n\n'); // å¤šä½™ç©ºè¡Œè½¬æ¢ä¸ºåœé¡¿
            
            // 2. æ™ºèƒ½åˆ†æ®µå¤„ç†
            const sentences = renderedContent.split(/[ã€‚ï¼ï¼Ÿ]/g);
            let processedContent = '';
            
            sentences.forEach((sentence, index) => {
                if (sentence.trim()) {
                    // æ ¹æ®å¥å­é•¿åº¦è°ƒæ•´åœé¡¿æ—¶é—´
                    const pauseTime = sentence.length > 50 ? '3ç§’' : '2ç§’';
                    processedContent += sentence.trim();
                    
                    // ä¸æ˜¯æœ€åä¸€å¥å°±æ·»åŠ åœé¡¿
                    if (index < sentences.length - 1) {
                        processedContent += `ã€‚\n\nã€åœé¡¿${pauseTime}ã€‘\n\n`;
                    }
                }
            });
            
            renderedContent = processedContent;
            
            // 3. æƒ…æ„Ÿè¡¨è¾¾å¢å¼º
            if (renderedContent.includes('é‡è¦') || renderedContent.includes('å…³é”®')) {
                renderedContent = renderedContent.replace(/é‡è¦/g, 'ã€é‡éŸ³ã€‘é‡è¦ã€é‡éŸ³ã€‘');
                renderedContent = renderedContent.replace(/å…³é”®/g, 'ã€é‡éŸ³ã€‘å…³é”®ã€é‡éŸ³ã€‘');
            }
            
            if (renderedContent.includes('ï¼Ÿ')) {
                renderedContent = renderedContent.replace(/\?/g, 'ï¼Ÿã€åœé¡¿1ç§’ã€‘');
            }
            
            // 4. æ™ºèƒ½å¼€åœºç™½
            if (!renderedContent.startsWith('ğŸ¬') && !renderedContent.startsWith('ã€')) {
                // æ ¹æ®å†…å®¹é•¿åº¦åˆ¤æ–­å¼€åœºç™½ç±»å‹
                const opening = draftContent.length > 200 ? 
                    `ğŸ¬ å¤§å®¶å¥½ğŸ‘‹ï¼Œä»Šå¤©æƒ³è·Ÿå¤§å®¶åˆ†äº«ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„è¯é¢˜ã€‚\n\nã€åœé¡¿3ç§’ã€‘\n\n` :
                    `ğŸ¬ å“ˆå–½å¤§å®¶å¥½ğŸ‘‹ï¼Œä»Šå¤©æƒ³è·Ÿå¤§å®¶èŠèŠè¿™ä¸ªè¯é¢˜ã€‚\n\nã€åœé¡¿2ç§’ã€‘\n\n`;
                renderedContent = opening + renderedContent;
            }
            
            // 5. æ™ºèƒ½ç»“å°¾
            if (!renderedContent.includes('ç‚¹èµ') && !renderedContent.includes('å…³æ³¨') && 
                !renderedContent.includes('è¯„è®º') && !renderedContent.includes('åˆ†äº«')) {
                
                // æ ¹æ®å†…å®¹ç±»å‹é€‰æ‹©ç»“å°¾é£æ ¼
                let ending = '';
                if (renderedContent.includes('çŸ¥è¯†') || renderedContent.includes('ç»éªŒ')) {
                    ending = `\n\nã€åœé¡¿3ç§’ã€‘\n\nä»¥ä¸Šå°±æ˜¯ä»Šå¤©æƒ³è·Ÿå¤§å®¶åˆ†äº«çš„çŸ¥è¯†å’Œç»éªŒï¼Œ\n\nå¦‚æœä½ è§‰å¾—å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè®°å¾—ç‚¹èµæ”¶è—ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ï¼ğŸ‘‹`;
                } else if (renderedContent.includes('ç”Ÿæ´»') || renderedContent.includes('æ„Ÿæ‚Ÿ')) {
                    ending = `\n\nã€åœé¡¿3ç§’ã€‘\n\nç”Ÿæ´»å°±æ˜¯è¿™æ ·ï¼Œå……æ»¡äº†å„ç§å¯èƒ½ï¼Œ\n\nå¦‚æœä½ ä¹Ÿæœ‰ç±»ä¼¼çš„ç»å†ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ï¼Œè®°å¾—ç‚¹èµå…³æ³¨å“¦ï¼ğŸ‘‹`;
                } else {
                    ending = `\n\nã€åœé¡¿3ç§’ã€‘\n\nä»¥ä¸Šå°±æ˜¯ä»Šå¤©æƒ³è·Ÿå¤§å®¶åˆ†äº«çš„å†…å®¹ï¼Œ\n\nå¦‚æœä½ è§‰å¾—æœ‰å¸®åŠ©ï¼Œè®°å¾—ç‚¹èµå…³æ³¨ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ï¼ğŸ‘‹`;
                }
                renderedContent += ending;
            }
            
            // 6. è®¾ç½®é¢„è§ˆå†…å®¹å¹¶æ·»åŠ åŠ¨ç”»æ•ˆæœ
            previewContent.textContent = renderedContent;
            
            // æ·»åŠ æ·¡å…¥æ•ˆæœ
            previewContent.style.opacity = '0.7';
            setTimeout(() => {
                previewContent.style.opacity = '1';
            }, 100);
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
            previewContent.scrollTop = previewContent.scrollHeight;
        }
        
        // ç”Ÿæˆå£æ’­æ–‡æ¡ˆå†…å®¹ï¼ˆæœ€ç»ˆç”Ÿæˆï¼‰
        async function generateVoiceoverContent() {
            const voiceoverDraftContent = document.getElementById('voiceoverDraftContent').value.trim();
            const voiceoverMaterial = document.getElementById('voiceoverMaterial').value.trim();
            const topic = document.getElementById('voiceoverTopic').value.trim();
            
            if (!voiceoverDraftContent && !voiceoverMaterial) {
                alert('è¯·å…ˆè¾“å…¥è‰ç¨¿æ–‡æ¡ˆæˆ–æœç´¢ç´ æï¼');
                return;
            }
            
            // åˆå¹¶è‰ç¨¿å’Œç´ æå†…å®¹
            let finalContent = voiceoverDraftContent;
            if (voiceoverMaterial && voiceoverMaterial !== 'ğŸ¤– æ­£åœ¨AIç¼–è¾‘å£æ’­æ–‡æ¡ˆï¼Œè¯·ç¨å€™...') {
                if (finalContent) {
                    finalContent += '\n\n' + voiceoverMaterial;
                } else {
                    finalContent = voiceoverMaterial;
                }
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showNotification('ğŸ¬ æ­£åœ¨ç”Ÿæˆæœ€ç»ˆå£æ’­æ–‡æ¡ˆ...');
            
            try {
                // æ„å»ºæœ€ç»ˆä¼˜åŒ–è¯·æ±‚
                const apiContent = `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„çŸ­è§†é¢‘å£æ’­æ–‡æ¡ˆç­–åˆ’å¸ˆï¼Œè¯·æ ¹æ®ä»¥ä¸‹å†…å®¹ç”Ÿæˆæœ€ç»ˆçš„çŸ­è§†é¢‘å£æ’­æ–‡æ¡ˆï¼š

ä¸»é¢˜ï¼š${topic || 'ç”Ÿæ´»åˆ†äº«'}
å†…å®¹ç´ æï¼š${finalContent}

è¦æ±‚ï¼š
1. ç”Ÿæˆ1-3åˆ†é’Ÿçš„ä¸“ä¸šå£æ’­æ–‡æ¡ˆ
2. ç»“æ„æ¸…æ™°ï¼šå¼€åœºå¸å¼•â†’æ ¸å¿ƒå†…å®¹â†’äº’åŠ¨å¼•å¯¼â†’ç»“å°¾å…³æ³¨
3. è¯­è¨€è‡ªç„¶å£è¯­åŒ–ï¼Œé€‚åˆå£æ’­
4. æ·»åŠ é€‚å½“çš„åœé¡¿å’Œæƒ…æ„Ÿè¡¨è¾¾
5. åŒ…å«äº’åŠ¨å…ƒç´ å’Œå…³æ³¨å¼•å¯¼
6. é€‚åˆå°çº¢ä¹¦ã€æŠ–éŸ³ç­‰å¹³å°é£æ ¼

è¯·ç›´æ¥ç”Ÿæˆå®Œæ•´çš„å£æ’­æ–‡æ¡ˆï¼š`;
                
                // ä¸´æ—¶å­˜å‚¨æœ€ç»ˆå†…å®¹
                let finalVoiceoverContent = '';
                const tempOutput = { 
                    value: '', 
                    disabled: false,
                    setAttribute: function() {},
                    getAttribute: function() { return ''; }
                };
                
                // è°ƒç”¨AI APIç”Ÿæˆæœ€ç»ˆå†…å®¹
                await callAIAPI(apiContent, tempOutput);
                finalVoiceoverContent = tempOutput.value;
                
                // å°†æœ€ç»ˆå†…å®¹æ˜¾ç¤ºåœ¨ç´ æåŒºåŸŸ
                document.getElementById('voiceoverMaterial').value = finalVoiceoverContent;
                
                showNotification('ğŸ‰ å£æ’­æ–‡æ¡ˆç”Ÿæˆå®Œæˆï¼');
                
            } catch (error) {
                console.error('æœ€ç»ˆç”Ÿæˆå¤±è´¥:', error);
                // å›é€€åˆ°æœ¬åœ°ç”Ÿæˆ
                const finalContent = generateLocalFinalVoiceover(topic, finalContent);
                document.getElementById('voiceoverMaterial').value = finalContent;
                
                showNotification('ğŸ‰ å£æ’­æ–‡æ¡ˆç”Ÿæˆå®Œæˆï¼ï¼ˆä½¿ç”¨æœ¬åœ°ä¼˜åŒ–ï¼‰');
            }
        }
        
        // æœ¬åœ°ç”Ÿæˆæœ€ç»ˆå£æ’­æ–‡æ¡ˆï¼ˆå›é€€æ–¹æ¡ˆï¼‰
        function generateLocalFinalVoiceover(topic, content) {
            let finalContent = `ğŸ¬ å¤§å®¶å¥½ğŸ‘‹ï¼Œä»Šå¤©æƒ³è·Ÿå¤§å®¶èŠèŠ${topic || 'ç”Ÿæ´»åˆ†äº«'}è¿™ä¸ªè¯é¢˜ã€‚\n\nã€åœé¡¿2ç§’ã€‘\n\n`;
            
            // å¤„ç†åŸå§‹å†…å®¹
            finalContent += content.replace(/\n/g, '\n\nã€åœé¡¿2ç§’ã€‘\n\n');
            
            // æ·»åŠ ç»“å°¾
            finalContent += `\n\nã€åœé¡¿3ç§’ã€‘\n\næ‰€ä»¥å•Šï¼Œå¦‚æœä½ è§‰å¾—è¿™ä¸ªå†…å®¹å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè®°å¾—ç‚¹èµå…³æ³¨ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ï¼ğŸ‘‹`;
            
            return finalContent;
        }
        
        // å£æ’­æ–‡æ¡ˆåŠŸèƒ½ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼Œç§»é™¤ç¼–è¾‘æ¨¡å¼ï¼‰
        let originalVoiceoverContent = '';

        // å¯¼å‡ºå›¾ç‰‡ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
        function exportCard() {
            alert('å¯¼å‡ºåŠŸèƒ½éœ€è¦é¢å¤–çš„åº“æ”¯æŒï¼Œè¿™é‡Œæä¾›åŸºç¡€å®ç°æ€è·¯ã€‚\n\nå®é™…é¡¹ç›®ä¸­å¯ä»¥ä½¿ç”¨ html2canvas ç­‰åº“æ¥å®ç°å›¾ç‰‡å¯¼å‡ºåŠŸèƒ½ã€‚');
        }

        // å¤åˆ¶åŠŸèƒ½ç›¸å…³å‡½æ•°
        function showCopyDialog() {
            const dialog = document.getElementById('copyDialog');
            const cardOptions = document.getElementById('cardOptions');
            
            // è·å–å½“å‰ç¼–è¾‘çš„å†…å®¹
            const currentContent = getCurrentCardContent();
            const markdownContent = document.getElementById('markdownOutput').value;
            
            cardOptions.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; margin-bottom: 10px;">
                        <input type="checkbox" id="copyCurrent" checked style="margin-right: 8px;">
                        <span style="font-weight: 600;">å¤åˆ¶å½“å‰ç¼–è¾‘çš„å¡ç‰‡</span>
                    </label>
                    <div style="font-size: 12px; color: #666; margin-left: 24px; margin-bottom: 15px;">
                        ${currentContent.substring(0, 100)}${currentContent.length > 100 ? '...' : ''}
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; margin-bottom: 10px;">
                        <input type="checkbox" id="copyAllTemplates" style="margin-right: 8px;">
                        <span style="font-weight: 600;">å¤åˆ¶æ‰€æœ‰æ¨¡æ¿å¡ç‰‡</span>
                    </label>
                </div>
                <div style="max-height: 150px; overflow-y: auto; border: 1px solid #e1e4e8; border-radius: 8px; padding: 10px;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;">å¯é€‰ï¼šå¤åˆ¶ç‰¹å®šæ¨¡æ¿</div>
                    ${getTemplateOptions()}
                </div>
            `;
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬
            document.getElementById('copyCurrent').addEventListener('change', function() {
                if (this.checked) {
                    document.getElementById('copyAllTemplates').checked = false;
                    document.querySelectorAll('.template-checkbox').forEach(cb => cb.checked = false);
                }
            });
            
            document.getElementById('copyAllTemplates').addEventListener('change', function() {
                if (this.checked) {
                    document.getElementById('copyCurrent').checked = false;
                    document.querySelectorAll('.template-checkbox').forEach(cb => cb.checked = true);
                }
            });
            
            dialog.style.display = 'block';
        }
        
        function getTemplateOptions() {
            const templates = [
                { id: 'knowledge', name: 'å°çº¢ä¹¦å¡ç‰‡' },
                { id: 'review', name: 'äº”æ˜Ÿå¥½è¯„' },
                { id: 'social', name: 'æœ‹å‹åœˆæ–‡æ¡ˆ' },
                { id: 'marketing', name: 'è¥é”€æ´»åŠ¨ç­–åˆ’' },
                { id: 'video', name: 'çŸ­è§†é¢‘è„šæœ¬' },
                { id: 'live', name: 'ç›´æ’­è¯æœ¯æ¨¡æ¿' },
                { id: 'recruit', name: 'æ‹›è˜ä¿¡æ¯' }
            ];
            
            return templates.map(template => `
                <label style="display: flex; align-items: center; margin-bottom: 6px; padding: 3px; border-radius: 4px; cursor: pointer;">
                    <input type="checkbox" class="template-checkbox" value="${template.id}" style="margin-right: 8px;">
                    <span style="font-size: 12px;">${template.name}</span>
                </label>
            `).join('');
        }
        
        function closeCopyDialog() {
            document.getElementById('copyDialog').style.display = 'none';
        }
        
        function copyCurrentCard() {
            const copyCurrent = document.getElementById('copyCurrent').checked;
            const copyAllTemplates = document.getElementById('copyAllTemplates').checked;
            const selectedTemplates = document.querySelectorAll('.template-checkbox:checked');
            
            let allContent = '';
            let cardCount = 0;
            
            if (copyCurrent) {
                // å¤åˆ¶å½“å‰å†…å®¹
                const currentContent = getCurrentCardContent();
                if (currentContent.trim()) {
                    allContent += currentContent;
                    cardCount++;
                }
            }
            
            if (copyAllTemplates || selectedTemplates.length > 0) {
                // å¤åˆ¶æ¨¡æ¿å†…å®¹
                const templatesToCopy = copyAllTemplates ? 
                    ['knowledge', 'review', 'social', 'marketing', 'video', 'live', 'recruit'] :
                    Array.from(selectedTemplates).map(cb => cb.value);
                
                templatesToCopy.forEach((templateId, index) => {
                    const templateContent = getCardContent(templateId);
                    if (templateContent.trim()) {
                        if (allContent) {
                            allContent += '\n\n' + '='.repeat(30) + '\n\n';
                        }
                        allContent += templateContent;
                        cardCount++;
                    }
                });
            }
            
            if (allContent.trim() === '') {
                alert('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹ï¼');
                return;
            }
            
            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            navigator.clipboard.writeText(allContent).then(() => {
                showNotification(`å·²å¤åˆ¶ ${cardCount} ä¸ªçŸ¥è¯†å¡ç‰‡ï¼`);
                closeCopyDialog();
            }).catch(err => {
                // é™çº§æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = allContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification(`å·²å¤åˆ¶ ${cardCount} ä¸ªçŸ¥è¯†å¡ç‰‡ï¼`);
                closeCopyDialog();
            });
        }
        
        function getCurrentCardContent() {
            const title = document.getElementById('previewTitle').getAttribute('data-title') || '';
            const content = document.getElementById('markdownOutput').value || '';
            const footer = document.getElementById('previewFooter').getAttribute('data-tags') || '';
            
            let result = '';
            if (title.trim()) {
                result += title + '\n\n';
            }
            if (content.trim()) {
                result += content + '\n\n';
            }
            if (footer.trim()) {
                result += footer;
            }
            
            return result.trim();
        }
        
        function getCardContent(templateId) {
            const templates = {
                knowledge: {
                    title: 'ğŸŒŸ å°çº¢ä¹¦å¡ç‰‡',
                    content: 'ğŸŒŸ ä»Šæ—¥åˆ†äº«\n\nåœ¨è¿™ä¸ªå¿«èŠ‚å¥çš„æ—¶ä»£ï¼Œå­¦ä¼šæ…¢ä¸‹æ¥ä¹Ÿæ˜¯ä¸€ç§æ™ºæ…§ã€‚\n\nç”Ÿæ´»ä¸æ˜¯ä¸€åœºèµ›è·‘ï¼Œè€Œæ˜¯ä¸€æ®µæ—…ç¨‹ã€‚äº«å—è¿‡ç¨‹ï¼Œçæƒœå½“ä¸‹ï¼Œæ‰èƒ½æ”¶è·çœŸæ­£çš„å¿«ä¹ã€‚',
                    footer: '#ç”Ÿæ´»æ„Ÿæ‚Ÿ #ä»Šæ—¥åˆ†äº« #å°çº¢ä¹¦å¡ç‰‡'
                },
                review: {
                    title: 'â­ äº”æ˜Ÿå¥½è¯„',
                    content: 'â­â­â­â­â­ éå¸¸æ»¡æ„ï¼\n\näº§å“è´¨é‡è¶…å‡ºé¢„æœŸï¼ŒåŒ…è£…ç²¾ç¾ï¼Œç‰©æµé€Ÿåº¦å¿«ã€‚å®¢æœæ€åº¦ä¹Ÿå¾ˆå¥½ï¼Œæœ‰é—®å¿…ç­”ã€‚\n\nå·²ç»æ¨èç»™æœ‹å‹äº†ï¼Œä¸‹æ¬¡è¿˜ä¼šå›è´­ï¼',
                    footer: '#äº”æ˜Ÿå¥½è¯„ #è´­ç‰©åˆ†äº« #æ¨èå¥½ç‰©'
                },
                social: {
                    title: 'ğŸŒˆ æœ‹å‹åœˆæ–‡æ¡ˆ',
                    content: 'ğŸŒˆ ç”Ÿæ´»è®°å½•\n\nä»Šå¤©çš„é˜³å…‰åˆšåˆšå¥½ï¼Œå¾®é£ä¸ç‡¥ï¼Œå¿ƒæƒ…ä¹Ÿæ ¼å¤–ç¾ä¸½ã€‚\n\næœ‰æ—¶å€™ï¼Œå¹¸ç¦å°±æ˜¯è¿™ä¹ˆç®€å•ï¼šä¸€æ¯å’–å•¡ï¼Œä¸€æœ¬ä¹¦ï¼Œä¸€ä¸ªå®‰é™çš„åˆåã€‚',
                    footer: '#æœ‹å‹åœˆæ–‡æ¡ˆ #ç”Ÿæ´»è®°å½• #ä»Šæ—¥å¿ƒæƒ…'
                },
                marketing: {
                    title: 'ğŸ¯ è¥é”€æ´»åŠ¨ç­–åˆ’',
                    content: 'ğŸ¯ åŒåä¸€æ´»åŠ¨ç­–åˆ’æ–¹æ¡ˆ\n\nä¸»é¢˜ï¼šç‹‚æ¬¢è´­ç‰©èŠ‚ï¼Œå…¨åœº5æŠ˜èµ·\næ—¶é—´ï¼š11æœˆ1æ—¥-11æœˆ11æ—¥\näº®ç‚¹ï¼šæ»¡å‡ä¼˜æƒ ã€é™æ—¶ç§’æ€ã€æŠ½å¥–æ´»åŠ¨\nç›®æ ‡ï¼šé”€å”®é¢æå‡200%ï¼Œæ–°å®¢å¢é•¿50%',
                    footer: '#è¥é”€ç­–åˆ’ #æ´»åŠ¨ç­–åˆ’ #è¥é”€æ–¹æ¡ˆ'
                },
                video: {
                    title: 'ğŸ¬ çŸ­è§†é¢‘è„šæœ¬',
                    content: 'ğŸ¬ çŸ­è§†é¢‘è„šæœ¬ï¼š30ç§’å­¦ä¼šç†è´¢\n\nã€å¼€åœº5ç§’ã€‘\n"è¿˜åœ¨ä¸ºé’±ä¸å¤Ÿç”¨è€Œçƒ¦æ¼å—ï¼Ÿ"\n\nã€ä¸­é—´20ç§’ã€‘\n"ä»Šå¤©æ•™ä½ 3ä¸ªç®€å•ç†è´¢æŠ€å·§ï¼š\n1. æ¯æœˆå­˜æ”¶å…¥çš„20%\n2. å­¦ä¼šè®°è´¦ï¼Œæ§åˆ¶æ”¯å‡º\n3. æŠ•èµ„è‡ªå·±ï¼Œæå‡æŠ€èƒ½"\n\nã€ç»“å°¾5ç§’ã€‘\n"å…³æ³¨æˆ‘ï¼Œæ¯å¤©å­¦ç‚¹ç†è´¢çŸ¥è¯†ï¼"',
                    footer: '#çŸ­è§†é¢‘è„šæœ¬ #å†…å®¹åˆ›ä½œ #ç†è´¢çŸ¥è¯†'
                },
                live: {
                    title: 'ğŸ¤ ç›´æ’­è¯æœ¯æ¨¡æ¿',
                    content: 'ğŸ¤ ç›´æ’­å¼€åœºè¯æœ¯\n\n"å“ˆå–½å¤§å®¶å¥½ï¼Œæ¬¢è¿æ¥åˆ°ç›´æ’­é—´ï¼\nä»Šå¤©ç»™å¤§å®¶å¸¦æ¥è¶…å€¼å¥½ç‰©ï¼Œ\nå…ˆç‚¹ç‚¹å…³æ³¨ä¸è¿·è·¯ï¼Œ\nç­‰ä¼šå„¿æœ‰æƒŠå–œç¦åˆ©å“¦ï¼"\n\nã€äº§å“ä»‹ç»ã€‘+ã€äº’åŠ¨å¼•å¯¼ã€‘+ã€ä¿ƒå•è¯æœ¯ã€‘',
                    footer: '#ç›´æ’­è¯æœ¯ #ç›´æ’­æŠ€å·§ #é”€å”®è¯æœ¯'
                },
                recruit: {
                    title: 'ğŸ”¥ æ‹›è˜ä¿¡æ¯',
                    content: 'ğŸ”¥ æ‹›è˜ | æ–°åª’ä½“è¿è¥ä¸“å‘˜\n\nã€å²—ä½èŒè´£ã€‘\n- è´Ÿè´£å…¬å¸æ–°åª’ä½“å¹³å°è¿è¥\n- å†…å®¹ç­–åˆ’ä¸æ–‡æ¡ˆæ’°å†™\n- ç²‰ä¸äº’åŠ¨ä¸æ•°æ®åˆ†æ\n\nã€ä»»èŒè¦æ±‚ã€‘\n- æœ¬ç§‘åŠä»¥ä¸Šå­¦å†\n- æœ‰æ–°åª’ä½“è¿è¥ç»éªŒä¼˜å…ˆ\n- åˆ›æ„æ€ç»´æ´»è·ƒï¼Œæ‰§è¡ŒåŠ›å¼º',
                    footer: '#æ‹›è˜ä¿¡æ¯ #æ–°åª’ä½“è¿è¥ #èŒåœºæ‹›è˜'
                }
            };
            
            const template = templates[templateId];
            if (template) {
                return `${template.title}\n\n${template.content}\n\n${template.footer}`;
            }
            return '';
        }

        // äº‹ä»¶ç›‘å¬
        document.addEventListener('DOMContentLoaded', function() {
            // è¾“å…¥æ¡†å®æ—¶æ›´æ–° - ç§»é™¤äº†ä¸å­˜åœ¨çš„titleå’Œfooterå…ƒç´ ç›‘å¬

            // æ¨¡æ¿åˆ‡æ¢
            document.querySelectorAll('.template-item').forEach(item => {
                item.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    document.querySelectorAll('.template-item').forEach(i => i.classList.remove('active'));
                    // æ·»åŠ activeç±»åˆ°å½“å‰é¡¹
                    this.classList.add('active');
                    // åˆ‡æ¢æ¨¡æ¿
                    switchTemplate(this.dataset.template);
                });
            });



            // åˆå§‹åŒ–é¢„è§ˆ
            updatePreview();
            
            // å¥½è¯„æ–‡æ¡ˆäº‹ä»¶ç›‘å¬
            // ç›‘å¬å¥½è¯„æ–‡æ¡ˆè¡¨å•å˜åŒ–ï¼ˆå®æ—¶æ›´æ–°ï¼‰
            const petName = document.getElementById('petName');
            const serviceProject = document.getElementById('serviceProject');
            const serviceExperience = document.getElementById('serviceExperience');
            const doctorName = document.getElementById('doctorName');
            const otherInfo = document.getElementById('otherInfo');
            const wordCount = document.getElementById('wordCount');
            
            // ç¤¾ç¾¤åŠ©æ‰‹äº‹ä»¶ç›‘å¬
            // ç›‘å¬ç¤¾ç¾¤åŠ©æ‰‹è¡¨å•å˜åŒ–ï¼ˆå®æ—¶æ›´æ–°ï¼‰
            const communityType = document.getElementById('communityType');
            const communityTopic = document.getElementById('communityTopic');
            const communityKeywords = document.getElementById('communityKeywords');
            const communityTone = document.getElementById('communityTone');
            const communityTarget = document.getElementById('communityTarget');
            const communityBackground = document.getElementById('communityBackground');
            
            // æ·»åŠ ç¤¾ç¾¤åŠ©æ‰‹å®æ—¶æ›´æ–°ç›‘å¬
            if (communityType) communityType.addEventListener('input', debounce(updateCommunityPreview, 500));
            if (communityTopic) communityTopic.addEventListener('input', debounce(updateCommunityPreview, 500));
            if (communityKeywords) communityKeywords.addEventListener('input', debounce(updateCommunityPreview, 500));
            if (communityTone) communityTone.addEventListener('change', debounce(updateCommunityPreview, 500));
            if (communityTarget) communityTarget.addEventListener('input', debounce(updateCommunityPreview, 500));
            if (communityBackground) communityBackground.addEventListener('input', debounce(updateCommunityPreview, 500));
            
            // ç§»é™¤è‡ªåŠ¨è§¦å‘çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œæ”¹ä¸ºä»…æ‰‹åŠ¨ç”Ÿæˆ
            
            // Markdownè¾“å‡ºæ¡†å®æ—¶ç¼–è¾‘ç›‘å¬
            const markdownOutput = document.getElementById('markdownOutput');
            if (markdownOutput) {
                markdownOutput.addEventListener('input', function() {
                    // è·å–å½“å‰å†…å®¹
                    const content = this.value;
                    
                    // æ›´æ–°é¢„è§ˆåŒºåŸŸçš„æ ‡é¢˜ã€å†…å®¹å’Œæ ‡ç­¾
                    const titleElement = document.getElementById('previewTitle');
                    const contentElement = document.getElementById('previewContent');
                    const footerElement = document.getElementById('previewFooter');
                    
                    // è§£æå†…å®¹ï¼Œæå–æ ‡é¢˜ã€æ­£æ–‡å’Œæ ‡ç­¾
                    const lines = content.split('\n');
                    let title = '';
                    let mainContent = '';
                    let footer = '';
                    
                    for (let line of lines) {
                        line = line.trim();
                        if (!line) continue;
                        
                        // æå–æ ‡é¢˜ï¼ˆä»¥#å¼€å¤´ï¼‰
                        if (line.startsWith('#') && !title) {
                            title = line.replace(/^#+\s*/, '');
                            continue;
                        }
                        
                        // æå–æ ‡ç­¾ï¼ˆä»¥#å¼€å¤´ä½†ä¸æ˜¯æ ‡é¢˜ï¼‰
                        if (line.includes('#') && !line.startsWith('#')) {
                            const tags = line.match(/#\w+/g);
                            if (tags) {
                                footer = line;
                                continue;
                            }
                        }
                        
                        // å…¶ä»–å†…å®¹ä½œä¸ºæ­£æ–‡
                        if (!line.startsWith('#')) {
                            mainContent += line + '\n';
                        }
                    }
                    
                    // æ›´æ–°æ ‡é¢˜
                    if (title.trim()) {
                        titleElement.innerHTML = marked.parse(title);
                        titleElement.style.display = 'block';
                        titleElement.setAttribute('data-title', title);
                    } else {
                        titleElement.style.display = 'none';
                        titleElement.setAttribute('data-title', '');
                    }
                    
                    // æ›´æ–°å†…å®¹
                    if (mainContent.trim()) {
                        contentElement.innerHTML = marked.parse(mainContent.trim());
                        contentElement.style.display = 'block';
                    } else {
                        contentElement.style.display = 'none';
                    }
                    
                    // æ›´æ–°åº•éƒ¨æ ‡ç­¾
                    if (footer.trim()) {
                        footerElement.innerHTML = marked.parse(footer);
                        footerElement.style.display = 'block';
                        footerElement.setAttribute('data-tags', footer);
                    } else {
                        footerElement.style.display = 'none';
                        footerElement.setAttribute('data-tags', '');
                    }
                });
            }
        });
        
        // é˜²æŠ–å‡½æ•°
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // æ›´æ–°ç¤¾ç¾¤æ–‡æ¡ˆé¢„è§ˆ
        function updateCommunityPreview() {
            const communityType = document.getElementById('communityType');
            const communityTopic = document.getElementById('communityTopic');
            const communityKeywords = document.getElementById('communityKeywords');
            const communityTone = document.getElementById('communityTone');
            const communityTarget = document.getElementById('communityTarget');
            const communityBackground = document.getElementById('communityBackground');
            const communityPreviewContent = document.getElementById('communityPreviewContent');
            
            if (!communityPreviewContent) return;
            
            // è·å–å½“å‰è¡¨å•å€¼
            const type = communityType ? communityType.value : '';
            const topic = communityTopic ? communityTopic.value : '';
            const keywords = communityKeywords ? communityKeywords.value : '';
            const tone = communityTone ? communityTone.value : '';
            const target = communityTarget ? communityTarget.value : '';
            const background = communityBackground ? communityBackground.value : '';
            
            // å¦‚æœæœ‰å†…å®¹ï¼Œæ˜¾ç¤ºå®æ—¶é¢„è§ˆ
            if (topic || keywords || target) {
                let preview = '';
                
                if (topic) {
                    preview += `ğŸ¯ **ä¸»é¢˜ï¼š${topic}**\n\n`;
                }
                
                if (type) {
                    preview += `ğŸ“‹ **ç±»å‹ï¼š${getCommunityTypeName(type)}**\n`;
                }
                
                if (tone) {
                    preview += `ğŸ¨ **é£æ ¼ï¼š${getCommunityToneName(tone)}**\n`;
                }
                
                if (target) {
                    preview += `ğŸ‘¥ **ç›®æ ‡ï¼š${target}**\n`;
                }
                
                if (keywords) {
                    preview += `ğŸ·ï¸ **å…³é”®è¯ï¼š${keywords}**\n`;
                }
                
                if (background) {
                    preview += `ğŸ“ **èƒŒæ™¯ï¼š${background.substring(0, 100)}${background.length > 100 ? '...' : ''}**\n`;
                }
                
                preview += '\n---\n\n';
                preview += 'ğŸ’¡ **å®æ—¶é¢„è§ˆ** - ç‚¹å‡»"ç”Ÿæˆç¤¾ç¾¤æ–‡æ¡ˆ"æŒ‰é’®ç”Ÿæˆå®Œæ•´å†…å®¹';
                
                communityPreviewContent.innerHTML = marked.parse(preview);
            } else {
                // æ˜¾ç¤ºé»˜è®¤æç¤º
                communityPreviewContent.innerHTML = marked.parse('ğŸ“ è¯·åœ¨å·¦ä¾§è¾“å…¥åŒºåŸŸå¡«å†™ç›¸å…³ä¿¡æ¯ï¼Œè¿™é‡Œå°†æ˜¾ç¤ºå®æ—¶é¢„è§ˆ...');
            }
        }
    </script>
</body>
</html>