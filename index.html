<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小红书知识卡片编辑器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            display: flex;
            height: 100vh;
            width: 100%;
            margin: 0;
            background: white;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
        }

        /* 左侧边栏 */
        .sidebar {
            width: 15%;
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            border-right: 1px solid #dee2e6;
            padding: 20px;
            overflow-y: auto;
            min-width: 200px;
        }

        .sidebar h2 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 2px solid #007bff;
        }

        .template-item {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .template-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            border-color: #007bff;
        }

        .template-item.active {
            border-color: #007bff;
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
        }

        .template-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .template-desc {
            font-size: 11px;
            opacity: 0.8;
        }

        /* 中间输入区域 */
        .input-area {
            width: 42.5%;
            min-width: 400px;
            padding: 30px;
            background: #fafbfc;
            border-right: 1px solid #e1e4e8;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .input-header {
            margin-bottom: 25px;
        }

        .input-header h3 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 20px;
        }

        .input-header p {
            color: #7f8c8d;
            font-size: 14px;
        }

        .input-group {
            margin-bottom: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .input-group textarea {
            min-height: 120px;
            resize: vertical;
            max-height: 400px;
            flex: 1;
        }

        /* 右侧输出区域 */
        .output-area {
            width: 42.5%;
            background: white;
            padding: 25px;
            overflow-y: auto;
            min-width: 400px;
        }

        .output-header {
            margin-bottom: 25px;
            text-align: center;
        }

        .output-header h3 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 20px;
        }

        .output-header p {
            color: #7f8c8d;
            font-size: 14px;
        }

        .card-preview {
            background: white;
            border-radius: 8px;
            padding: 20px;
            color: #333;
            min-height: 350px;
            border: 1px solid #e1e4e8;
            transition: all 0.3s ease;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 15px;
            line-height: 1.3;
        }

        .card-content {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
            white-space: pre-wrap;
        }

        .card-footer {
            border-top: 1px solid #e1e4e8;
            padding-top: 12px;
            font-size: 12px;
            color: #666;
        }

        .style-controls {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .style-controls h4 {
            margin-bottom: 12px;
            color: #495057;
            font-size: 14px;
        }



        .btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        /* 响应式设计 */
        @media (max-width: 1200px) {
            .container {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar {
                width: 100%;
                order: 2;
                min-width: auto;
            }
            
            .input-area {
                order: 1;
                height: auto;
            }
            
            .output-area {
                width: 100%;
                order: 3;
                min-width: auto;
            }
        }

        @media (max-width: 768px) {
            .container {
                margin: 0;
                box-shadow: none;
            }
            
            .sidebar,
            .input-area,
            .output-area {
                padding: 20px;
            }
            
            .sidebar {
                width: 100%;
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 左侧边栏 -->
        <div class="sidebar">
            <!-- Logo区域 -->
            <div style="text-align: center; margin-bottom: 20px; padding: 20px 15px; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <img src="/xiaohongshu-editor/logo.png" alt="小红书知识卡片编辑器" style="width: 180px; height: auto; max-height: 180px; object-fit: contain; display: block; margin-left: auto; margin-right: auto;">
            </div>
            <h2>🛠️ 创作助手</h2>
            <div class="template-item active" data-template="knowledge">
                <div class="template-title">小红书卡片</div>
                <div class="template-desc">精美知识分享卡片</div>
            </div>
            <div class="template-item" data-template="review">
                <div class="template-title">好评文案</div>
                <div class="template-desc">商品评价文案模板</div>
            </div>
            <div class="template-item" data-template="social">
                <div class="template-title">朋友圈文案</div>
                <div class="template-desc">社交媒体文案创作</div>
            </div>
            <div class="template-item" data-template="marketing">
                <div class="template-title">市场策划</div>
                <div class="template-desc">营销活动策划模板</div>
            </div>
            <div class="template-item" data-template="video">
                <div class="template-title">短视频脚本</div>
                <div class="template-desc">短视频内容脚本创作</div>
            </div>
            <div class="template-item" data-template="live">
                <div class="template-title">直播助手</div>
                <div class="template-desc">直播话术和流程模板</div>
            </div>
            <div class="template-item" data-template="recruit">
                <div class="template-title">招聘助手</div>
                <div class="template-desc">招聘文案和JD模板</div>
            </div>
        </div>

        <!-- 中间输入区域 -->
        <div class="input-area" id="knowledgeInput">
            <div class="input-header">
                <h3>✏️ 内容编辑</h3>
                <p>输入草稿文案，点击AI编辑按钮，查看markdown格式输出</p>
            </div>
            
            <div class="input-group">
                <label for="draftContent">草稿文案</label>
                <textarea id="draftContent" placeholder="在这里输入你的草稿文案..." style="height: 200px;">今天天气很好，适合出去走走。生活中要学会享受当下，不要总是忙碌而忽略了身边的美好。</textarea>
            </div>
            
            <div style="margin: 20px 0;">
                <button class="btn" onclick="aiEditContent()">🤖 AI编辑</button>
                <button class="btn" onclick="clearDraft()">🗑️ 清空草稿</button>
            </div>
            
            <div class="input-group">
                <label for="markdownOutput">Markdown输出</label>
                <textarea id="markdownOutput" placeholder="AI编辑后的markdown内容将显示在这里..." style="height: 300px;"></textarea>
            </div>
            
            <!-- 标题和底部信息已移除，仅保留 Markdown 内容输入 -->

            <!-- 导出按钮已移除 -->
        </div>

        <!-- 好评文案输入区域 -->
        <div class="input-area" id="reviewInput" style="display: none;">
            <div class="input-header">
                <h3>⭐ 好评文案编辑</h3>
                <p>输入商品信息和体验感受，生成专业的好评文案</p>
            </div>
            
            <div class="input-group">
                <label for="petName">🐾 宠物名字</label>
                <input type="text" id="petName" placeholder="请输入宠物的名字..." style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div class="input-group">
                <label for="serviceProject">🏥 服务项目</label>
                <select id="serviceProject" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">请选择服务项目</option>
                    <option value="vaccination">疫苗接种</option>
                    <option value="checkup">健康体检</option>
                    <option value="grooming">美容洗澡</option>
                    <option value="surgery">手术治疗</option>
                    <option value="neutering">绝育手术</option>
                    <option value="dental">口腔护理</option>
                    <option value="boarding">寄养服务</option>
                    <option value="training">训练课程</option>
                    <option value="emergency">急诊服务</option>
                    <option value="other">其他服务</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="serviceExperience">💫 服务体验</label>
                <select id="serviceExperience" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">请选择服务体验</option>
                    <option value="excellent">非常满意 ⭐⭐⭐⭐⭐</option>
                    <option value="good">满意 ⭐⭐⭐⭐</option>
                    <option value="average">一般 ⭐⭐⭐</option>
                    <option value="poor">不满意 ⭐⭐</option>
                    <option value="terrible">非常不满意 ⭐</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="satisfyingDetail">✨ 最满意的服务细节</label>
                <select id="satisfyingDetail" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">请选择最满意的服务细节</option>
                    <option value="professional">专业技术</option>
                    <option value="attitude">服务态度</option>
                    <option value="environment">环境设施</option>
                    <option value="communication">沟通交流</option>
                    <option value="price">价格性价比</option>
                    <option value="efficiency">服务效率</option>
                    <option value="aftercare">术后护理</option>
                    <option value="cleaning">清洁消毒</option>
                    <option value="patience">耐心细致</option>
                    <option value="care">贴心关怀</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="doctorName">👨‍⚕️ 医生/美容师称呼</label>
                <input type="text" id="doctorName" placeholder="请输入医生或美容师的名字或称呼..." style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div class="input-group">
                <label for="otherInfo">📝 其他信息</label>
                <textarea id="otherInfo" placeholder="分享更多细节：环境感受、服务态度、专业程度、价格性价比等..." style="height: 100px;"></textarea>
            </div>
            
            <div class="input-group">
                <label for="wordCount">📊 字数要求</label>
                <select id="wordCount" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">选择字数范围</option>
                    <option value="short">简短 (50-100字)</option>
                    <option value="medium">适中 (100-200字)</option>
                    <option value="long">详细 (200-300字)</option>
                    <option value="verylong">超详细 (300字以上)</option>
                </select>
            </div>
            
            <div style="margin: 20px 0;">
                <button class="btn" onclick="generateReviewContent()">🤖 生成好评文案</button>
                <button class="btn" onclick="clearReviewForm()">🗑️ 清空内容</button>
            </div>
        </div>

        <!-- 右侧输出区域 -->
        <div class="output-area" id="knowledgeOutput">
            <div class="output-header">
                <h3>👁️ 实时预览</h3>
                <p>你的知识卡片效果预览</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="showCopyDialog()">📋 复制知识卡片</button>
            </div>
            
            <div class="card-preview" id="cardPreview">
                <div class="card-title" id="previewTitle">知识卡片标题</div>
                <div class="card-content" id="previewContent">这里是知识卡片的主要内容，你可以在这里分享你的知识、经验或者见解。内容会自动在右侧实时预览。</div>
                <div class="card-footer" id="previewFooter">#知识分享 #学习笔记</div>
            </div>
            
            <!-- 复制选择对话框 -->
            <div id="copyDialog" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 400px; width: 90%;">
                    <h3 style="margin-bottom: 20px; color: #333;">📋 复制当前知识卡片</h3>
                    <div id="cardOptions" style="margin-bottom: 20px;">
                        <!-- 当前卡片选项将在这里动态生成 -->
                    </div>
                    <div style="text-align: center;">
                        <button class="btn" onclick="copyCurrentCard()">确认复制</button>
                        <button class="btn" onclick="closeCopyDialog()" style="background: #6c757d; margin-left: 10px;">取消</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 好评文案输出区域 -->
        <div class="output-area" id="reviewOutput" style="display: none;">
            <div class="output-header">
                <h3>⭐ 好评文案预览</h3>
                <p>您的商品评价文案效果预览</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="toggleReviewEdit()">✏️ 编辑模式</button>
                <button class="btn" onclick="copyReviewContent()">📋 复制好评文案</button>
            </div>
            
            <!-- 编辑模式文本框 -->
            <div id="reviewEditArea" style="display: none; margin-bottom: 20px;">
                <textarea id="reviewEditContent" style="width: 100%; height: 300px; padding: 15px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px; line-height: 1.6; resize: vertical;" placeholder="在这里编辑您的好评文案..."></textarea>
                <div style="margin-top: 10px; text-align: center;">
                    <button class="btn" onclick="saveReviewEdit()">💾 保存编辑</button>
                    <button class="btn" onclick="cancelReviewEdit()" style="background: #6c757d; margin-left: 10px;">❌ 取消</button>
                </div>
            </div>
            
            <!-- 预览模式 -->
            <div class="card-preview" id="reviewPreview">
                <div class="card-content" id="reviewPreviewContent" style="font-size: 14px; line-height: 1.6;">
                    请在左侧输入商品信息，点击生成好评文案按钮来创建您的商品评价...
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // AI编辑功能
        async function aiEditContent() {
            const draftContent = document.getElementById('draftContent').value.trim();
            const markdownOutput = document.getElementById('markdownOutput');
            
            if (!draftContent) {
                alert('请先输入草稿文案！');
                return;
            }

            // 显示加载状态
            markdownOutput.value = '正在AI编辑中，请稍候...';
            markdownOutput.disabled = true;
            
            try {
                // 构建API请求内容
                const apiContent = `你是一位小红书内容专家，你要做小红书知识卡片。请你根据下面${draftContent}里的内容提取总结，设计卡片数量(不少于3张)和每个卡片的内容。(需求)小红书卡片要简洁美观，每张卡片里内容、元素要丰富，正确使用emoji元素，凸显宠物属性。为每一张卡片生成与内容匹配的底部标签信息（3-5个）。`;
                
                // 调用API
                await callAIAPI(apiContent, markdownOutput);
                
            } catch (error) {
                console.error('API调用失败:', error);
                // 如果API调用失败，回退到模拟编辑
                const aiEditedContent = simulateAIEdit(draftContent);
                markdownOutput.value = aiEditedContent;
                markdownOutput.disabled = false;
                
                // 自动生成标题和标签
                const autoTitle = generateTitle(draftContent);
                document.getElementById('title').value = autoTitle;
                const autoTags = generateTags(draftContent);
                document.getElementById('footer').value = autoTags;
                
                updatePreview();
                showNotification('✨ AI编辑完成！（使用模拟数据）');
            }
        }
        
        async function callAIAPI(content, outputElement) {
            const apiUrl = 'https://api.siliconflow.cn/v1/chat/completions';
            const apiKey = 'sk-pyklkjtrarxygqafyidoclbberxhhqbnzmdrafwuuuiusxzd';
            
            const requestBody = {
                model: "deepseek-ai/DeepSeek-V3.1",
                messages: [
                    {
                        role: "user",
                        content: content
                    }
                ],
                stream: true,
                max_tokens: 10000,
                enable_thinking: false,
                thinking_budget: 4096,
                min_p: 0.05,
                stop: null,
                temperature: 0.7,
                top_p: 0.7,
                top_k: 50,
                frequency_penalty: 0.5,
                n: 1,
                response_format: {
                    type: "text"
                }
            };
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });
            
            if (!response.ok) {
                throw new Error(`API请求失败: ${response.status}`);
            }
            
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let accumulatedContent = '';
            
            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                
                const chunk = decoder.decode(value);
                const lines = chunk.split('\n');
                
                for (const line of lines) {
                    if (line.startsWith('data: ')) {
                        const data = line.slice(6);
                        if (data === '[DONE]') continue;
                        
                        try {
                            const parsed = JSON.parse(data);
                            const content = parsed.choices?.[0]?.delta?.content || '';
                            if (content) {
                                accumulatedContent += content;
                                outputElement.value = accumulatedContent;
                                updatePreview();
                            }
                        } catch (e) {
                            // 忽略解析错误
                        }
                    }
                }
            }
            
            outputElement.disabled = false;
            
            // 自动生成标题和标签（已移除对应的输入框，但保留生成功能用于预览）
                const autoTitle = generateTitle(accumulatedContent);
                const autoTags = generateTags(accumulatedContent);
                // 将生成的标题和标签存储在预览元素的数据属性中
                document.getElementById('previewTitle').setAttribute('data-title', autoTitle);
                document.getElementById('previewFooter').setAttribute('data-tags', autoTags);
            
            updatePreview();
            showNotification('✨ AI编辑完成！');
        }

        // 模拟AI编辑（实际项目中替换为真实AI API调用）
        function simulateAIEdit(content) {
            // 根据小红书风格优化内容
            let edited = content;
            
            // 添加emoji和格式化
            if (edited.includes('天气')) {
                edited = '🌤️ ' + edited.replace('天气很好', '**天气超级棒**');
            }
            if (edited.includes('生活')) {
                edited = edited.replace('生活中', '🌟 **生活中**');
            }
            if (edited.includes('享受当下')) {
                edited = edited.replace('享受当下', '**享受当下** ✨');
            }
            if (edited.includes('美好')) {
                edited = edited.replace('美好', '**美好** 🌈');
            }
            
            // 添加标题结构
            edited = `# 🌟 今日分享\n\n${edited}\n\n## 💭 我的感悟\n\n有时候，最简单的幸福就藏在这些平凡的日常里。\n\n## 📝 小贴士\n\n- 💡 学会放慢脚步\n- 🌸 发现身边的美好\n- ✨ 珍惜当下的每一刻`;
            
            return edited;
        }

        // 自动生成标题
        function generateTitle(content) {
            if (content.includes('天气')) return '🌤️ 天气好心情更好';
            if (content.includes('生活')) return '🌟 生活感悟分享';
            if (content.includes('享受')) return '✨ 享受当下的美好';
            return '📝 今日分享';
        }

        // 自动生成标签
        function generateTags(content) {
            const tags = ['#生活分享'];
            if (content.includes('天气')) tags.push('#天气日记');
            if (content.includes('生活')) tags.push('#生活感悟');
            if (content.includes('享受')) tags.push('#享受当下');
            tags.push('#小红书分享');
            return tags.join(' ');
        }

        // 清空草稿
        function clearDraft() {
            document.getElementById('draftContent').value = '';
            document.getElementById('markdownOutput').value = '';
            // 清空预览元素的标题和标签数据
            document.getElementById('previewTitle').setAttribute('data-title', '');
            document.getElementById('previewFooter').setAttribute('data-tags', '');
            updatePreview();
        }

        // 显示通知
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 2000);
        }

        // 添加动画样式
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        function updatePreview() {
            const content = document.getElementById('markdownOutput').value;
            
            // 获取存储在预览元素中的标题和标签
            const titleElement = document.getElementById('previewTitle');
            const footerElement = document.getElementById('previewFooter');
            const title = titleElement.getAttribute('data-title') || '';
            const footer = footerElement.getAttribute('data-tags') || '';

            // 更新标题
            if (title.trim()) {
                titleElement.innerHTML = marked.parse(title);
                titleElement.style.display = 'block';
            } else {
                titleElement.style.display = 'none';
            }

            // 更新内容
            const contentElement = document.getElementById('previewContent');
            if (content.trim()) {
                contentElement.innerHTML = marked.parse(content);
                contentElement.style.display = 'block';
            } else {
                contentElement.style.display = 'none';
            }

            // 更新底部信息
            if (footer.trim()) {
                footerElement.innerHTML = marked.parse(footer);
                footerElement.style.display = 'block';
            } else {
                footerElement.style.display = 'none';
            }
        }

        // 模板切换
        function switchTemplate(templateType) {
            // 隐藏所有输入和输出区域
            document.getElementById('knowledgeInput').style.display = 'none';
            document.getElementById('reviewInput').style.display = 'none';
            document.getElementById('knowledgeOutput').style.display = 'none';
            document.getElementById('reviewOutput').style.display = 'none';
            
            // 根据模板类型显示对应的区域
            if (templateType === 'review') {
                // 显示好评文案区域
                document.getElementById('reviewInput').style.display = 'block';
                document.getElementById('reviewOutput').style.display = 'block';
            } else {
                // 显示知识卡片区域
                document.getElementById('knowledgeInput').style.display = 'block';
                document.getElementById('knowledgeOutput').style.display = 'block';
                
                // 加载对应模板内容
                const templates = {
                    knowledge: {
                        title: '小红书卡片',
                        content: '🌟 今日分享\n\n在这个快节奏的时代，学会慢下来也是一种智慧。\n\n生活不是一场赛跑，而是一段旅程。享受过程，珍惜当下，才能收获真正的快乐。',
                        footer: '#生活感悟 #今日分享 #小红书卡片'
                    },
                    social: {
                        title: '朋友圈文案',
                        content: '🌈 生活记录\n\n今天的阳光刚刚好，微风不燥，心情也格外美丽。\n\n有时候，幸福就是这么简单：一杯咖啡，一本书，一个安静的午后。',
                        footer: '#朋友圈文案 #生活记录 #今日心情'
                    },
                    marketing: {
                        title: '营销活动策划',
                        content: '🎯 双十一活动策划方案\n\n主题：狂欢购物节，全场5折起\n时间：11月1日-11月11日\n亮点：满减优惠、限时秒杀、抽奖活动\n目标：销售额提升200%，新客增长50%',
                        footer: '#营销策划 #活动策划 #营销方案'
                    },
                    video: {
                        title: '短视频脚本',
                        content: '🎬 短视频脚本：30秒学会理财\n\n【开场5秒】\n"还在为钱不够用而烦恼吗？"\n\n【中间20秒】\n"今天教你3个简单理财技巧：\n1. 每月存收入的20%\n2. 学会记账，控制支出\n3. 投资自己，提升技能"\n\n【结尾5秒】\n"关注我，每天学点理财知识！"',
                        footer: '#短视频脚本 #内容创作 #理财知识'
                    },
                    live: {
                        title: '直播话术模板',
                        content: '🎤 直播开场话术\n\n"哈喽大家好，欢迎来到直播间！\n今天给大家带来超值好物，\n先点点关注不迷路，\n等会儿有惊喜福利哦！"\n\n【产品介绍】+【互动引导】+【促单话术】',
                        footer: '#直播话术 #直播技巧 #销售话术'
                    },
                    recruit: {
                        title: '招聘信息',
                        content: '🔥 招聘 | 新媒体运营专员\n\n【岗位职责】\n- 负责公司新媒体平台运营\n- 内容策划与文案撰写\n- 粉丝互动与数据分析\n\n【任职要求】\n- 本科及以上学历\n- 有新媒体运营经验优先\n- 创意思维活跃，执行力强',
                        footer: '#招聘信息 #新媒体运营 #职场招聘'
                    }
                };
                
                const template = templates[templateType];
                if (template) {
                    // 设置markdown内容和预览数据
                    document.getElementById('markdownOutput').value = template.content;
                    document.getElementById('previewTitle').setAttribute('data-title', template.title);
                    document.getElementById('previewFooter').setAttribute('data-tags', template.footer);
                    updatePreview();
                }
            }
        }



        // 重置内容
        function resetContent() {
            document.getElementById('title').value = '';
            document.getElementById('content').value = '';
            document.getElementById('footer').value = '';
            updatePreview();
        }

        // 生成好评文案
        async function generateReviewContent() {
            const petName = document.getElementById('petName').value.trim();
            const serviceProject = document.getElementById('serviceProject').value;
            const serviceExperience = document.getElementById('serviceExperience').value;
            const satisfyingDetail = document.getElementById('satisfyingDetail').value;
            const doctorName = document.getElementById('doctorName').value.trim();
            const otherInfo = document.getElementById('otherInfo').value.trim();
            const wordCount = document.getElementById('wordCount').value;
            
            if (!petName || !serviceProject || !serviceExperience) {
                alert('请填写完整的宠物信息和服务体验！');
                return;
            }
            
            // 获取服务项目的显示名称
            const serviceProjectNames = {
                vaccination: '疫苗接种',
                checkup: '健康体检',
                grooming: '美容洗澡',
                surgery: '手术治疗',
                dental: '口腔护理',
                boarding: '寄养服务',
                training: '训练课程',
                emergency: '急诊服务',
                neutering: '绝育手术',
                other: '其他宠物服务'
            };
            
            // 获取服务体验的显示名称
            const serviceExperienceNames = {
                excellent: '超级满意',
                good: '整体满意',
                average: '一般般',
                poor: '不太满意',
                terrible: '非常不满意'
            };
            
            // 获取最满意服务细节的显示名称
            const satisfyingDetailNames = {
                professional: '专业技术',
                attitude: '服务态度',
                environment: '环境设施',
                communication: '沟通交流',
                price: '价格合理',
                efficiency: '服务效率',
                aftercare: '术后护理',
                cleaning: '清洁消毒',
                patience: '耐心细致',
                care: '贴心关怀'
            };
            
            // 获取字数要求的显示名称
            const wordCountNames = {
                short: '50-100字',
                medium: '100-200字',
                long: '200-300字',
                verylong: '300-500字'
            };
            
            // 构建API请求内容
            const apiContent = `角色 你是一位专业且经验丰富的宠物服务好评生成大师，对宠物服务行业有着深入透彻的了解，擅长依据各类宠物服务相关信息，生成极具真实感、完美契合美团和大众点评主流风格的高质量好评。 技能 技能 1: 生成好评 当接收到输入的变量${petName}、${serviceProjectNames[serviceProject] || '宠物服务'}、${serviceExperienceNames[serviceExperience] || '服务体验'}、${satisfyingDetailNames[satisfyingDetail] || '无'}、${doctorName || '无'}、${wordCountNames[wordCount] || '100-200字'}以及${otherInfo || '无'}时，充分发挥你深厚的语言功底和对宠物服务行业的敏锐洞察，运用丰富多样的语言技巧，生成好评内容。 好评内容要紧密围绕给定信息全方位展开，深度挖掘并突出服务的独特亮点和令人满意之处，从服务态度、专业水平、环境设施等多个维度展现服务的高品质。 生成的好评语言风格要自然流畅、生动活泼且富有感染力，大量运用自然的口语化表达、网络热词、地方方言等，彻底消除AI生成痕迹，与大众点评和美团好评的常见表述高度一致。 技能 2: 规避AI痕迹 植入非标准细节：在好评中巧妙加入宠物昵称、医生姓氏、设备名称等非通用信息，让好评更具个性。 创造情感波动曲线：构建"犹豫 - 决策 - 庆幸"的心理路径，符合真实的消费决策逻辑，使好评更显真实。 绑定具体时空锚点：融入天气、交通状况、节日氛围等不可预测因素，增添好评的真实场景感。 制造合理缺陷：适当提及一些不影响整体好评的小问题，如等待时间稍长等，通过合理负面细节增强好评可信度。 设备操作可视化：将专业的医疗设备以通俗易懂的画面呈现，让消费者更容易理解服务过程。 设计对话体彩蛋：添加医护人员与宠物之间的趣味互动细节，使好评更加生动有趣。 匹配消费水平：明确消费者身份（如上班族、学生等），避免模糊表述。 跨平台内容关联：关联宠物医院自有媒体内容（如公众号文章、抖音视频等），形成证据链闭环，增强好评的说服力。 适当出错：在文案中巧妙出现1个错别字和2个口语化的表述错误，模拟真实用户评价。 限制: 只专注于生成与宠物相关服务好评相关的内容，坚决拒绝回答无关话题。 所输出的好评内容必须严格符合美团、大众点评的常见风格，做到语言通顺、表意清晰、逻辑连贯。 生成的好评内容要精准控制在${wordCountNames[wordCount] || '100-200字'}字数要求内，不超字也不缺字。`;
            
            // 显示加载状态
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            if (reviewPreviewContent) {
                reviewPreviewContent.innerHTML = '🤖 正在生成好评文案，请稍候...';
            }
            
            try {
                // 调用API
                const response = await fetch('https://api.siliconflow.cn/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer sk-khczjbhzxxujbizmolqceicevnyckmddrhtgbhiyhfkzaujs',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-ai/DeepSeek-R1',
                        messages: [
                            {
                                role: 'user',
                                content: apiContent
                            }
                        ],
                        stream: true,
                        max_tokens: 10000,
                        enable_thinking: false,
                        thinking_budget: 4096,
                        min_p: 0.05,
                        temperature: 0.7,
                        top_p: 0.7,
                        top_k: 50,
                        frequency_penalty: 0.5,
                        n: 1,
                        response_format: {
                            type: 'text'
                        }
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API请求失败: ${response.status}`);
                }
                
                // 处理流式响应
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let accumulatedContent = '';
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = line.slice(6);
                            if (data === '[DONE]') continue;
                            
                            try {
                                const parsed = JSON.parse(data);
                                const content = parsed.choices?.[0]?.delta?.content || '';
                                if (content) {
                                    accumulatedContent += content;
                                    // 实时更新预览区域
                                    if (reviewPreviewContent) {
                                        reviewPreviewContent.innerHTML = accumulatedContent.replace(/\n/g, '<br>');
                                    }
                                }
                            } catch (e) {
                                // 忽略解析错误的行
                                continue;
                            }
                        }
                    }
                }
                
                showNotification('✨ AI好评文案生成完成！');
                
            } catch (error) {
                console.error('API调用失败:', error);
                // 如果API调用失败，回退到本地生成
                const fallbackContent = `🐾 ${petName}的${serviceProjectNames[serviceProject] || '宠物服务'}体验\n\n`;
                if (reviewPreviewContent) {
                    reviewPreviewContent.innerHTML = fallbackContent.replace(/\n/g, '<br>');
                }
                showNotification('⚠️ AI生成失败，已使用本地模板');
            }
        }
        
        // 更新好评文案预览
        function updateReviewPreview() {
            const reviewContent = document.getElementById('reviewOutput').value;
            const previewElement = document.getElementById('reviewPreviewContent');
            
            if (reviewContent.trim()) {
                previewElement.innerHTML = marked.parse(reviewContent);
            } else {
                previewElement.innerHTML = '请在左侧输入商品信息，点击生成好评文案按钮来创建您的商品评价...';
            }
        }
        
        // 清空好评文案表单
        function clearReviewForm() {
            document.getElementById('petName').value = '';
            document.getElementById('serviceProject').value = 'vaccination';
            document.getElementById('serviceExperience').value = 'good';
            document.getElementById('satisfyingDetail').value = '';
            document.getElementById('doctorName').value = '';
            document.getElementById('otherInfo').value = '';
            document.getElementById('wordCount').value = 'medium';
            // 清空好评文案预览区域
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            if (reviewPreviewContent) {
                reviewPreviewContent.innerHTML = '请在左侧输入商品信息，点击生成好评文案按钮来创建您的商品评价...';
            }
        }
        
        // 复制好评文案
        function copyReviewContent() {
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            let reviewContent = '';
            
            if (reviewPreviewContent) {
                reviewContent = reviewPreviewContent.innerText || reviewPreviewContent.textContent;
            }
            
            if (!reviewContent.trim() || reviewContent.trim() === '请在左侧输入商品信息，点击生成好评文案按钮来创建您的商品评价...') {
                alert('没有可复制的好评文案！');
                return;
            }
            
            navigator.clipboard.writeText(reviewContent).then(() => {
                showNotification('✅ 好评文案已复制到剪贴板！');
            }).catch(err => {
                // 降级方案
                const textArea = document.createElement('textarea');
                textArea.value = reviewContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('✅ 好评文案已复制到剪贴板！');
            });
        }
        
        // 好评文案编辑功能
        let isReviewEditMode = false;
        let originalReviewContent = '';
        
        function toggleReviewEdit() {
            const reviewEditArea = document.getElementById('reviewEditArea');
            const reviewPreview = document.getElementById('reviewPreview');
            const reviewEditContent = document.getElementById('reviewEditContent');
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            const editBtn = event.target;
            
            if (!isReviewEditMode) {
                // 进入编辑模式
                originalReviewContent = reviewPreviewContent.innerText || reviewPreviewContent.textContent;
                
                if (originalReviewContent.trim() === '请在左侧输入商品信息，点击生成好评文案按钮来创建您的商品评价...') {
                    originalReviewContent = '';
                }
                
                reviewEditContent.value = originalReviewContent;
                reviewEditArea.style.display = 'block';
                reviewPreview.style.display = 'none';
                editBtn.textContent = '👁️ 预览模式';
                editBtn.style.background = '#28a745';
                isReviewEditMode = true;
            } else {
                // 退出编辑模式
                reviewEditArea.style.display = 'none';
                reviewPreview.style.display = 'block';
                editBtn.textContent = '✏️ 编辑模式';
                editBtn.style.background = '#007bff';
                isReviewEditMode = false;
                
                // 更新预览内容
                const editedContent = reviewEditContent.value.trim();
                if (editedContent) {
                    reviewPreviewContent.innerHTML = editedContent.replace(/\n/g, '<br>');
                } else {
                    reviewPreviewContent.innerHTML = '请在左侧输入商品信息，点击生成好评文案按钮来创建您的商品评价...';
                }
            }
        }
        
        function saveReviewEdit() {
            const reviewEditContent = document.getElementById('reviewEditContent');
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            const editedContent = reviewEditContent.value.trim();
            
            if (editedContent) {
                reviewPreviewContent.innerHTML = editedContent.replace(/\n/g, '<br>');
                showNotification('✅ 编辑内容已保存！');
            } else {
                reviewPreviewContent.innerHTML = '请在左侧输入商品信息，点击生成好评文案按钮来创建您的商品评价...';
                showNotification('⚠️ 编辑内容为空，已重置为默认提示');
            }
            
            toggleReviewEdit();
        }
        
        function cancelReviewEdit() {
            const reviewEditContent = document.getElementById('reviewEditContent');
            reviewEditContent.value = originalReviewContent;
            toggleReviewEdit();
            showNotification('❌ 已取消编辑');
        }

        // 导出图片（简化版本）
        function exportCard() {
            alert('导出功能需要额外的库支持，这里提供基础实现思路。\n\n实际项目中可以使用 html2canvas 等库来实现图片导出功能。');
        }

        // 复制功能相关函数
        function showCopyDialog() {
            const dialog = document.getElementById('copyDialog');
            const cardOptions = document.getElementById('cardOptions');
            
            // 获取当前编辑的内容
            const currentContent = getCurrentCardContent();
            const markdownContent = document.getElementById('markdownOutput').value;
            
            cardOptions.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; margin-bottom: 10px;">
                        <input type="checkbox" id="copyCurrent" checked style="margin-right: 8px;">
                        <span style="font-weight: 600;">复制当前编辑的卡片</span>
                    </label>
                    <div style="font-size: 12px; color: #666; margin-left: 24px; margin-bottom: 15px;">
                        ${currentContent.substring(0, 100)}${currentContent.length > 100 ? '...' : ''}
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; margin-bottom: 10px;">
                        <input type="checkbox" id="copyAllTemplates" style="margin-right: 8px;">
                        <span style="font-weight: 600;">复制所有模板卡片</span>
                    </label>
                </div>
                <div style="max-height: 150px; overflow-y: auto; border: 1px solid #e1e4e8; border-radius: 8px; padding: 10px;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;">可选：复制特定模板</div>
                    ${getTemplateOptions()}
                </div>
            `;
            
            // 添加事件监听
            document.getElementById('copyCurrent').addEventListener('change', function() {
                if (this.checked) {
                    document.getElementById('copyAllTemplates').checked = false;
                    document.querySelectorAll('.template-checkbox').forEach(cb => cb.checked = false);
                }
            });
            
            document.getElementById('copyAllTemplates').addEventListener('change', function() {
                if (this.checked) {
                    document.getElementById('copyCurrent').checked = false;
                    document.querySelectorAll('.template-checkbox').forEach(cb => cb.checked = true);
                }
            });
            
            dialog.style.display = 'block';
        }
        
        function getTemplateOptions() {
            const templates = [
                { id: 'knowledge', name: '小红书卡片' },
                { id: 'review', name: '五星好评' },
                { id: 'social', name: '朋友圈文案' },
                { id: 'marketing', name: '营销活动策划' },
                { id: 'video', name: '短视频脚本' },
                { id: 'live', name: '直播话术模板' },
                { id: 'recruit', name: '招聘信息' }
            ];
            
            return templates.map(template => `
                <label style="display: flex; align-items: center; margin-bottom: 6px; padding: 3px; border-radius: 4px; cursor: pointer;">
                    <input type="checkbox" class="template-checkbox" value="${template.id}" style="margin-right: 8px;">
                    <span style="font-size: 12px;">${template.name}</span>
                </label>
            `).join('');
        }
        
        function closeCopyDialog() {
            document.getElementById('copyDialog').style.display = 'none';
        }
        
        function copyCurrentCard() {
            const copyCurrent = document.getElementById('copyCurrent').checked;
            const copyAllTemplates = document.getElementById('copyAllTemplates').checked;
            const selectedTemplates = document.querySelectorAll('.template-checkbox:checked');
            
            let allContent = '';
            let cardCount = 0;
            
            if (copyCurrent) {
                // 复制当前内容
                const currentContent = getCurrentCardContent();
                if (currentContent.trim()) {
                    allContent += currentContent;
                    cardCount++;
                }
            }
            
            if (copyAllTemplates || selectedTemplates.length > 0) {
                // 复制模板内容
                const templatesToCopy = copyAllTemplates ? 
                    ['knowledge', 'review', 'social', 'marketing', 'video', 'live', 'recruit'] :
                    Array.from(selectedTemplates).map(cb => cb.value);
                
                templatesToCopy.forEach((templateId, index) => {
                    const templateContent = getCardContent(templateId);
                    if (templateContent.trim()) {
                        if (allContent) {
                            allContent += '\n\n' + '='.repeat(30) + '\n\n';
                        }
                        allContent += templateContent;
                        cardCount++;
                    }
                });
            }
            
            if (allContent.trim() === '') {
                alert('没有可复制的内容！');
                return;
            }
            
            // 复制到剪贴板
            navigator.clipboard.writeText(allContent).then(() => {
                showNotification(`已复制 ${cardCount} 个知识卡片！`);
                closeCopyDialog();
            }).catch(err => {
                // 降级方案
                const textArea = document.createElement('textarea');
                textArea.value = allContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification(`已复制 ${cardCount} 个知识卡片！`);
                closeCopyDialog();
            });
        }
        
        function getCurrentCardContent() {
            const title = document.getElementById('previewTitle').getAttribute('data-title') || '';
            const content = document.getElementById('markdownOutput').value || '';
            const footer = document.getElementById('previewFooter').getAttribute('data-tags') || '';
            
            let result = '';
            if (title.trim()) {
                result += title + '\n\n';
            }
            if (content.trim()) {
                result += content + '\n\n';
            }
            if (footer.trim()) {
                result += footer;
            }
            
            return result.trim();
        }
        
        function getCardContent(templateId) {
            const templates = {
                knowledge: {
                    title: '🌟 小红书卡片',
                    content: '🌟 今日分享\n\n在这个快节奏的时代，学会慢下来也是一种智慧。\n\n生活不是一场赛跑，而是一段旅程。享受过程，珍惜当下，才能收获真正的快乐。',
                    footer: '#生活感悟 #今日分享 #小红书卡片'
                },
                review: {
                    title: '⭐ 五星好评',
                    content: '⭐⭐⭐⭐⭐ 非常满意！\n\n产品质量超出预期，包装精美，物流速度快。客服态度也很好，有问必答。\n\n已经推荐给朋友了，下次还会回购！',
                    footer: '#五星好评 #购物分享 #推荐好物'
                },
                social: {
                    title: '🌈 朋友圈文案',
                    content: '🌈 生活记录\n\n今天的阳光刚刚好，微风不燥，心情也格外美丽。\n\n有时候，幸福就是这么简单：一杯咖啡，一本书，一个安静的午后。',
                    footer: '#朋友圈文案 #生活记录 #今日心情'
                },
                marketing: {
                    title: '🎯 营销活动策划',
                    content: '🎯 双十一活动策划方案\n\n主题：狂欢购物节，全场5折起\n时间：11月1日-11月11日\n亮点：满减优惠、限时秒杀、抽奖活动\n目标：销售额提升200%，新客增长50%',
                    footer: '#营销策划 #活动策划 #营销方案'
                },
                video: {
                    title: '🎬 短视频脚本',
                    content: '🎬 短视频脚本：30秒学会理财\n\n【开场5秒】\n"还在为钱不够用而烦恼吗？"\n\n【中间20秒】\n"今天教你3个简单理财技巧：\n1. 每月存收入的20%\n2. 学会记账，控制支出\n3. 投资自己，提升技能"\n\n【结尾5秒】\n"关注我，每天学点理财知识！"',
                    footer: '#短视频脚本 #内容创作 #理财知识'
                },
                live: {
                    title: '🎤 直播话术模板',
                    content: '🎤 直播开场话术\n\n"哈喽大家好，欢迎来到直播间！\n今天给大家带来超值好物，\n先点点关注不迷路，\n等会儿有惊喜福利哦！"\n\n【产品介绍】+【互动引导】+【促单话术】',
                    footer: '#直播话术 #直播技巧 #销售话术'
                },
                recruit: {
                    title: '🔥 招聘信息',
                    content: '🔥 招聘 | 新媒体运营专员\n\n【岗位职责】\n- 负责公司新媒体平台运营\n- 内容策划与文案撰写\n- 粉丝互动与数据分析\n\n【任职要求】\n- 本科及以上学历\n- 有新媒体运营经验优先\n- 创意思维活跃，执行力强',
                    footer: '#招聘信息 #新媒体运营 #职场招聘'
                }
            };
            
            const template = templates[templateId];
            if (template) {
                return `${template.title}\n\n${template.content}\n\n${template.footer}`;
            }
            return '';
        }

        // 事件监听
        document.addEventListener('DOMContentLoaded', function() {
            // 输入框实时更新 - 移除了不存在的title和footer元素监听

            // 模板切换
            document.querySelectorAll('.template-item').forEach(item => {
                item.addEventListener('click', function() {
                    // 移除所有active类
                    document.querySelectorAll('.template-item').forEach(i => i.classList.remove('active'));
                    // 添加active类到当前项
                    this.classList.add('active');
                    // 切换模板
                    switchTemplate(this.dataset.template);
                });
            });



            // 初始化预览
            updatePreview();
            
            // 好评文案事件监听
            // 监听好评文案表单变化（实时更新）
            const petName = document.getElementById('petName');
            const serviceProject = document.getElementById('serviceProject');
            const serviceExperience = document.getElementById('serviceExperience');
            const doctorName = document.getElementById('doctorName');
            const otherInfo = document.getElementById('otherInfo');
            const wordCount = document.getElementById('wordCount');
            
            // 移除自动触发的事件监听器，改为仅手动生成
            
            // Markdown输出框实时编辑监听
            const markdownOutput = document.getElementById('markdownOutput');
            if (markdownOutput) {
                markdownOutput.addEventListener('input', function() {
                    // 获取当前内容
                    const content = this.value;
                    
                    // 更新预览区域的标题、内容和标签
                    const titleElement = document.getElementById('previewTitle');
                    const contentElement = document.getElementById('previewContent');
                    const footerElement = document.getElementById('previewFooter');
                    
                    // 解析内容，提取标题、正文和标签
                    const lines = content.split('\n');
                    let title = '';
                    let mainContent = '';
                    let footer = '';
                    
                    for (let line of lines) {
                        line = line.trim();
                        if (!line) continue;
                        
                        // 提取标题（以#开头）
                        if (line.startsWith('#') && !title) {
                            title = line.replace(/^#+\s*/, '');
                            continue;
                        }
                        
                        // 提取标签（以#开头但不是标题）
                        if (line.includes('#') && !line.startsWith('#')) {
                            const tags = line.match(/#\w+/g);
                            if (tags) {
                                footer = line;
                                continue;
                            }
                        }
                        
                        // 其他内容作为正文
                        if (!line.startsWith('#')) {
                            mainContent += line + '\n';
                        }
                    }
                    
                    // 更新标题
                    if (title.trim()) {
                        titleElement.innerHTML = marked.parse(title);
                        titleElement.style.display = 'block';
                        titleElement.setAttribute('data-title', title);
                    } else {
                        titleElement.style.display = 'none';
                        titleElement.setAttribute('data-title', '');
                    }
                    
                    // 更新内容
                    if (mainContent.trim()) {
                        contentElement.innerHTML = marked.parse(mainContent.trim());
                        contentElement.style.display = 'block';
                    } else {
                        contentElement.style.display = 'none';
                    }
                    
                    // 更新底部标签
                    if (footer.trim()) {
                        footerElement.innerHTML = marked.parse(footer);
                        footerElement.style.display = 'block';
                        footerElement.setAttribute('data-tags', footer);
                    } else {
                        footerElement.style.display = 'none';
                        footerElement.setAttribute('data-tags', '');
                    }
                });
            }
        });
    </script>
</body>
</html>