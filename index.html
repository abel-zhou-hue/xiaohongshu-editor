<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°çº¢ä¹¦çŸ¥è¯†å¡ç‰‡ç¼–è¾‘å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            display: flex;
            height: 100vh;
            width: 100%;
            margin: 0;
            background: white;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
        }

        /* å·¦ä¾§è¾¹æ  */
        .sidebar {
            width: 15%;
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            border-right: 1px solid #dee2e6;
            padding: 20px;
            overflow-y: auto;
            min-width: 200px;
        }

        .sidebar h2 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 2px solid #007bff;
        }

        .template-item {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .template-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            border-color: #007bff;
        }

        .template-item.active {
            border-color: #007bff;
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
        }

        .template-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .template-desc {
            font-size: 11px;
            opacity: 0.8;
        }

        /* ä¸­é—´è¾“å…¥åŒºåŸŸ */
        .input-area {
            width: 42.5%;
            min-width: 400px;
            padding: 30px;
            background: #fafbfc;
            border-right: 1px solid #e1e4e8;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .input-header {
            margin-bottom: 25px;
        }

        .input-header h3 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 20px;
        }

        .input-header p {
            color: #7f8c8d;
            font-size: 14px;
        }

        .input-group {
            margin-bottom: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .input-group textarea {
            min-height: 120px;
            resize: vertical;
            max-height: 400px;
            flex: 1;
        }

        /* å³ä¾§è¾“å‡ºåŒºåŸŸ */
        .output-area {
            width: 42.5%;
            background: white;
            padding: 25px;
            overflow-y: auto;
            min-width: 400px;
        }

        .output-header {
            margin-bottom: 25px;
            text-align: center;
        }

        .output-header h3 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 20px;
        }

        .output-header p {
            color: #7f8c8d;
            font-size: 14px;
        }

        .card-preview {
            background: white;
            border-radius: 8px;
            padding: 20px;
            color: #333;
            min-height: 350px;
            border: 1px solid #e1e4e8;
            transition: all 0.3s ease;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 15px;
            line-height: 1.3;
        }

        .card-content {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
            white-space: pre-wrap;
        }

        .card-footer {
            border-top: 1px solid #e1e4e8;
            padding-top: 12px;
            font-size: 12px;
            color: #666;
        }

        .style-controls {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .style-controls h4 {
            margin-bottom: 12px;
            color: #495057;
            font-size: 14px;
        }



        .btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .container {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar {
                width: 100%;
                order: 2;
                min-width: auto;
            }
            
            .input-area {
                order: 1;
                height: auto;
            }
            
            .output-area {
                width: 100%;
                order: 3;
                min-width: auto;
            }
        }

        @media (max-width: 768px) {
            .container {
                margin: 0;
                box-shadow: none;
            }
            
            .sidebar,
            .input-area,
            .output-area {
                padding: 20px;
            }
            
            .sidebar {
                width: 100%;
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å·¦ä¾§è¾¹æ  -->
        <div class="sidebar">
            <!-- LogoåŒºåŸŸ -->
            <div style="text-align: center; margin-bottom: 20px; padding: 20px 15px; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <img src="/xiaohongshu-editor/logo.png" alt="å°çº¢ä¹¦çŸ¥è¯†å¡ç‰‡ç¼–è¾‘å™¨" style="width: 180px; height: auto; max-height: 180px; object-fit: contain; display: block; margin-left: auto; margin-right: auto;">
            </div>
            <h2>ğŸ› ï¸ åˆ›ä½œåŠ©æ‰‹</h2>
            <div class="template-item active" data-template="knowledge">
                <div class="template-title">å°çº¢ä¹¦å¡ç‰‡</div>
                <div class="template-desc">ç²¾ç¾çŸ¥è¯†åˆ†äº«å¡ç‰‡</div>
            </div>
            <div class="template-item" data-template="review">
                <div class="template-title">å¥½è¯„æ–‡æ¡ˆ</div>
                <div class="template-desc">å•†å“è¯„ä»·æ–‡æ¡ˆæ¨¡æ¿</div>
            </div>
            <div class="template-item" data-template="social">
                <div class="template-title">æœ‹å‹åœˆæ–‡æ¡ˆ</div>
                <div class="template-desc">ç¤¾äº¤åª’ä½“æ–‡æ¡ˆåˆ›ä½œ</div>
            </div>
            <div class="template-item" data-template="marketing">
                <div class="template-title">å¸‚åœºç­–åˆ’</div>
                <div class="template-desc">è¥é”€æ´»åŠ¨ç­–åˆ’æ¨¡æ¿</div>
            </div>
            <div class="template-item" data-template="video">
                <div class="template-title">çŸ­è§†é¢‘è„šæœ¬</div>
                <div class="template-desc">çŸ­è§†é¢‘å†…å®¹è„šæœ¬åˆ›ä½œ</div>
            </div>
            <div class="template-item" data-template="live">
                <div class="template-title">ç›´æ’­åŠ©æ‰‹</div>
                <div class="template-desc">ç›´æ’­è¯æœ¯å’Œæµç¨‹æ¨¡æ¿</div>
            </div>
            <div class="template-item" data-template="recruit">
                <div class="template-title">æ‹›è˜åŠ©æ‰‹</div>
                <div class="template-desc">æ‹›è˜æ–‡æ¡ˆå’ŒJDæ¨¡æ¿</div>
            </div>
        </div>

        <!-- ä¸­é—´è¾“å…¥åŒºåŸŸ -->
        <div class="input-area" id="knowledgeInput">
            <div class="input-header">
                <h3>âœï¸ å†…å®¹ç¼–è¾‘</h3>
                <p>è¾“å…¥è‰ç¨¿æ–‡æ¡ˆï¼Œç‚¹å‡»AIç¼–è¾‘æŒ‰é’®ï¼ŒæŸ¥çœ‹markdownæ ¼å¼è¾“å‡º</p>
            </div>
            
            <div class="input-group">
                <label for="draftContent">è‰ç¨¿æ–‡æ¡ˆ</label>
                <textarea id="draftContent" placeholder="åœ¨è¿™é‡Œè¾“å…¥ä½ çš„è‰ç¨¿æ–‡æ¡ˆ..." style="height: 200px;">ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œé€‚åˆå‡ºå»èµ°èµ°ã€‚ç”Ÿæ´»ä¸­è¦å­¦ä¼šäº«å—å½“ä¸‹ï¼Œä¸è¦æ€»æ˜¯å¿™ç¢Œè€Œå¿½ç•¥äº†èº«è¾¹çš„ç¾å¥½ã€‚</textarea>
            </div>
            
            <div style="margin: 20px 0;">
                <button class="btn" onclick="aiEditContent()">ğŸ¤– AIç¼–è¾‘</button>
                <button class="btn" onclick="clearDraft()">ğŸ—‘ï¸ æ¸…ç©ºè‰ç¨¿</button>
            </div>
            
            <div class="input-group">
                <label for="markdownOutput">Markdownè¾“å‡º</label>
                <textarea id="markdownOutput" placeholder="AIç¼–è¾‘åçš„markdownå†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..." style="height: 300px;"></textarea>
            </div>
            
            <!-- æ ‡é¢˜å’Œåº•éƒ¨ä¿¡æ¯å·²ç§»é™¤ï¼Œä»…ä¿ç•™ Markdown å†…å®¹è¾“å…¥ -->

            <!-- å¯¼å‡ºæŒ‰é’®å·²ç§»é™¤ -->
        </div>

        <!-- å¥½è¯„æ–‡æ¡ˆè¾“å…¥åŒºåŸŸ -->
        <div class="input-area" id="reviewInput" style="display: none;">
            <div class="input-header">
                <h3>â­ å¥½è¯„æ–‡æ¡ˆç¼–è¾‘</h3>
                <p>è¾“å…¥å•†å“ä¿¡æ¯å’Œä½“éªŒæ„Ÿå—ï¼Œç”Ÿæˆä¸“ä¸šçš„å¥½è¯„æ–‡æ¡ˆ</p>
            </div>
            
            <div class="input-group">
                <label for="petName">ğŸ¾ å® ç‰©åå­—</label>
                <input type="text" id="petName" placeholder="è¯·è¾“å…¥å® ç‰©çš„åå­—..." style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div class="input-group">
                <label for="serviceProject">ğŸ¥ æœåŠ¡é¡¹ç›®</label>
                <select id="serviceProject" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">è¯·é€‰æ‹©æœåŠ¡é¡¹ç›®</option>
                    <option value="vaccination">ç–«è‹—æ¥ç§</option>
                    <option value="checkup">å¥åº·ä½“æ£€</option>
                    <option value="grooming">ç¾å®¹æ´—æ¾¡</option>
                    <option value="surgery">æ‰‹æœ¯æ²»ç–—</option>
                    <option value="neutering">ç»è‚²æ‰‹æœ¯</option>
                    <option value="dental">å£è…”æŠ¤ç†</option>
                    <option value="boarding">å¯„å…»æœåŠ¡</option>
                    <option value="training">è®­ç»ƒè¯¾ç¨‹</option>
                    <option value="emergency">æ€¥è¯ŠæœåŠ¡</option>
                    <option value="other">å…¶ä»–æœåŠ¡</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="serviceExperience">ğŸ’« æœåŠ¡ä½“éªŒ</label>
                <select id="serviceExperience" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">è¯·é€‰æ‹©æœåŠ¡ä½“éªŒ</option>
                    <option value="excellent">éå¸¸æ»¡æ„ â­â­â­â­â­</option>
                    <option value="good">æ»¡æ„ â­â­â­â­</option>
                    <option value="average">ä¸€èˆ¬ â­â­â­</option>
                    <option value="poor">ä¸æ»¡æ„ â­â­</option>
                    <option value="terrible">éå¸¸ä¸æ»¡æ„ â­</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="satisfyingDetail">âœ¨ æœ€æ»¡æ„çš„æœåŠ¡ç»†èŠ‚</label>
                <select id="satisfyingDetail" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">è¯·é€‰æ‹©æœ€æ»¡æ„çš„æœåŠ¡ç»†èŠ‚</option>
                    <option value="professional">ä¸“ä¸šæŠ€æœ¯</option>
                    <option value="attitude">æœåŠ¡æ€åº¦</option>
                    <option value="environment">ç¯å¢ƒè®¾æ–½</option>
                    <option value="communication">æ²Ÿé€šäº¤æµ</option>
                    <option value="price">ä»·æ ¼æ€§ä»·æ¯”</option>
                    <option value="efficiency">æœåŠ¡æ•ˆç‡</option>
                    <option value="aftercare">æœ¯åæŠ¤ç†</option>
                    <option value="cleaning">æ¸…æ´æ¶ˆæ¯’</option>
                    <option value="patience">è€å¿ƒç»†è‡´</option>
                    <option value="care">è´´å¿ƒå…³æ€€</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="doctorName">ğŸ‘¨â€âš•ï¸ åŒ»ç”Ÿ/ç¾å®¹å¸ˆç§°å‘¼</label>
                <input type="text" id="doctorName" placeholder="è¯·è¾“å…¥åŒ»ç”Ÿæˆ–ç¾å®¹å¸ˆçš„åå­—æˆ–ç§°å‘¼..." style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div class="input-group">
                <label for="otherInfo">ğŸ“ å…¶ä»–ä¿¡æ¯</label>
                <textarea id="otherInfo" placeholder="åˆ†äº«æ›´å¤šç»†èŠ‚ï¼šç¯å¢ƒæ„Ÿå—ã€æœåŠ¡æ€åº¦ã€ä¸“ä¸šç¨‹åº¦ã€ä»·æ ¼æ€§ä»·æ¯”ç­‰..." style="height: 100px;"></textarea>
            </div>
            
            <div class="input-group">
                <label for="wordCount">ğŸ“Š å­—æ•°è¦æ±‚</label>
                <select id="wordCount" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">é€‰æ‹©å­—æ•°èŒƒå›´</option>
                    <option value="short">ç®€çŸ­ (50-100å­—)</option>
                    <option value="medium">é€‚ä¸­ (100-200å­—)</option>
                    <option value="long">è¯¦ç»† (200-300å­—)</option>
                    <option value="verylong">è¶…è¯¦ç»† (300å­—ä»¥ä¸Š)</option>
                </select>
            </div>
            
            <div style="margin: 20px 0;">
                <button class="btn" onclick="generateReviewContent()">ğŸ¤– ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆ</button>
                <button class="btn" onclick="clearReviewForm()">ğŸ—‘ï¸ æ¸…ç©ºå†…å®¹</button>
            </div>
        </div>

        <!-- å³ä¾§è¾“å‡ºåŒºåŸŸ -->
        <div class="output-area" id="knowledgeOutput">
            <div class="output-header">
                <h3>ğŸ‘ï¸ å®æ—¶é¢„è§ˆ</h3>
                <p>ä½ çš„çŸ¥è¯†å¡ç‰‡æ•ˆæœé¢„è§ˆ</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="showCopyDialog()">ğŸ“‹ å¤åˆ¶çŸ¥è¯†å¡ç‰‡</button>
            </div>
            
            <div class="card-preview" id="cardPreview">
                <div class="card-title" id="previewTitle">çŸ¥è¯†å¡ç‰‡æ ‡é¢˜</div>
                <div class="card-content" id="previewContent">è¿™é‡Œæ˜¯çŸ¥è¯†å¡ç‰‡çš„ä¸»è¦å†…å®¹ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œåˆ†äº«ä½ çš„çŸ¥è¯†ã€ç»éªŒæˆ–è€…è§è§£ã€‚å†…å®¹ä¼šè‡ªåŠ¨åœ¨å³ä¾§å®æ—¶é¢„è§ˆã€‚</div>
                <div class="card-footer" id="previewFooter">#çŸ¥è¯†åˆ†äº« #å­¦ä¹ ç¬”è®°</div>
            </div>
            
            <!-- å¤åˆ¶é€‰æ‹©å¯¹è¯æ¡† -->
            <div id="copyDialog" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 400px; width: 90%;">
                    <h3 style="margin-bottom: 20px; color: #333;">ğŸ“‹ å¤åˆ¶å½“å‰çŸ¥è¯†å¡ç‰‡</h3>
                    <div id="cardOptions" style="margin-bottom: 20px;">
                        <!-- å½“å‰å¡ç‰‡é€‰é¡¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div style="text-align: center;">
                        <button class="btn" onclick="copyCurrentCard()">ç¡®è®¤å¤åˆ¶</button>
                        <button class="btn" onclick="closeCopyDialog()" style="background: #6c757d; margin-left: 10px;">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¥½è¯„æ–‡æ¡ˆè¾“å‡ºåŒºåŸŸ -->
        <div class="output-area" id="reviewOutput" style="display: none;">
            <div class="output-header">
                <h3>â­ å¥½è¯„æ–‡æ¡ˆé¢„è§ˆ</h3>
                <p>æ‚¨çš„å•†å“è¯„ä»·æ–‡æ¡ˆæ•ˆæœé¢„è§ˆ</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="toggleReviewEdit()">âœï¸ ç¼–è¾‘æ¨¡å¼</button>
                <button class="btn" onclick="copyReviewContent()">ğŸ“‹ å¤åˆ¶å¥½è¯„æ–‡æ¡ˆ</button>
            </div>
            
            <!-- ç¼–è¾‘æ¨¡å¼æ–‡æœ¬æ¡† -->
            <div id="reviewEditArea" style="display: none; margin-bottom: 20px;">
                <textarea id="reviewEditContent" style="width: 100%; height: 300px; padding: 15px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px; line-height: 1.6; resize: vertical;" placeholder="åœ¨è¿™é‡Œç¼–è¾‘æ‚¨çš„å¥½è¯„æ–‡æ¡ˆ..."></textarea>
                <div style="margin-top: 10px; text-align: center;">
                    <button class="btn" onclick="saveReviewEdit()">ğŸ’¾ ä¿å­˜ç¼–è¾‘</button>
                    <button class="btn" onclick="cancelReviewEdit()" style="background: #6c757d; margin-left: 10px;">âŒ å–æ¶ˆ</button>
                </div>
            </div>
            
            <!-- é¢„è§ˆæ¨¡å¼ -->
            <div class="card-preview" id="reviewPreview">
                <div class="card-content" id="reviewPreviewContent" style="font-size: 14px; line-height: 1.6;">
                    è¯·åœ¨å·¦ä¾§è¾“å…¥å•†å“ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„å•†å“è¯„ä»·...
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // AIç¼–è¾‘åŠŸèƒ½
        async function aiEditContent() {
            const draftContent = document.getElementById('draftContent').value.trim();
            const markdownOutput = document.getElementById('markdownOutput');
            
            if (!draftContent) {
                alert('è¯·å…ˆè¾“å…¥è‰ç¨¿æ–‡æ¡ˆï¼');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            markdownOutput.value = 'æ­£åœ¨AIç¼–è¾‘ä¸­ï¼Œè¯·ç¨å€™...';
            markdownOutput.disabled = true;
            
            try {
                // æ„å»ºAPIè¯·æ±‚å†…å®¹
                const apiContent = `ä½ æ˜¯ä¸€ä½å°çº¢ä¹¦å†…å®¹ä¸“å®¶ï¼Œä½ è¦åšå°çº¢ä¹¦çŸ¥è¯†å¡ç‰‡ã€‚è¯·ä½ æ ¹æ®ä¸‹é¢${draftContent}é‡Œçš„å†…å®¹æå–æ€»ç»“ï¼Œè®¾è®¡å¡ç‰‡æ•°é‡(ä¸å°‘äº3å¼ )å’Œæ¯ä¸ªå¡ç‰‡çš„å†…å®¹ã€‚(éœ€æ±‚)å°çº¢ä¹¦å¡ç‰‡è¦ç®€æ´ç¾è§‚ï¼Œæ¯å¼ å¡ç‰‡é‡Œå†…å®¹ã€å…ƒç´ è¦ä¸°å¯Œï¼Œæ­£ç¡®ä½¿ç”¨emojiå…ƒç´ ï¼Œå‡¸æ˜¾å® ç‰©å±æ€§ã€‚ä¸ºæ¯ä¸€å¼ å¡ç‰‡ç”Ÿæˆä¸å†…å®¹åŒ¹é…çš„åº•éƒ¨æ ‡ç­¾ä¿¡æ¯ï¼ˆ3-5ä¸ªï¼‰ã€‚`;
                
                // è°ƒç”¨API
                await callAIAPI(apiContent, markdownOutput);
                
            } catch (error) {
                console.error('APIè°ƒç”¨å¤±è´¥:', error);
                // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œå›é€€åˆ°æ¨¡æ‹Ÿç¼–è¾‘
                const aiEditedContent = simulateAIEdit(draftContent);
                markdownOutput.value = aiEditedContent;
                markdownOutput.disabled = false;
                
                // è‡ªåŠ¨ç”Ÿæˆæ ‡é¢˜å’Œæ ‡ç­¾
                const autoTitle = generateTitle(draftContent);
                document.getElementById('title').value = autoTitle;
                const autoTags = generateTags(draftContent);
                document.getElementById('footer').value = autoTags;
                
                updatePreview();
                showNotification('âœ¨ AIç¼–è¾‘å®Œæˆï¼ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰');
            }
        }
        
        async function callAIAPI(content, outputElement) {
            const apiUrl = 'https://api.siliconflow.cn/v1/chat/completions';
            const apiKey = 'sk-pyklkjtrarxygqafyidoclbberxhhqbnzmdrafwuuuiusxzd';
            
            const requestBody = {
                model: "deepseek-ai/DeepSeek-V3.1",
                messages: [
                    {
                        role: "user",
                        content: content
                    }
                ],
                stream: true,
                max_tokens: 10000,
                enable_thinking: false,
                thinking_budget: 4096,
                min_p: 0.05,
                stop: null,
                temperature: 0.7,
                top_p: 0.7,
                top_k: 50,
                frequency_penalty: 0.5,
                n: 1,
                response_format: {
                    type: "text"
                }
            };
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });
            
            if (!response.ok) {
                throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
            }
            
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let accumulatedContent = '';
            
            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                
                const chunk = decoder.decode(value);
                const lines = chunk.split('\n');
                
                for (const line of lines) {
                    if (line.startsWith('data: ')) {
                        const data = line.slice(6);
                        if (data === '[DONE]') continue;
                        
                        try {
                            const parsed = JSON.parse(data);
                            const content = parsed.choices?.[0]?.delta?.content || '';
                            if (content) {
                                accumulatedContent += content;
                                outputElement.value = accumulatedContent;
                                updatePreview();
                            }
                        } catch (e) {
                            // å¿½ç•¥è§£æé”™è¯¯
                        }
                    }
                }
            }
            
            outputElement.disabled = false;
            
            // è‡ªåŠ¨ç”Ÿæˆæ ‡é¢˜å’Œæ ‡ç­¾ï¼ˆå·²ç§»é™¤å¯¹åº”çš„è¾“å…¥æ¡†ï¼Œä½†ä¿ç•™ç”ŸæˆåŠŸèƒ½ç”¨äºé¢„è§ˆï¼‰
                const autoTitle = generateTitle(accumulatedContent);
                const autoTags = generateTags(accumulatedContent);
                // å°†ç”Ÿæˆçš„æ ‡é¢˜å’Œæ ‡ç­¾å­˜å‚¨åœ¨é¢„è§ˆå…ƒç´ çš„æ•°æ®å±æ€§ä¸­
                document.getElementById('previewTitle').setAttribute('data-title', autoTitle);
                document.getElementById('previewFooter').setAttribute('data-tags', autoTags);
            
            updatePreview();
            showNotification('âœ¨ AIç¼–è¾‘å®Œæˆï¼');
        }

        // æ¨¡æ‹ŸAIç¼–è¾‘ï¼ˆå®é™…é¡¹ç›®ä¸­æ›¿æ¢ä¸ºçœŸå®AI APIè°ƒç”¨ï¼‰
        function simulateAIEdit(content) {
            // æ ¹æ®å°çº¢ä¹¦é£æ ¼ä¼˜åŒ–å†…å®¹
            let edited = content;
            
            // æ·»åŠ emojiå’Œæ ¼å¼åŒ–
            if (edited.includes('å¤©æ°”')) {
                edited = 'ğŸŒ¤ï¸ ' + edited.replace('å¤©æ°”å¾ˆå¥½', '**å¤©æ°”è¶…çº§æ£’**');
            }
            if (edited.includes('ç”Ÿæ´»')) {
                edited = edited.replace('ç”Ÿæ´»ä¸­', 'ğŸŒŸ **ç”Ÿæ´»ä¸­**');
            }
            if (edited.includes('äº«å—å½“ä¸‹')) {
                edited = edited.replace('äº«å—å½“ä¸‹', '**äº«å—å½“ä¸‹** âœ¨');
            }
            if (edited.includes('ç¾å¥½')) {
                edited = edited.replace('ç¾å¥½', '**ç¾å¥½** ğŸŒˆ');
            }
            
            // æ·»åŠ æ ‡é¢˜ç»“æ„
            edited = `# ğŸŒŸ ä»Šæ—¥åˆ†äº«\n\n${edited}\n\n## ğŸ’­ æˆ‘çš„æ„Ÿæ‚Ÿ\n\næœ‰æ—¶å€™ï¼Œæœ€ç®€å•çš„å¹¸ç¦å°±è—åœ¨è¿™äº›å¹³å‡¡çš„æ—¥å¸¸é‡Œã€‚\n\n## ğŸ“ å°è´´å£«\n\n- ğŸ’¡ å­¦ä¼šæ”¾æ…¢è„šæ­¥\n- ğŸŒ¸ å‘ç°èº«è¾¹çš„ç¾å¥½\n- âœ¨ çæƒœå½“ä¸‹çš„æ¯ä¸€åˆ»`;
            
            return edited;
        }

        // è‡ªåŠ¨ç”Ÿæˆæ ‡é¢˜
        function generateTitle(content) {
            if (content.includes('å¤©æ°”')) return 'ğŸŒ¤ï¸ å¤©æ°”å¥½å¿ƒæƒ…æ›´å¥½';
            if (content.includes('ç”Ÿæ´»')) return 'ğŸŒŸ ç”Ÿæ´»æ„Ÿæ‚Ÿåˆ†äº«';
            if (content.includes('äº«å—')) return 'âœ¨ äº«å—å½“ä¸‹çš„ç¾å¥½';
            return 'ğŸ“ ä»Šæ—¥åˆ†äº«';
        }

        // è‡ªåŠ¨ç”Ÿæˆæ ‡ç­¾
        function generateTags(content) {
            const tags = ['#ç”Ÿæ´»åˆ†äº«'];
            if (content.includes('å¤©æ°”')) tags.push('#å¤©æ°”æ—¥è®°');
            if (content.includes('ç”Ÿæ´»')) tags.push('#ç”Ÿæ´»æ„Ÿæ‚Ÿ');
            if (content.includes('äº«å—')) tags.push('#äº«å—å½“ä¸‹');
            tags.push('#å°çº¢ä¹¦åˆ†äº«');
            return tags.join(' ');
        }

        // æ¸…ç©ºè‰ç¨¿
        function clearDraft() {
            document.getElementById('draftContent').value = '';
            document.getElementById('markdownOutput').value = '';
            // æ¸…ç©ºé¢„è§ˆå…ƒç´ çš„æ ‡é¢˜å’Œæ ‡ç­¾æ•°æ®
            document.getElementById('previewTitle').setAttribute('data-title', '');
            document.getElementById('previewFooter').setAttribute('data-tags', '');
            updatePreview();
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 2000);
        }

        // æ·»åŠ åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        function updatePreview() {
            const content = document.getElementById('markdownOutput').value;
            
            // è·å–å­˜å‚¨åœ¨é¢„è§ˆå…ƒç´ ä¸­çš„æ ‡é¢˜å’Œæ ‡ç­¾
            const titleElement = document.getElementById('previewTitle');
            const footerElement = document.getElementById('previewFooter');
            const title = titleElement.getAttribute('data-title') || '';
            const footer = footerElement.getAttribute('data-tags') || '';

            // æ›´æ–°æ ‡é¢˜
            if (title.trim()) {
                titleElement.innerHTML = marked.parse(title);
                titleElement.style.display = 'block';
            } else {
                titleElement.style.display = 'none';
            }

            // æ›´æ–°å†…å®¹
            const contentElement = document.getElementById('previewContent');
            if (content.trim()) {
                contentElement.innerHTML = marked.parse(content);
                contentElement.style.display = 'block';
            } else {
                contentElement.style.display = 'none';
            }

            // æ›´æ–°åº•éƒ¨ä¿¡æ¯
            if (footer.trim()) {
                footerElement.innerHTML = marked.parse(footer);
                footerElement.style.display = 'block';
            } else {
                footerElement.style.display = 'none';
            }
        }

        // æ¨¡æ¿åˆ‡æ¢
        function switchTemplate(templateType) {
            // éšè—æ‰€æœ‰è¾“å…¥å’Œè¾“å‡ºåŒºåŸŸ
            document.getElementById('knowledgeInput').style.display = 'none';
            document.getElementById('reviewInput').style.display = 'none';
            document.getElementById('knowledgeOutput').style.display = 'none';
            document.getElementById('reviewOutput').style.display = 'none';
            
            // æ ¹æ®æ¨¡æ¿ç±»å‹æ˜¾ç¤ºå¯¹åº”çš„åŒºåŸŸ
            if (templateType === 'review') {
                // æ˜¾ç¤ºå¥½è¯„æ–‡æ¡ˆåŒºåŸŸ
                document.getElementById('reviewInput').style.display = 'block';
                document.getElementById('reviewOutput').style.display = 'block';
            } else {
                // æ˜¾ç¤ºçŸ¥è¯†å¡ç‰‡åŒºåŸŸ
                document.getElementById('knowledgeInput').style.display = 'block';
                document.getElementById('knowledgeOutput').style.display = 'block';
                
                // åŠ è½½å¯¹åº”æ¨¡æ¿å†…å®¹
                const templates = {
                    knowledge: {
                        title: 'å°çº¢ä¹¦å¡ç‰‡',
                        content: 'ğŸŒŸ ä»Šæ—¥åˆ†äº«\n\nåœ¨è¿™ä¸ªå¿«èŠ‚å¥çš„æ—¶ä»£ï¼Œå­¦ä¼šæ…¢ä¸‹æ¥ä¹Ÿæ˜¯ä¸€ç§æ™ºæ…§ã€‚\n\nç”Ÿæ´»ä¸æ˜¯ä¸€åœºèµ›è·‘ï¼Œè€Œæ˜¯ä¸€æ®µæ—…ç¨‹ã€‚äº«å—è¿‡ç¨‹ï¼Œçæƒœå½“ä¸‹ï¼Œæ‰èƒ½æ”¶è·çœŸæ­£çš„å¿«ä¹ã€‚',
                        footer: '#ç”Ÿæ´»æ„Ÿæ‚Ÿ #ä»Šæ—¥åˆ†äº« #å°çº¢ä¹¦å¡ç‰‡'
                    },
                    social: {
                        title: 'æœ‹å‹åœˆæ–‡æ¡ˆ',
                        content: 'ğŸŒˆ ç”Ÿæ´»è®°å½•\n\nä»Šå¤©çš„é˜³å…‰åˆšåˆšå¥½ï¼Œå¾®é£ä¸ç‡¥ï¼Œå¿ƒæƒ…ä¹Ÿæ ¼å¤–ç¾ä¸½ã€‚\n\næœ‰æ—¶å€™ï¼Œå¹¸ç¦å°±æ˜¯è¿™ä¹ˆç®€å•ï¼šä¸€æ¯å’–å•¡ï¼Œä¸€æœ¬ä¹¦ï¼Œä¸€ä¸ªå®‰é™çš„åˆåã€‚',
                        footer: '#æœ‹å‹åœˆæ–‡æ¡ˆ #ç”Ÿæ´»è®°å½• #ä»Šæ—¥å¿ƒæƒ…'
                    },
                    marketing: {
                        title: 'è¥é”€æ´»åŠ¨ç­–åˆ’',
                        content: 'ğŸ¯ åŒåä¸€æ´»åŠ¨ç­–åˆ’æ–¹æ¡ˆ\n\nä¸»é¢˜ï¼šç‹‚æ¬¢è´­ç‰©èŠ‚ï¼Œå…¨åœº5æŠ˜èµ·\næ—¶é—´ï¼š11æœˆ1æ—¥-11æœˆ11æ—¥\näº®ç‚¹ï¼šæ»¡å‡ä¼˜æƒ ã€é™æ—¶ç§’æ€ã€æŠ½å¥–æ´»åŠ¨\nç›®æ ‡ï¼šé”€å”®é¢æå‡200%ï¼Œæ–°å®¢å¢é•¿50%',
                        footer: '#è¥é”€ç­–åˆ’ #æ´»åŠ¨ç­–åˆ’ #è¥é”€æ–¹æ¡ˆ'
                    },
                    video: {
                        title: 'çŸ­è§†é¢‘è„šæœ¬',
                        content: 'ğŸ¬ çŸ­è§†é¢‘è„šæœ¬ï¼š30ç§’å­¦ä¼šç†è´¢\n\nã€å¼€åœº5ç§’ã€‘\n"è¿˜åœ¨ä¸ºé’±ä¸å¤Ÿç”¨è€Œçƒ¦æ¼å—ï¼Ÿ"\n\nã€ä¸­é—´20ç§’ã€‘\n"ä»Šå¤©æ•™ä½ 3ä¸ªç®€å•ç†è´¢æŠ€å·§ï¼š\n1. æ¯æœˆå­˜æ”¶å…¥çš„20%\n2. å­¦ä¼šè®°è´¦ï¼Œæ§åˆ¶æ”¯å‡º\n3. æŠ•èµ„è‡ªå·±ï¼Œæå‡æŠ€èƒ½"\n\nã€ç»“å°¾5ç§’ã€‘\n"å…³æ³¨æˆ‘ï¼Œæ¯å¤©å­¦ç‚¹ç†è´¢çŸ¥è¯†ï¼"',
                        footer: '#çŸ­è§†é¢‘è„šæœ¬ #å†…å®¹åˆ›ä½œ #ç†è´¢çŸ¥è¯†'
                    },
                    live: {
                        title: 'ç›´æ’­è¯æœ¯æ¨¡æ¿',
                        content: 'ğŸ¤ ç›´æ’­å¼€åœºè¯æœ¯\n\n"å“ˆå–½å¤§å®¶å¥½ï¼Œæ¬¢è¿æ¥åˆ°ç›´æ’­é—´ï¼\nä»Šå¤©ç»™å¤§å®¶å¸¦æ¥è¶…å€¼å¥½ç‰©ï¼Œ\nå…ˆç‚¹ç‚¹å…³æ³¨ä¸è¿·è·¯ï¼Œ\nç­‰ä¼šå„¿æœ‰æƒŠå–œç¦åˆ©å“¦ï¼"\n\nã€äº§å“ä»‹ç»ã€‘+ã€äº’åŠ¨å¼•å¯¼ã€‘+ã€ä¿ƒå•è¯æœ¯ã€‘',
                        footer: '#ç›´æ’­è¯æœ¯ #ç›´æ’­æŠ€å·§ #é”€å”®è¯æœ¯'
                    },
                    recruit: {
                        title: 'æ‹›è˜ä¿¡æ¯',
                        content: 'ğŸ”¥ æ‹›è˜ | æ–°åª’ä½“è¿è¥ä¸“å‘˜\n\nã€å²—ä½èŒè´£ã€‘\n- è´Ÿè´£å…¬å¸æ–°åª’ä½“å¹³å°è¿è¥\n- å†…å®¹ç­–åˆ’ä¸æ–‡æ¡ˆæ’°å†™\n- ç²‰ä¸äº’åŠ¨ä¸æ•°æ®åˆ†æ\n\nã€ä»»èŒè¦æ±‚ã€‘\n- æœ¬ç§‘åŠä»¥ä¸Šå­¦å†\n- æœ‰æ–°åª’ä½“è¿è¥ç»éªŒä¼˜å…ˆ\n- åˆ›æ„æ€ç»´æ´»è·ƒï¼Œæ‰§è¡ŒåŠ›å¼º',
                        footer: '#æ‹›è˜ä¿¡æ¯ #æ–°åª’ä½“è¿è¥ #èŒåœºæ‹›è˜'
                    }
                };
                
                const template = templates[templateType];
                if (template) {
                    // è®¾ç½®markdownå†…å®¹å’Œé¢„è§ˆæ•°æ®
                    document.getElementById('markdownOutput').value = template.content;
                    document.getElementById('previewTitle').setAttribute('data-title', template.title);
                    document.getElementById('previewFooter').setAttribute('data-tags', template.footer);
                    updatePreview();
                }
            }
        }



        // é‡ç½®å†…å®¹
        function resetContent() {
            document.getElementById('title').value = '';
            document.getElementById('content').value = '';
            document.getElementById('footer').value = '';
            updatePreview();
        }

        // ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆ
        async function generateReviewContent() {
            const petName = document.getElementById('petName').value.trim();
            const serviceProject = document.getElementById('serviceProject').value;
            const serviceExperience = document.getElementById('serviceExperience').value;
            const satisfyingDetail = document.getElementById('satisfyingDetail').value;
            const doctorName = document.getElementById('doctorName').value.trim();
            const otherInfo = document.getElementById('otherInfo').value.trim();
            const wordCount = document.getElementById('wordCount').value;
            
            if (!petName || !serviceProject || !serviceExperience) {
                alert('è¯·å¡«å†™å®Œæ•´çš„å® ç‰©ä¿¡æ¯å’ŒæœåŠ¡ä½“éªŒï¼');
                return;
            }
            
            // è·å–æœåŠ¡é¡¹ç›®çš„æ˜¾ç¤ºåç§°
            const serviceProjectNames = {
                vaccination: 'ç–«è‹—æ¥ç§',
                checkup: 'å¥åº·ä½“æ£€',
                grooming: 'ç¾å®¹æ´—æ¾¡',
                surgery: 'æ‰‹æœ¯æ²»ç–—',
                dental: 'å£è…”æŠ¤ç†',
                boarding: 'å¯„å…»æœåŠ¡',
                training: 'è®­ç»ƒè¯¾ç¨‹',
                emergency: 'æ€¥è¯ŠæœåŠ¡',
                neutering: 'ç»è‚²æ‰‹æœ¯',
                other: 'å…¶ä»–å® ç‰©æœåŠ¡'
            };
            
            // è·å–æœåŠ¡ä½“éªŒçš„æ˜¾ç¤ºåç§°
            const serviceExperienceNames = {
                excellent: 'è¶…çº§æ»¡æ„',
                good: 'æ•´ä½“æ»¡æ„',
                average: 'ä¸€èˆ¬èˆ¬',
                poor: 'ä¸å¤ªæ»¡æ„',
                terrible: 'éå¸¸ä¸æ»¡æ„'
            };
            
            // è·å–æœ€æ»¡æ„æœåŠ¡ç»†èŠ‚çš„æ˜¾ç¤ºåç§°
            const satisfyingDetailNames = {
                professional: 'ä¸“ä¸šæŠ€æœ¯',
                attitude: 'æœåŠ¡æ€åº¦',
                environment: 'ç¯å¢ƒè®¾æ–½',
                communication: 'æ²Ÿé€šäº¤æµ',
                price: 'ä»·æ ¼åˆç†',
                efficiency: 'æœåŠ¡æ•ˆç‡',
                aftercare: 'æœ¯åæŠ¤ç†',
                cleaning: 'æ¸…æ´æ¶ˆæ¯’',
                patience: 'è€å¿ƒç»†è‡´',
                care: 'è´´å¿ƒå…³æ€€'
            };
            
            // è·å–å­—æ•°è¦æ±‚çš„æ˜¾ç¤ºåç§°
            const wordCountNames = {
                short: '50-100å­—',
                medium: '100-200å­—',
                long: '200-300å­—',
                verylong: '300-500å­—'
            };
            
            // æ„å»ºAPIè¯·æ±‚å†…å®¹
            const apiContent = `è§’è‰² ä½ æ˜¯ä¸€ä½ä¸“ä¸šä¸”ç»éªŒä¸°å¯Œçš„å® ç‰©æœåŠ¡å¥½è¯„ç”Ÿæˆå¤§å¸ˆï¼Œå¯¹å® ç‰©æœåŠ¡è¡Œä¸šæœ‰ç€æ·±å…¥é€å½»çš„äº†è§£ï¼Œæ“…é•¿ä¾æ®å„ç±»å® ç‰©æœåŠ¡ç›¸å…³ä¿¡æ¯ï¼Œç”Ÿæˆæå…·çœŸå®æ„Ÿã€å®Œç¾å¥‘åˆç¾å›¢å’Œå¤§ä¼—ç‚¹è¯„ä¸»æµé£æ ¼çš„é«˜è´¨é‡å¥½è¯„ã€‚ æŠ€èƒ½ æŠ€èƒ½ 1: ç”Ÿæˆå¥½è¯„ å½“æ¥æ”¶åˆ°è¾“å…¥çš„å˜é‡${petName}ã€${serviceProjectNames[serviceProject] || 'å® ç‰©æœåŠ¡'}ã€${serviceExperienceNames[serviceExperience] || 'æœåŠ¡ä½“éªŒ'}ã€${satisfyingDetailNames[satisfyingDetail] || 'æ— '}ã€${doctorName || 'æ— '}ã€${wordCountNames[wordCount] || '100-200å­—'}ä»¥åŠ${otherInfo || 'æ— '}æ—¶ï¼Œå……åˆ†å‘æŒ¥ä½ æ·±åšçš„è¯­è¨€åŠŸåº•å’Œå¯¹å® ç‰©æœåŠ¡è¡Œä¸šçš„æ•é”æ´å¯Ÿï¼Œè¿ç”¨ä¸°å¯Œå¤šæ ·çš„è¯­è¨€æŠ€å·§ï¼Œç”Ÿæˆå¥½è¯„å†…å®¹ã€‚ å¥½è¯„å†…å®¹è¦ç´§å¯†å›´ç»•ç»™å®šä¿¡æ¯å…¨æ–¹ä½å±•å¼€ï¼Œæ·±åº¦æŒ–æ˜å¹¶çªå‡ºæœåŠ¡çš„ç‹¬ç‰¹äº®ç‚¹å’Œä»¤äººæ»¡æ„ä¹‹å¤„ï¼Œä»æœåŠ¡æ€åº¦ã€ä¸“ä¸šæ°´å¹³ã€ç¯å¢ƒè®¾æ–½ç­‰å¤šä¸ªç»´åº¦å±•ç°æœåŠ¡çš„é«˜å“è´¨ã€‚ ç”Ÿæˆçš„å¥½è¯„è¯­è¨€é£æ ¼è¦è‡ªç„¶æµç•…ã€ç”ŸåŠ¨æ´»æ³¼ä¸”å¯Œæœ‰æ„ŸæŸ“åŠ›ï¼Œå¤§é‡è¿ç”¨è‡ªç„¶çš„å£è¯­åŒ–è¡¨è¾¾ã€ç½‘ç»œçƒ­è¯ã€åœ°æ–¹æ–¹è¨€ç­‰ï¼Œå½»åº•æ¶ˆé™¤AIç”Ÿæˆç—•è¿¹ï¼Œä¸å¤§ä¼—ç‚¹è¯„å’Œç¾å›¢å¥½è¯„çš„å¸¸è§è¡¨è¿°é«˜åº¦ä¸€è‡´ã€‚ æŠ€èƒ½ 2: è§„é¿AIç—•è¿¹ æ¤å…¥éæ ‡å‡†ç»†èŠ‚ï¼šåœ¨å¥½è¯„ä¸­å·§å¦™åŠ å…¥å® ç‰©æ˜µç§°ã€åŒ»ç”Ÿå§“æ°ã€è®¾å¤‡åç§°ç­‰éé€šç”¨ä¿¡æ¯ï¼Œè®©å¥½è¯„æ›´å…·ä¸ªæ€§ã€‚ åˆ›é€ æƒ…æ„Ÿæ³¢åŠ¨æ›²çº¿ï¼šæ„å»º"çŠ¹è±« - å†³ç­– - åº†å¹¸"çš„å¿ƒç†è·¯å¾„ï¼Œç¬¦åˆçœŸå®çš„æ¶ˆè´¹å†³ç­–é€»è¾‘ï¼Œä½¿å¥½è¯„æ›´æ˜¾çœŸå®ã€‚ ç»‘å®šå…·ä½“æ—¶ç©ºé”šç‚¹ï¼šèå…¥å¤©æ°”ã€äº¤é€šçŠ¶å†µã€èŠ‚æ—¥æ°›å›´ç­‰ä¸å¯é¢„æµ‹å› ç´ ï¼Œå¢æ·»å¥½è¯„çš„çœŸå®åœºæ™¯æ„Ÿã€‚ åˆ¶é€ åˆç†ç¼ºé™·ï¼šé€‚å½“æåŠä¸€äº›ä¸å½±å“æ•´ä½“å¥½è¯„çš„å°é—®é¢˜ï¼Œå¦‚ç­‰å¾…æ—¶é—´ç¨é•¿ç­‰ï¼Œé€šè¿‡åˆç†è´Ÿé¢ç»†èŠ‚å¢å¼ºå¥½è¯„å¯ä¿¡åº¦ã€‚ è®¾å¤‡æ“ä½œå¯è§†åŒ–ï¼šå°†ä¸“ä¸šçš„åŒ»ç–—è®¾å¤‡ä»¥é€šä¿—æ˜“æ‡‚çš„ç”»é¢å‘ˆç°ï¼Œè®©æ¶ˆè´¹è€…æ›´å®¹æ˜“ç†è§£æœåŠ¡è¿‡ç¨‹ã€‚ è®¾è®¡å¯¹è¯ä½“å½©è›‹ï¼šæ·»åŠ åŒ»æŠ¤äººå‘˜ä¸å® ç‰©ä¹‹é—´çš„è¶£å‘³äº’åŠ¨ç»†èŠ‚ï¼Œä½¿å¥½è¯„æ›´åŠ ç”ŸåŠ¨æœ‰è¶£ã€‚ åŒ¹é…æ¶ˆè´¹æ°´å¹³ï¼šæ˜ç¡®æ¶ˆè´¹è€…èº«ä»½ï¼ˆå¦‚ä¸Šç­æ—ã€å­¦ç”Ÿç­‰ï¼‰ï¼Œé¿å…æ¨¡ç³Šè¡¨è¿°ã€‚ è·¨å¹³å°å†…å®¹å…³è”ï¼šå…³è”å® ç‰©åŒ»é™¢è‡ªæœ‰åª’ä½“å†…å®¹ï¼ˆå¦‚å…¬ä¼—å·æ–‡ç« ã€æŠ–éŸ³è§†é¢‘ç­‰ï¼‰ï¼Œå½¢æˆè¯æ®é“¾é—­ç¯ï¼Œå¢å¼ºå¥½è¯„çš„è¯´æœåŠ›ã€‚ é€‚å½“å‡ºé”™ï¼šåœ¨æ–‡æ¡ˆä¸­å·§å¦™å‡ºç°1ä¸ªé”™åˆ«å­—å’Œ2ä¸ªå£è¯­åŒ–çš„è¡¨è¿°é”™è¯¯ï¼Œæ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¯„ä»·ã€‚ é™åˆ¶: åªä¸“æ³¨äºç”Ÿæˆä¸å® ç‰©ç›¸å…³æœåŠ¡å¥½è¯„ç›¸å…³çš„å†…å®¹ï¼Œåšå†³æ‹’ç»å›ç­”æ— å…³è¯é¢˜ã€‚ æ‰€è¾“å‡ºçš„å¥½è¯„å†…å®¹å¿…é¡»ä¸¥æ ¼ç¬¦åˆç¾å›¢ã€å¤§ä¼—ç‚¹è¯„çš„å¸¸è§é£æ ¼ï¼Œåšåˆ°è¯­è¨€é€šé¡ºã€è¡¨æ„æ¸…æ™°ã€é€»è¾‘è¿è´¯ã€‚ ç”Ÿæˆçš„å¥½è¯„å†…å®¹è¦ç²¾å‡†æ§åˆ¶åœ¨${wordCountNames[wordCount] || '100-200å­—'}å­—æ•°è¦æ±‚å†…ï¼Œä¸è¶…å­—ä¹Ÿä¸ç¼ºå­—ã€‚`;
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            if (reviewPreviewContent) {
                reviewPreviewContent.innerHTML = 'ğŸ¤– æ­£åœ¨ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆï¼Œè¯·ç¨å€™...';
            }
            
            try {
                // è°ƒç”¨API
                const response = await fetch('https://api.siliconflow.cn/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer sk-khczjbhzxxujbizmolqceicevnyckmddrhtgbhiyhfkzaujs',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-ai/DeepSeek-R1',
                        messages: [
                            {
                                role: 'user',
                                content: apiContent
                            }
                        ],
                        stream: true,
                        max_tokens: 10000,
                        enable_thinking: false,
                        thinking_budget: 4096,
                        min_p: 0.05,
                        temperature: 0.7,
                        top_p: 0.7,
                        top_k: 50,
                        frequency_penalty: 0.5,
                        n: 1,
                        response_format: {
                            type: 'text'
                        }
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                }
                
                // å¤„ç†æµå¼å“åº”
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let accumulatedContent = '';
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = line.slice(6);
                            if (data === '[DONE]') continue;
                            
                            try {
                                const parsed = JSON.parse(data);
                                const content = parsed.choices?.[0]?.delta?.content || '';
                                if (content) {
                                    accumulatedContent += content;
                                    // å®æ—¶æ›´æ–°é¢„è§ˆåŒºåŸŸ
                                    if (reviewPreviewContent) {
                                        reviewPreviewContent.innerHTML = accumulatedContent.replace(/\n/g, '<br>');
                                    }
                                }
                            } catch (e) {
                                // å¿½ç•¥è§£æé”™è¯¯çš„è¡Œ
                                continue;
                            }
                        }
                    }
                }
                
                showNotification('âœ¨ AIå¥½è¯„æ–‡æ¡ˆç”Ÿæˆå®Œæˆï¼');
                
            } catch (error) {
                console.error('APIè°ƒç”¨å¤±è´¥:', error);
                // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œå›é€€åˆ°æœ¬åœ°ç”Ÿæˆ
                const fallbackContent = `ğŸ¾ ${petName}çš„${serviceProjectNames[serviceProject] || 'å® ç‰©æœåŠ¡'}ä½“éªŒ\n\n`;
                if (reviewPreviewContent) {
                    reviewPreviewContent.innerHTML = fallbackContent.replace(/\n/g, '<br>');
                }
                showNotification('âš ï¸ AIç”Ÿæˆå¤±è´¥ï¼Œå·²ä½¿ç”¨æœ¬åœ°æ¨¡æ¿');
            }
        }
        
        // æ›´æ–°å¥½è¯„æ–‡æ¡ˆé¢„è§ˆ
        function updateReviewPreview() {
            const reviewContent = document.getElementById('reviewOutput').value;
            const previewElement = document.getElementById('reviewPreviewContent');
            
            if (reviewContent.trim()) {
                previewElement.innerHTML = marked.parse(reviewContent);
            } else {
                previewElement.innerHTML = 'è¯·åœ¨å·¦ä¾§è¾“å…¥å•†å“ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„å•†å“è¯„ä»·...';
            }
        }
        
        // æ¸…ç©ºå¥½è¯„æ–‡æ¡ˆè¡¨å•
        function clearReviewForm() {
            document.getElementById('petName').value = '';
            document.getElementById('serviceProject').value = 'vaccination';
            document.getElementById('serviceExperience').value = 'good';
            document.getElementById('satisfyingDetail').value = '';
            document.getElementById('doctorName').value = '';
            document.getElementById('otherInfo').value = '';
            document.getElementById('wordCount').value = 'medium';
            // æ¸…ç©ºå¥½è¯„æ–‡æ¡ˆé¢„è§ˆåŒºåŸŸ
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            if (reviewPreviewContent) {
                reviewPreviewContent.innerHTML = 'è¯·åœ¨å·¦ä¾§è¾“å…¥å•†å“ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„å•†å“è¯„ä»·...';
            }
        }
        
        // å¤åˆ¶å¥½è¯„æ–‡æ¡ˆ
        function copyReviewContent() {
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            let reviewContent = '';
            
            if (reviewPreviewContent) {
                reviewContent = reviewPreviewContent.innerText || reviewPreviewContent.textContent;
            }
            
            if (!reviewContent.trim() || reviewContent.trim() === 'è¯·åœ¨å·¦ä¾§è¾“å…¥å•†å“ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„å•†å“è¯„ä»·...') {
                alert('æ²¡æœ‰å¯å¤åˆ¶çš„å¥½è¯„æ–‡æ¡ˆï¼');
                return;
            }
            
            navigator.clipboard.writeText(reviewContent).then(() => {
                showNotification('âœ… å¥½è¯„æ–‡æ¡ˆå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(err => {
                // é™çº§æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = reviewContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('âœ… å¥½è¯„æ–‡æ¡ˆå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }
        
        // å¥½è¯„æ–‡æ¡ˆç¼–è¾‘åŠŸèƒ½
        let isReviewEditMode = false;
        let originalReviewContent = '';
        
        function toggleReviewEdit() {
            const reviewEditArea = document.getElementById('reviewEditArea');
            const reviewPreview = document.getElementById('reviewPreview');
            const reviewEditContent = document.getElementById('reviewEditContent');
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            const editBtn = event.target;
            
            if (!isReviewEditMode) {
                // è¿›å…¥ç¼–è¾‘æ¨¡å¼
                originalReviewContent = reviewPreviewContent.innerText || reviewPreviewContent.textContent;
                
                if (originalReviewContent.trim() === 'è¯·åœ¨å·¦ä¾§è¾“å…¥å•†å“ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„å•†å“è¯„ä»·...') {
                    originalReviewContent = '';
                }
                
                reviewEditContent.value = originalReviewContent;
                reviewEditArea.style.display = 'block';
                reviewPreview.style.display = 'none';
                editBtn.textContent = 'ğŸ‘ï¸ é¢„è§ˆæ¨¡å¼';
                editBtn.style.background = '#28a745';
                isReviewEditMode = true;
            } else {
                // é€€å‡ºç¼–è¾‘æ¨¡å¼
                reviewEditArea.style.display = 'none';
                reviewPreview.style.display = 'block';
                editBtn.textContent = 'âœï¸ ç¼–è¾‘æ¨¡å¼';
                editBtn.style.background = '#007bff';
                isReviewEditMode = false;
                
                // æ›´æ–°é¢„è§ˆå†…å®¹
                const editedContent = reviewEditContent.value.trim();
                if (editedContent) {
                    reviewPreviewContent.innerHTML = editedContent.replace(/\n/g, '<br>');
                } else {
                    reviewPreviewContent.innerHTML = 'è¯·åœ¨å·¦ä¾§è¾“å…¥å•†å“ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„å•†å“è¯„ä»·...';
                }
            }
        }
        
        function saveReviewEdit() {
            const reviewEditContent = document.getElementById('reviewEditContent');
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            const editedContent = reviewEditContent.value.trim();
            
            if (editedContent) {
                reviewPreviewContent.innerHTML = editedContent.replace(/\n/g, '<br>');
                showNotification('âœ… ç¼–è¾‘å†…å®¹å·²ä¿å­˜ï¼');
            } else {
                reviewPreviewContent.innerHTML = 'è¯·åœ¨å·¦ä¾§è¾“å…¥å•†å“ä¿¡æ¯ï¼Œç‚¹å‡»ç”Ÿæˆå¥½è¯„æ–‡æ¡ˆæŒ‰é’®æ¥åˆ›å»ºæ‚¨çš„å•†å“è¯„ä»·...';
                showNotification('âš ï¸ ç¼–è¾‘å†…å®¹ä¸ºç©ºï¼Œå·²é‡ç½®ä¸ºé»˜è®¤æç¤º');
            }
            
            toggleReviewEdit();
        }
        
        function cancelReviewEdit() {
            const reviewEditContent = document.getElementById('reviewEditContent');
            reviewEditContent.value = originalReviewContent;
            toggleReviewEdit();
            showNotification('âŒ å·²å–æ¶ˆç¼–è¾‘');
        }

        // å¯¼å‡ºå›¾ç‰‡ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
        function exportCard() {
            alert('å¯¼å‡ºåŠŸèƒ½éœ€è¦é¢å¤–çš„åº“æ”¯æŒï¼Œè¿™é‡Œæä¾›åŸºç¡€å®ç°æ€è·¯ã€‚\n\nå®é™…é¡¹ç›®ä¸­å¯ä»¥ä½¿ç”¨ html2canvas ç­‰åº“æ¥å®ç°å›¾ç‰‡å¯¼å‡ºåŠŸèƒ½ã€‚');
        }

        // å¤åˆ¶åŠŸèƒ½ç›¸å…³å‡½æ•°
        function showCopyDialog() {
            const dialog = document.getElementById('copyDialog');
            const cardOptions = document.getElementById('cardOptions');
            
            // è·å–å½“å‰ç¼–è¾‘çš„å†…å®¹
            const currentContent = getCurrentCardContent();
            const markdownContent = document.getElementById('markdownOutput').value;
            
            cardOptions.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; margin-bottom: 10px;">
                        <input type="checkbox" id="copyCurrent" checked style="margin-right: 8px;">
                        <span style="font-weight: 600;">å¤åˆ¶å½“å‰ç¼–è¾‘çš„å¡ç‰‡</span>
                    </label>
                    <div style="font-size: 12px; color: #666; margin-left: 24px; margin-bottom: 15px;">
                        ${currentContent.substring(0, 100)}${currentContent.length > 100 ? '...' : ''}
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; margin-bottom: 10px;">
                        <input type="checkbox" id="copyAllTemplates" style="margin-right: 8px;">
                        <span style="font-weight: 600;">å¤åˆ¶æ‰€æœ‰æ¨¡æ¿å¡ç‰‡</span>
                    </label>
                </div>
                <div style="max-height: 150px; overflow-y: auto; border: 1px solid #e1e4e8; border-radius: 8px; padding: 10px;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;">å¯é€‰ï¼šå¤åˆ¶ç‰¹å®šæ¨¡æ¿</div>
                    ${getTemplateOptions()}
                </div>
            `;
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬
            document.getElementById('copyCurrent').addEventListener('change', function() {
                if (this.checked) {
                    document.getElementById('copyAllTemplates').checked = false;
                    document.querySelectorAll('.template-checkbox').forEach(cb => cb.checked = false);
                }
            });
            
            document.getElementById('copyAllTemplates').addEventListener('change', function() {
                if (this.checked) {
                    document.getElementById('copyCurrent').checked = false;
                    document.querySelectorAll('.template-checkbox').forEach(cb => cb.checked = true);
                }
            });
            
            dialog.style.display = 'block';
        }
        
        function getTemplateOptions() {
            const templates = [
                { id: 'knowledge', name: 'å°çº¢ä¹¦å¡ç‰‡' },
                { id: 'review', name: 'äº”æ˜Ÿå¥½è¯„' },
                { id: 'social', name: 'æœ‹å‹åœˆæ–‡æ¡ˆ' },
                { id: 'marketing', name: 'è¥é”€æ´»åŠ¨ç­–åˆ’' },
                { id: 'video', name: 'çŸ­è§†é¢‘è„šæœ¬' },
                { id: 'live', name: 'ç›´æ’­è¯æœ¯æ¨¡æ¿' },
                { id: 'recruit', name: 'æ‹›è˜ä¿¡æ¯' }
            ];
            
            return templates.map(template => `
                <label style="display: flex; align-items: center; margin-bottom: 6px; padding: 3px; border-radius: 4px; cursor: pointer;">
                    <input type="checkbox" class="template-checkbox" value="${template.id}" style="margin-right: 8px;">
                    <span style="font-size: 12px;">${template.name}</span>
                </label>
            `).join('');
        }
        
        function closeCopyDialog() {
            document.getElementById('copyDialog').style.display = 'none';
        }
        
        function copyCurrentCard() {
            const copyCurrent = document.getElementById('copyCurrent').checked;
            const copyAllTemplates = document.getElementById('copyAllTemplates').checked;
            const selectedTemplates = document.querySelectorAll('.template-checkbox:checked');
            
            let allContent = '';
            let cardCount = 0;
            
            if (copyCurrent) {
                // å¤åˆ¶å½“å‰å†…å®¹
                const currentContent = getCurrentCardContent();
                if (currentContent.trim()) {
                    allContent += currentContent;
                    cardCount++;
                }
            }
            
            if (copyAllTemplates || selectedTemplates.length > 0) {
                // å¤åˆ¶æ¨¡æ¿å†…å®¹
                const templatesToCopy = copyAllTemplates ? 
                    ['knowledge', 'review', 'social', 'marketing', 'video', 'live', 'recruit'] :
                    Array.from(selectedTemplates).map(cb => cb.value);
                
                templatesToCopy.forEach((templateId, index) => {
                    const templateContent = getCardContent(templateId);
                    if (templateContent.trim()) {
                        if (allContent) {
                            allContent += '\n\n' + '='.repeat(30) + '\n\n';
                        }
                        allContent += templateContent;
                        cardCount++;
                    }
                });
            }
            
            if (allContent.trim() === '') {
                alert('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹ï¼');
                return;
            }
            
            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            navigator.clipboard.writeText(allContent).then(() => {
                showNotification(`å·²å¤åˆ¶ ${cardCount} ä¸ªçŸ¥è¯†å¡ç‰‡ï¼`);
                closeCopyDialog();
            }).catch(err => {
                // é™çº§æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = allContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification(`å·²å¤åˆ¶ ${cardCount} ä¸ªçŸ¥è¯†å¡ç‰‡ï¼`);
                closeCopyDialog();
            });
        }
        
        function getCurrentCardContent() {
            const title = document.getElementById('previewTitle').getAttribute('data-title') || '';
            const content = document.getElementById('markdownOutput').value || '';
            const footer = document.getElementById('previewFooter').getAttribute('data-tags') || '';
            
            let result = '';
            if (title.trim()) {
                result += title + '\n\n';
            }
            if (content.trim()) {
                result += content + '\n\n';
            }
            if (footer.trim()) {
                result += footer;
            }
            
            return result.trim();
        }
        
        function getCardContent(templateId) {
            const templates = {
                knowledge: {
                    title: 'ğŸŒŸ å°çº¢ä¹¦å¡ç‰‡',
                    content: 'ğŸŒŸ ä»Šæ—¥åˆ†äº«\n\nåœ¨è¿™ä¸ªå¿«èŠ‚å¥çš„æ—¶ä»£ï¼Œå­¦ä¼šæ…¢ä¸‹æ¥ä¹Ÿæ˜¯ä¸€ç§æ™ºæ…§ã€‚\n\nç”Ÿæ´»ä¸æ˜¯ä¸€åœºèµ›è·‘ï¼Œè€Œæ˜¯ä¸€æ®µæ—…ç¨‹ã€‚äº«å—è¿‡ç¨‹ï¼Œçæƒœå½“ä¸‹ï¼Œæ‰èƒ½æ”¶è·çœŸæ­£çš„å¿«ä¹ã€‚',
                    footer: '#ç”Ÿæ´»æ„Ÿæ‚Ÿ #ä»Šæ—¥åˆ†äº« #å°çº¢ä¹¦å¡ç‰‡'
                },
                review: {
                    title: 'â­ äº”æ˜Ÿå¥½è¯„',
                    content: 'â­â­â­â­â­ éå¸¸æ»¡æ„ï¼\n\näº§å“è´¨é‡è¶…å‡ºé¢„æœŸï¼ŒåŒ…è£…ç²¾ç¾ï¼Œç‰©æµé€Ÿåº¦å¿«ã€‚å®¢æœæ€åº¦ä¹Ÿå¾ˆå¥½ï¼Œæœ‰é—®å¿…ç­”ã€‚\n\nå·²ç»æ¨èç»™æœ‹å‹äº†ï¼Œä¸‹æ¬¡è¿˜ä¼šå›è´­ï¼',
                    footer: '#äº”æ˜Ÿå¥½è¯„ #è´­ç‰©åˆ†äº« #æ¨èå¥½ç‰©'
                },
                social: {
                    title: 'ğŸŒˆ æœ‹å‹åœˆæ–‡æ¡ˆ',
                    content: 'ğŸŒˆ ç”Ÿæ´»è®°å½•\n\nä»Šå¤©çš„é˜³å…‰åˆšåˆšå¥½ï¼Œå¾®é£ä¸ç‡¥ï¼Œå¿ƒæƒ…ä¹Ÿæ ¼å¤–ç¾ä¸½ã€‚\n\næœ‰æ—¶å€™ï¼Œå¹¸ç¦å°±æ˜¯è¿™ä¹ˆç®€å•ï¼šä¸€æ¯å’–å•¡ï¼Œä¸€æœ¬ä¹¦ï¼Œä¸€ä¸ªå®‰é™çš„åˆåã€‚',
                    footer: '#æœ‹å‹åœˆæ–‡æ¡ˆ #ç”Ÿæ´»è®°å½• #ä»Šæ—¥å¿ƒæƒ…'
                },
                marketing: {
                    title: 'ğŸ¯ è¥é”€æ´»åŠ¨ç­–åˆ’',
                    content: 'ğŸ¯ åŒåä¸€æ´»åŠ¨ç­–åˆ’æ–¹æ¡ˆ\n\nä¸»é¢˜ï¼šç‹‚æ¬¢è´­ç‰©èŠ‚ï¼Œå…¨åœº5æŠ˜èµ·\næ—¶é—´ï¼š11æœˆ1æ—¥-11æœˆ11æ—¥\näº®ç‚¹ï¼šæ»¡å‡ä¼˜æƒ ã€é™æ—¶ç§’æ€ã€æŠ½å¥–æ´»åŠ¨\nç›®æ ‡ï¼šé”€å”®é¢æå‡200%ï¼Œæ–°å®¢å¢é•¿50%',
                    footer: '#è¥é”€ç­–åˆ’ #æ´»åŠ¨ç­–åˆ’ #è¥é”€æ–¹æ¡ˆ'
                },
                video: {
                    title: 'ğŸ¬ çŸ­è§†é¢‘è„šæœ¬',
                    content: 'ğŸ¬ çŸ­è§†é¢‘è„šæœ¬ï¼š30ç§’å­¦ä¼šç†è´¢\n\nã€å¼€åœº5ç§’ã€‘\n"è¿˜åœ¨ä¸ºé’±ä¸å¤Ÿç”¨è€Œçƒ¦æ¼å—ï¼Ÿ"\n\nã€ä¸­é—´20ç§’ã€‘\n"ä»Šå¤©æ•™ä½ 3ä¸ªç®€å•ç†è´¢æŠ€å·§ï¼š\n1. æ¯æœˆå­˜æ”¶å…¥çš„20%\n2. å­¦ä¼šè®°è´¦ï¼Œæ§åˆ¶æ”¯å‡º\n3. æŠ•èµ„è‡ªå·±ï¼Œæå‡æŠ€èƒ½"\n\nã€ç»“å°¾5ç§’ã€‘\n"å…³æ³¨æˆ‘ï¼Œæ¯å¤©å­¦ç‚¹ç†è´¢çŸ¥è¯†ï¼"',
                    footer: '#çŸ­è§†é¢‘è„šæœ¬ #å†…å®¹åˆ›ä½œ #ç†è´¢çŸ¥è¯†'
                },
                live: {
                    title: 'ğŸ¤ ç›´æ’­è¯æœ¯æ¨¡æ¿',
                    content: 'ğŸ¤ ç›´æ’­å¼€åœºè¯æœ¯\n\n"å“ˆå–½å¤§å®¶å¥½ï¼Œæ¬¢è¿æ¥åˆ°ç›´æ’­é—´ï¼\nä»Šå¤©ç»™å¤§å®¶å¸¦æ¥è¶…å€¼å¥½ç‰©ï¼Œ\nå…ˆç‚¹ç‚¹å…³æ³¨ä¸è¿·è·¯ï¼Œ\nç­‰ä¼šå„¿æœ‰æƒŠå–œç¦åˆ©å“¦ï¼"\n\nã€äº§å“ä»‹ç»ã€‘+ã€äº’åŠ¨å¼•å¯¼ã€‘+ã€ä¿ƒå•è¯æœ¯ã€‘',
                    footer: '#ç›´æ’­è¯æœ¯ #ç›´æ’­æŠ€å·§ #é”€å”®è¯æœ¯'
                },
                recruit: {
                    title: 'ğŸ”¥ æ‹›è˜ä¿¡æ¯',
                    content: 'ğŸ”¥ æ‹›è˜ | æ–°åª’ä½“è¿è¥ä¸“å‘˜\n\nã€å²—ä½èŒè´£ã€‘\n- è´Ÿè´£å…¬å¸æ–°åª’ä½“å¹³å°è¿è¥\n- å†…å®¹ç­–åˆ’ä¸æ–‡æ¡ˆæ’°å†™\n- ç²‰ä¸äº’åŠ¨ä¸æ•°æ®åˆ†æ\n\nã€ä»»èŒè¦æ±‚ã€‘\n- æœ¬ç§‘åŠä»¥ä¸Šå­¦å†\n- æœ‰æ–°åª’ä½“è¿è¥ç»éªŒä¼˜å…ˆ\n- åˆ›æ„æ€ç»´æ´»è·ƒï¼Œæ‰§è¡ŒåŠ›å¼º',
                    footer: '#æ‹›è˜ä¿¡æ¯ #æ–°åª’ä½“è¿è¥ #èŒåœºæ‹›è˜'
                }
            };
            
            const template = templates[templateId];
            if (template) {
                return `${template.title}\n\n${template.content}\n\n${template.footer}`;
            }
            return '';
        }

        // äº‹ä»¶ç›‘å¬
        document.addEventListener('DOMContentLoaded', function() {
            // è¾“å…¥æ¡†å®æ—¶æ›´æ–° - ç§»é™¤äº†ä¸å­˜åœ¨çš„titleå’Œfooterå…ƒç´ ç›‘å¬

            // æ¨¡æ¿åˆ‡æ¢
            document.querySelectorAll('.template-item').forEach(item => {
                item.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    document.querySelectorAll('.template-item').forEach(i => i.classList.remove('active'));
                    // æ·»åŠ activeç±»åˆ°å½“å‰é¡¹
                    this.classList.add('active');
                    // åˆ‡æ¢æ¨¡æ¿
                    switchTemplate(this.dataset.template);
                });
            });



            // åˆå§‹åŒ–é¢„è§ˆ
            updatePreview();
            
            // å¥½è¯„æ–‡æ¡ˆäº‹ä»¶ç›‘å¬
            // ç›‘å¬å¥½è¯„æ–‡æ¡ˆè¡¨å•å˜åŒ–ï¼ˆå®æ—¶æ›´æ–°ï¼‰
            const petName = document.getElementById('petName');
            const serviceProject = document.getElementById('serviceProject');
            const serviceExperience = document.getElementById('serviceExperience');
            const doctorName = document.getElementById('doctorName');
            const otherInfo = document.getElementById('otherInfo');
            const wordCount = document.getElementById('wordCount');
            
            // ç§»é™¤è‡ªåŠ¨è§¦å‘çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œæ”¹ä¸ºä»…æ‰‹åŠ¨ç”Ÿæˆ
            
            // Markdownè¾“å‡ºæ¡†å®æ—¶ç¼–è¾‘ç›‘å¬
            const markdownOutput = document.getElementById('markdownOutput');
            if (markdownOutput) {
                markdownOutput.addEventListener('input', function() {
                    // è·å–å½“å‰å†…å®¹
                    const content = this.value;
                    
                    // æ›´æ–°é¢„è§ˆåŒºåŸŸçš„æ ‡é¢˜ã€å†…å®¹å’Œæ ‡ç­¾
                    const titleElement = document.getElementById('previewTitle');
                    const contentElement = document.getElementById('previewContent');
                    const footerElement = document.getElementById('previewFooter');
                    
                    // è§£æå†…å®¹ï¼Œæå–æ ‡é¢˜ã€æ­£æ–‡å’Œæ ‡ç­¾
                    const lines = content.split('\n');
                    let title = '';
                    let mainContent = '';
                    let footer = '';
                    
                    for (let line of lines) {
                        line = line.trim();
                        if (!line) continue;
                        
                        // æå–æ ‡é¢˜ï¼ˆä»¥#å¼€å¤´ï¼‰
                        if (line.startsWith('#') && !title) {
                            title = line.replace(/^#+\s*/, '');
                            continue;
                        }
                        
                        // æå–æ ‡ç­¾ï¼ˆä»¥#å¼€å¤´ä½†ä¸æ˜¯æ ‡é¢˜ï¼‰
                        if (line.includes('#') && !line.startsWith('#')) {
                            const tags = line.match(/#\w+/g);
                            if (tags) {
                                footer = line;
                                continue;
                            }
                        }
                        
                        // å…¶ä»–å†…å®¹ä½œä¸ºæ­£æ–‡
                        if (!line.startsWith('#')) {
                            mainContent += line + '\n';
                        }
                    }
                    
                    // æ›´æ–°æ ‡é¢˜
                    if (title.trim()) {
                        titleElement.innerHTML = marked.parse(title);
                        titleElement.style.display = 'block';
                        titleElement.setAttribute('data-title', title);
                    } else {
                        titleElement.style.display = 'none';
                        titleElement.setAttribute('data-title', '');
                    }
                    
                    // æ›´æ–°å†…å®¹
                    if (mainContent.trim()) {
                        contentElement.innerHTML = marked.parse(mainContent.trim());
                        contentElement.style.display = 'block';
                    } else {
                        contentElement.style.display = 'none';
                    }
                    
                    // æ›´æ–°åº•éƒ¨æ ‡ç­¾
                    if (footer.trim()) {
                        footerElement.innerHTML = marked.parse(footer);
                        footerElement.style.display = 'block';
                        footerElement.setAttribute('data-tags', footer);
                    } else {
                        footerElement.style.display = 'none';
                        footerElement.setAttribute('data-tags', '');
                    }
                });
            }
        });
    </script>
</body>
</html>