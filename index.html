<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小红书知识卡片编辑器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            display: flex;
            height: 100vh;
            width: 100%;
            margin: 0;
            background: white;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
        }

        /* 左侧边栏 */
        .sidebar {
            width: 15%;
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            border-right: 1px solid #dee2e6;
            padding: 20px;
            overflow-y: auto;
            min-width: 200px;
        }

        .sidebar h2 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 2px solid #007bff;
        }

        .template-item {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .template-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            border-color: #007bff;
        }

        .template-item.active {
            border-color: #007bff;
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
        }

        .template-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .template-desc {
            font-size: 11px;
            opacity: 0.8;
        }

        /* 中间输入区域 */
        .input-area {
            width: 42.5%;
            min-width: 400px;
            padding: 30px;
            background: #fafbfc;
            border-right: 1px solid #e1e4e8;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow-y: auto;
        }

        .input-header {
            margin-bottom: 25px;
        }

        .input-header h3 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 20px;
        }

        .input-header p {
            color: #7f8c8d;
            font-size: 14px;
        }

        .input-group {
            margin-bottom: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0; /* 防止flex项目溢出 */
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .input-group textarea {
            min-height: 120px;
            resize: vertical;
            flex: 1;
            height: 100%;
        }

        /* 右侧输出区域 */
        .output-area {
            width: 42.5%;
            background: white;
            padding: 25px;
            overflow-y: auto;
            min-width: 400px;
            max-height: 100vh;
        }

        .output-header {
            margin-bottom: 25px;
            text-align: center;
        }

        .output-header h3 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 20px;
        }

        .output-header p {
            color: #7f8c8d;
            font-size: 14px;
        }

        .card-preview {
            background: white;
            border-radius: 8px;
            padding: 20px;
            color: #333;
            min-height: 350px;
            border: 1px solid #e1e4e8;
            transition: all 0.3s ease;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 15px;
            line-height: 1.3;
        }

        .card-content {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
            white-space: pre-wrap;
        }

        .card-footer {
            border-top: 1px solid #e1e4e8;
            padding-top: 12px;
            font-size: 12px;
            color: #666;
        }

        .style-controls {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .style-controls h4 {
            margin-bottom: 12px;
            color: #495057;
            font-size: 14px;
        }



        .btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        /* 响应式设计 */
        @media (max-width: 1200px) {
            .container {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar {
                width: 100%;
                order: 2;
                min-width: auto;
            }
            
            .input-area {
                order: 1;
                height: auto;
            }
            
            .output-area {
                width: 100%;
                order: 3;
                min-width: auto;
            }
        }

        @media (max-width: 768px) {
            .container {
                margin: 0;
                box-shadow: none;
            }
            
            .sidebar,
            .input-area,
            .output-area {
                padding: 20px;
            }
            
            .sidebar {
                width: 100%;
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 左侧边栏 -->
        <div class="sidebar">
            <!-- Logo区域 -->
            <div style="text-align: center; margin-bottom: 20px; padding: 20px 15px; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <img src="logo.png" alt="小红书知识卡片编辑器" style="width: 180px; height: auto; max-height: 180px; object-fit: contain; display: block; margin-left: auto; margin-right: auto;">
            </div>
            <div class="template-item active" data-template="knowledge">
                <div class="template-title">小红书卡片</div>
                <div class="template-desc">精美知识分享卡片</div>
            </div>
            <div class="template-item" data-template="review">
                <div class="template-title">好评文案</div>
                <div class="template-desc">商品评价文案模板</div>
            </div>
            <div class="template-item" data-template="voiceover">
                <div class="template-title">口播助手</div>
                <div class="template-desc">短视频口播文案创作</div>
            </div>
            <div class="template-item" data-template="social">
                <div class="template-title">朋友圈文案</div>
                <div class="template-desc">社交媒体文案创作</div>
            </div>
            <div class="template-item" data-template="marketing">
                <div class="template-title">市场策划</div>
                <div class="template-desc">营销活动策划模板</div>
            </div>
            <div class="template-item" data-template="video">
                <div class="template-title">短视频脚本</div>
                <div class="template-desc">短视频内容脚本创作</div>
            </div>
            <div class="template-item" data-template="live">
                <div class="template-title">直播助手</div>
                <div class="template-desc">直播话术和流程模板</div>
            </div>
            <div class="template-item" data-template="recruit">
                <div class="template-title">招聘助手</div>
                <div class="template-desc">招聘文案和JD模板</div>
            </div>
        </div>

        <!-- 中间输入区域 -->
        <div class="input-area" id="knowledgeInput">
            <div class="input-header">
                <h3>✏️ 内容编辑</h3>
                <p>输入草稿文案，点击AI编辑按钮，查看markdown格式输出</p>
            </div>
            
            <div class="input-group">
                <label for="draftContent">草稿文案</label>
                <textarea id="draftContent" placeholder="在这里输入你的草稿文案...">今天天气很好，适合出去走走。生活中要学会享受当下，不要总是忙碌而忽略了身边的美好。</textarea>
            </div>
            
            <div style="margin: 20px 0;">
                <button class="btn" onclick="aiEditContent()">🤖 AI编辑</button>
                <button class="btn" onclick="clearDraft()">🗑️ 清空草稿</button>
            </div>
            
            <div class="input-group">
                <label for="markdownOutput">Markdown输出</label>
                <textarea id="markdownOutput" placeholder="AI编辑后的markdown内容将显示在这里..."></textarea>
            </div>
            
            <!-- 标题和底部信息已移除，仅保留 Markdown 内容输入 -->

            <!-- 导出按钮已移除 -->
        </div>

        <!-- 好评文案输入区域 -->
        <div class="input-area" id="reviewInput" style="display: none;">
            <div class="input-header">
                <h3>⭐ 好评文案编辑</h3>
                <p>输入商品信息和体验感受，生成专业的好评文案</p>
            </div>
            
            <div class="input-group">
                <label for="petName">🐾 宠物名字</label>
                <input type="text" id="petName" placeholder="请输入宠物的名字..." style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div class="input-group">
                <label for="serviceProject">🏥 服务项目</label>
                <select id="serviceProject" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">请选择服务项目</option>
                    <option value="vaccination">疫苗接种</option>
                    <option value="checkup">健康体检</option>
                    <option value="grooming">美容洗澡</option>
                    <option value="surgery">手术治疗</option>
                    <option value="neutering">绝育手术</option>
                    <option value="dental">口腔护理</option>
                    <option value="boarding">寄养服务</option>
                    <option value="training">训练课程</option>
                    <option value="emergency">急诊服务</option>
                    <option value="other">其他服务</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="serviceExperience">💫 服务体验</label>
                <select id="serviceExperience" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">请选择服务体验</option>
                    <option value="excellent">非常满意 ⭐⭐⭐⭐⭐</option>
                    <option value="good">满意 ⭐⭐⭐⭐</option>
                    <option value="average">一般 ⭐⭐⭐</option>
                    <option value="poor">不满意 ⭐⭐</option>
                    <option value="terrible">非常不满意 ⭐</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="satisfyingDetail">✨ 最满意的服务细节</label>
                <select id="satisfyingDetail" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">请选择最满意的服务细节</option>
                    <option value="professional">专业技术</option>
                    <option value="attitude">服务态度</option>
                    <option value="environment">环境设施</option>
                    <option value="communication">沟通交流</option>
                    <option value="price">价格性价比</option>
                    <option value="efficiency">服务效率</option>
                    <option value="aftercare">术后护理</option>
                    <option value="cleaning">清洁消毒</option>
                    <option value="patience">耐心细致</option>
                    <option value="care">贴心关怀</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="doctorName">👨‍⚕️ 医生/美容师称呼</label>
                <input type="text" id="doctorName" placeholder="请输入医生或美容师的名字或称呼..." style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div class="input-group">
                <label for="otherInfo">📝 其他信息</label>
                <textarea id="otherInfo" placeholder="分享更多细节：环境感受、服务态度、专业程度、价格性价比等..."></textarea>
            </div>
            
            <div class="input-group">
                <label for="wordCount">📊 字数要求</label>
                <select id="wordCount" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">选择字数范围</option>
                    <option value="short">简短 (50-100字)</option>
                    <option value="medium">适中 (100-200字)</option>
                    <option value="long">详细 (200-300字)</option>
                    <option value="verylong">超详细 (300字以上)</option>
                </select>
            </div>
            
            <div style="margin: 20px 0;">
                <button class="btn" onclick="generateReviewContent()">🤖 生成好评文案</button>
                <button class="btn" onclick="clearReviewForm()">🗑️ 清空内容</button>
            </div>
        </div>

        <!-- 口播助手输入区域 -->
        <div class="input-area" id="voiceoverInput" style="display: none;">
            <div class="input-header">
                <h3>🎤 口播文案编辑</h3>
                <p>在这里编辑您的口播文案</p>
            </div>
            
            <div class="input-group">
                <label for="voiceoverDraftContent">📝 草稿文案输入区</label>
                <textarea id="voiceoverDraftContent" placeholder="在这里输入您的草稿文案..." style="width: 100%; height: calc(100vh - 280px); min-height: 300px; padding: 15px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px; line-height: 1.6; resize: vertical;" oninput="renderVoiceoverPreview()"></textarea>
            </div>
            
            <!-- 简化口播助手配置 - 已移除爆款结构、面向对象、口播时长选择 -->
            
            <div style="margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn" onclick="generateVoiceoverWithAI()">🤖 AI生成口播文案</button>
                <button class="btn" onclick="clearVoiceover()">🗑️ 清空草稿箱</button>
            </div>
        </div>

        <!-- 朋友圈文案输入区域 -->
        <div class="input-area" id="socialInput" style="display: none;">
            <div class="input-header">
                <h3>🌈 朋友圈文案编辑</h3>
                <p>输入生活感悟，生成朋友圈文案</p>
            </div>
            
            <div class="input-group">
                <label for="socialMood">😊 心情状态</label>
                <select id="socialMood" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">请选择心情状态</option>
                    <option value="happy">开心快乐</option>
                    <option value="peaceful">平静淡然</option>
                    <option value="thoughtful">思考感悟</option>
                    <option value="grateful">感恩感谢</option>
                    <option value="motivated">励志向上</option>
                    <option value="nostalgic">怀旧回忆</option>
                    <option value="hopeful">期待希望</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="socialScene">🌅 生活场景</label>
                <select id="socialScene" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">请选择生活场景</option>
                    <option value="morning">清晨时光</option>
                    <option value="noon">午后闲暇</option>
                    <option value="evening">傍晚夕阳</option>
                    <option value="night">夜深人静</option>
                    <option value="work">工作学习</option>
                    <option value="rest">休息放松</option>
                    <option value="travel">旅行出游</option>
                    <option value="food">美食时光</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="socialContent">💭 内容主题</label>
                <textarea id="socialContent" placeholder="分享你的想法、感悟或者生活记录..."></textarea>
            </div>
            
            <div class="input-group">
                <label for="socialStyle">🎨 文案风格</label>
                <select id="socialStyle" style="width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px;">
                    <option value="">请选择文案风格</option>
                    <option value="warm">温暖治愈</option>
                    <option value="fresh">清新文艺</option>
                    <option value="simple">简约直白</option>
                    <option value="poetic">诗意唯美</option>
                    <option value="real">真实记录</option>
                    <option value="philosophical">哲理思考</option>
                </select>
            </div>
            
            <div style="margin: 20px 0;">
                <button class="btn" onclick="generateSocialContent()">🤖 生成朋友圈文案</button>
                <button class="btn" onclick="clearSocialForm()">🗑️ 清空内容</button>
            </div>
        </div>

        <!-- 右侧输出区域 -->
        <div class="output-area" id="knowledgeOutput">
            <div class="output-header">
                <h3>👁️ 实时预览</h3>
                <p>你的知识卡片效果预览</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="showCopyDialog()">📋 复制知识卡片</button>
            </div>
            
            <div class="card-preview" id="cardPreview">
                <div class="card-title" id="previewTitle">知识卡片标题</div>
                <div class="card-content" id="previewContent">这里是知识卡片的主要内容，你可以在这里分享你的知识、经验或者见解。内容会自动在右侧实时预览。</div>
                <div class="card-footer" id="previewFooter">#知识分享 #学习笔记</div>
            </div>
            
            <!-- 复制选择对话框 -->
            <div id="copyDialog" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 400px; width: 90%;">
                    <h3 style="margin-bottom: 20px; color: #333;">📋 复制当前知识卡片</h3>
                    <div id="cardOptions" style="margin-bottom: 20px;">
                        <!-- 当前卡片选项将在这里动态生成 -->
                    </div>
                    <div style="text-align: center;">
                        <button class="btn" onclick="copyCurrentCard()">确认复制</button>
                        <button class="btn" onclick="closeCopyDialog()" style="background: #6c757d; margin-left: 10px;">取消</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 口播助手输出区域 -->
        <div class="output-area" id="voiceoverOutput" style="display: none;">
            <div class="output-header">
                <h3>🎬 口播文案预览</h3>
                <p>您的短视频口播文案效果预览</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="toggleVoiceoverEdit()">✏️ 编辑模式</button>
                <button class="btn" onclick="copyVoiceoverContent()">📋 复制口播文案</button>
                <button class="btn" onclick="clearVoiceoverContent()">🗑️ 清空内容</button>
            </div>
            
            <!-- 编辑模式文本框 -->
            <div id="voiceoverEditArea" style="display: none; margin-bottom: 20px;">
                <textarea id="voiceoverEditContent" style="width: 100%; height: 400px; padding: 15px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px; line-height: 1.8; resize: vertical;" placeholder="在这里编辑您的口播文案..."></textarea>
                <div style="margin-top: 10px; text-align: center;">
                    <button class="btn" onclick="saveVoiceoverEdit()">💾 保存编辑</button>
                    <button class="btn" onclick="cancelVoiceoverEdit()" style="background: #6c757d; margin-left: 10px;">❌ 取消</button>
                </div>
            </div>
            
            <!-- 预览模式 -->
            <div class="card-preview" id="voiceoverPreview">
                <div class="card-content" id="voiceoverPreviewContent" style="font-size: 14px; line-height: 1.8; white-space: pre-line;">
                    请在左侧输入口播主题和素材，点击"🤖 AI生成口播文案"按钮来创建您的短视频口播文案...
                </div>
            </div>
            

        </div>

        <!-- 好评文案输出区域 -->
        <div class="output-area" id="reviewOutput" style="display: none;">
            <div class="output-header">
                <h3>⭐ 好评文案预览</h3>
                <p>您的商品评价文案效果预览</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="toggleReviewEdit()">✏️ 编辑模式</button>
                <button class="btn" onclick="copyReviewContent()">📋 复制好评文案</button>
            </div>
            
            <!-- 编辑模式文本框 -->
            <div id="reviewEditArea" style="display: none; margin-bottom: 20px;">
                <textarea id="reviewEditContent" style="width: 100%; height: 300px; padding: 15px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 14px; line-height: 1.6; resize: vertical;" placeholder="在这里编辑您的好评文案..."></textarea>
                <div style="margin-top: 10px; text-align: center;">
                    <button class="btn" onclick="saveReviewEdit()">💾 保存编辑</button>
                    <button class="btn" onclick="cancelReviewEdit()" style="background: #6c757d; margin-left: 10px;">❌ 取消</button>
                </div>
            </div>
            
            <!-- 预览模式 -->
            <div class="card-preview" id="reviewPreview">
                <div class="card-content" id="reviewPreviewContent" style="font-size: 14px; line-height: 1.6;">
                    请在左侧输入商品信息，点击生成好评文案按钮来创建您的商品评价...
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // AI编辑功能
        async function aiEditContent() {
            const draftContent = document.getElementById('draftContent').value.trim();
            const markdownOutput = document.getElementById('markdownOutput');
            
            if (!draftContent) {
                alert('请先输入草稿文案！');
                return;
            }

            // 显示加载状态
            markdownOutput.value = '正在AI编辑中，请稍候...';
            markdownOutput.disabled = true;
            
            try {
                // 构建API请求内容
                const apiContent = `你是一位小红书内容专家，你要做小红书知识卡片。请你根据下面${draftContent}里的内容提取总结，设计卡片数量(不少于3张)和每个卡片的内容。(需求)小红书卡片要简洁美观，每张卡片里内容、元素要丰富，正确使用emoji元素，凸显宠物属性。为每一张卡片生成与内容匹配的底部标签信息（3-5个）。`;
                
                // 调用API
                await callAIAPI(apiContent, markdownOutput);
                
            } catch (error) {
                console.error('API调用失败:', error);
                // 如果API调用失败，回退到模拟编辑
                const aiEditedContent = simulateAIEdit(draftContent);
                markdownOutput.value = aiEditedContent;
                markdownOutput.disabled = false;
                
                // 自动生成标题和标签
                const autoTitle = generateTitle(draftContent);
                document.getElementById('title').value = autoTitle;
                const autoTags = generateTags(draftContent);
                document.getElementById('footer').value = autoTags;
                
                updatePreview();
                showNotification('✨ AI编辑完成！（使用模拟数据）');
            }
        }
        
        async function callAIAPI(content, outputElement) {
            const apiUrl = 'https://api.siliconflow.cn/v1/chat/completions';
            const apiKey = 'sk-pyklkjtrarxygqafyidoclbberxhhqbnzmdrafwuuuiusxzd';
            
            const requestBody = {
                model: "deepseek-ai/DeepSeek-V3.1",
                messages: [
                    {
                        role: "user",
                        content: content
                    }
                ],
                stream: true,
                max_tokens: 10000,
                enable_thinking: false,
                thinking_budget: 4096,
                min_p: 0.05,
                stop: null,
                temperature: 0.7,
                top_p: 0.7,
                top_k: 50,
                frequency_penalty: 0.5,
                n: 1,
                response_format: {
                    type: "text"
                }
            };
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });
            
            if (!response.ok) {
                throw new Error(`API请求失败: ${response.status}`);
            }
            
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let accumulatedContent = '';
            
            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                
                const chunk = decoder.decode(value);
                const lines = chunk.split('\n');
                
                for (const line of lines) {
                    if (line.startsWith('data: ')) {
                        const data = line.slice(6);
                        if (data === '[DONE]') continue;
                        
                        try {
                            const parsed = JSON.parse(data);
                            const content = parsed.choices?.[0]?.delta?.content || '';
                            if (content) {
                                accumulatedContent += content;
                                outputElement.value = accumulatedContent;
                                updatePreview();
                            }
                        } catch (e) {
                            // 忽略解析错误
                        }
                    }
                }
            }
            
            outputElement.disabled = false;
            
            // 自动生成标题和标签（已移除对应的输入框，但保留生成功能用于预览）
                const autoTitle = generateTitle(accumulatedContent);
                const autoTags = generateTags(accumulatedContent);
                // 将生成的标题和标签存储在预览元素的数据属性中
                document.getElementById('previewTitle').setAttribute('data-title', autoTitle);
                document.getElementById('previewFooter').setAttribute('data-tags', autoTags);
            
            updatePreview();
            showNotification('✨ AI编辑完成！');
        }

        // 模拟AI编辑（实际项目中替换为真实AI API调用）
        function simulateAIEdit(content) {
            // 根据小红书风格优化内容
            let edited = content;
            
            // 添加emoji和格式化
            if (edited.includes('天气')) {
                edited = '🌤️ ' + edited.replace('天气很好', '**天气超级棒**');
            }
            if (edited.includes('生活')) {
                edited = edited.replace('生活中', '🌟 **生活中**');
            }
            if (edited.includes('享受当下')) {
                edited = edited.replace('享受当下', '**享受当下** ✨');
            }
            if (edited.includes('美好')) {
                edited = edited.replace('美好', '**美好** 🌈');
            }
            
            // 添加标题结构
            edited = `# 🌟 今日分享\n\n${edited}\n\n## 💭 我的感悟\n\n有时候，最简单的幸福就藏在这些平凡的日常里。\n\n## 📝 小贴士\n\n- 💡 学会放慢脚步\n- 🌸 发现身边的美好\n- ✨ 珍惜当下的每一刻`;
            
            return edited;
        }

        // 自动生成标题
        function generateTitle(content) {
            if (content.includes('天气')) return '🌤️ 天气好心情更好';
            if (content.includes('生活')) return '🌟 生活感悟分享';
            if (content.includes('享受')) return '✨ 享受当下的美好';
            return '📝 今日分享';
        }

        // 自动生成标签
        function generateTags(content) {
            const tags = ['#生活分享'];
            if (content.includes('天气')) tags.push('#天气日记');
            if (content.includes('生活')) tags.push('#生活感悟');
            if (content.includes('享受')) tags.push('#享受当下');
            tags.push('#小红书分享');
            return tags.join(' ');
        }

        // 清空草稿
        function clearDraft() {
            document.getElementById('draftContent').value = '';
            document.getElementById('markdownOutput').value = '';
            // 清空预览元素的标题和标签数据
            document.getElementById('previewTitle').setAttribute('data-title', '');
            document.getElementById('previewFooter').setAttribute('data-tags', '');
            updatePreview();
        }

        // 显示通知
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 2000);
        }

        // 添加动画样式
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        function updatePreview() {
            const content = document.getElementById('markdownOutput').value;
            
            // 获取存储在预览元素中的标题和标签
            const titleElement = document.getElementById('previewTitle');
            const footerElement = document.getElementById('previewFooter');
            const title = titleElement.getAttribute('data-title') || '';
            const footer = footerElement.getAttribute('data-tags') || '';

            // 更新标题
            if (title.trim()) {
                titleElement.innerHTML = marked.parse(title);
                titleElement.style.display = 'block';
            } else {
                titleElement.style.display = 'none';
            }

            // 更新内容
            const contentElement = document.getElementById('previewContent');
            if (content.trim()) {
                contentElement.innerHTML = marked.parse(content);
                contentElement.style.display = 'block';
            } else {
                contentElement.style.display = 'none';
            }

            // 更新底部信息
            if (footer.trim()) {
                footerElement.innerHTML = marked.parse(footer);
                footerElement.style.display = 'block';
            } else {
                footerElement.style.display = 'none';
            }
        }

        // 模板切换
        function switchTemplate(templateType) {
            // 隐藏所有输入和输出区域
            document.getElementById('knowledgeInput').style.display = 'none';
            document.getElementById('reviewInput').style.display = 'none';
            document.getElementById('voiceoverInput').style.display = 'none';
            document.getElementById('knowledgeOutput').style.display = 'none';
            document.getElementById('reviewOutput').style.display = 'none';
            document.getElementById('voiceoverOutput').style.display = 'none';
            
            // 根据模板类型显示对应的区域
            if (templateType === 'review') {
                // 显示好评文案区域
                document.getElementById('reviewInput').style.display = 'block';
                document.getElementById('reviewOutput').style.display = 'block';
            } else if (templateType === 'voiceover') {
                // 显示口播助手区域
                document.getElementById('voiceoverInput').style.display = 'block';
                document.getElementById('voiceoverOutput').style.display = 'block';
            } else {
                // 显示知识卡片区域
                document.getElementById('knowledgeInput').style.display = 'block';
                document.getElementById('knowledgeOutput').style.display = 'block';
                
                // 加载对应模板内容
                const templates = {
                    knowledge: {
                        title: '小红书卡片',
                        content: '🌟 今日分享\n\n在这个快节奏的时代，学会慢下来也是一种智慧。\n\n生活不是一场赛跑，而是一段旅程。享受过程，珍惜当下，才能收获真正的快乐。',
                        footer: '#生活感悟 #今日分享 #小红书卡片'
                    },
                    social: {
                        title: '朋友圈文案',
                        content: '🌈 生活记录\n\n今天的阳光刚刚好，微风不燥，心情也格外美丽。\n\n有时候，幸福就是这么简单：一杯咖啡，一本书，一个安静的午后。',
                        footer: '#朋友圈文案 #生活记录 #今日心情'
                    },
                    marketing: {
                        title: '营销活动策划',
                        content: '🎯 双十一活动策划方案\n\n主题：狂欢购物节，全场5折起\n时间：11月1日-11月11日\n亮点：满减优惠、限时秒杀、抽奖活动\n目标：销售额提升200%，新客增长50%',
                        footer: '#营销策划 #活动策划 #营销方案'
                    },
                    video: {
                        title: '短视频脚本',
                        content: '🎬 短视频脚本：30秒学会理财\n\n【开场5秒】\n"还在为钱不够用而烦恼吗？"\n\n【中间20秒】\n"今天教你3个简单理财技巧：\n1. 每月存收入的20%\n2. 学会记账，控制支出\n3. 投资自己，提升技能"\n\n【结尾5秒】\n"关注我，每天学点理财知识！"',
                        footer: '#短视频脚本 #内容创作 #理财知识'
                    },
                    live: {
                        title: '直播话术模板',
                        content: '🎤 直播开场话术\n\n"哈喽大家好，欢迎来到直播间！\n今天给大家带来超值好物，\n先点点关注不迷路，\n等会儿有惊喜福利哦！"\n\n【产品介绍】+【互动引导】+【促单话术】',
                        footer: '#直播话术 #直播技巧 #销售话术'
                    },
                    recruit: {
                        title: '招聘信息',
                        content: '🔥 招聘 | 新媒体运营专员\n\n【岗位职责】\n- 负责公司新媒体平台运营\n- 内容策划与文案撰写\n- 粉丝互动与数据分析\n\n【任职要求】\n- 本科及以上学历\n- 有新媒体运营经验优先\n- 创意思维活跃，执行力强',
                        footer: '#招聘信息 #新媒体运营 #职场招聘'
                    },
                    voiceover: {
                        title: '口播助手',
                        content: '🎤 口播文案示例\n\n【开场】\n"姐妹们👭，今天想跟大家聊聊护肤这个话题。"\n\n【停顿2秒】\n\n【正文】\n"最近我发现了一个特别棒的护肤方法，真的让我受益匪浅。护肤对于我们每个人来说都非常重要，特别是年轻女性群体。"\n\n【结尾】\n"所以啊，如果你也在为护肤而烦恼，不妨试试看。相信我，你不会失望的！记得点赞关注，我们下期再见！👋"',
                        footer: '#口播助手 #短视频文案 #内容创作'
                    }
                };
                
                const template = templates[templateType];
                if (template) {
                    // 设置markdown内容和预览数据
                    document.getElementById('markdownOutput').value = template.content;
                    document.getElementById('previewTitle').setAttribute('data-title', template.title);
                    document.getElementById('previewFooter').setAttribute('data-tags', template.footer);
                    updatePreview();
                }
            }
        }



        // 重置内容
        function resetContent() {
            document.getElementById('title').value = '';
            document.getElementById('content').value = '';
            document.getElementById('footer').value = '';
            updatePreview();
        }

        // 生成好评文案
        async function generateReviewContent() {
            const petName = document.getElementById('petName').value.trim();
            const serviceProject = document.getElementById('serviceProject').value;
            const serviceExperience = document.getElementById('serviceExperience').value;
            const satisfyingDetail = document.getElementById('satisfyingDetail').value;
            const doctorName = document.getElementById('doctorName').value.trim();
            const otherInfo = document.getElementById('otherInfo').value.trim();
            const wordCount = document.getElementById('wordCount').value;
            
            if (!petName || !serviceProject || !serviceExperience) {
                alert('请填写完整的宠物信息和服务体验！');
                return;
            }
            
            // 获取服务项目的显示名称
            const serviceProjectNames = {
                vaccination: '疫苗接种',
                checkup: '健康体检',
                grooming: '美容洗澡',
                surgery: '手术治疗',
                dental: '口腔护理',
                boarding: '寄养服务',
                training: '训练课程',
                emergency: '急诊服务',
                neutering: '绝育手术',
                other: '其他宠物服务'
            };
            
            // 获取服务体验的显示名称
            const serviceExperienceNames = {
                excellent: '超级满意',
                good: '整体满意',
                average: '一般般',
                poor: '不太满意',
                terrible: '非常不满意'
            };
            
            // 获取最满意服务细节的显示名称
            const satisfyingDetailNames = {
                professional: '专业技术',
                attitude: '服务态度',
                environment: '环境设施',
                communication: '沟通交流',
                price: '价格合理',
                efficiency: '服务效率',
                aftercare: '术后护理',
                cleaning: '清洁消毒',
                patience: '耐心细致',
                care: '贴心关怀'
            };
            
            // 获取字数要求的显示名称
            const wordCountNames = {
                short: '50-100字',
                medium: '100-200字',
                long: '200-300字',
                verylong: '300-500字'
            };
            
            // 构建API请求内容
            const apiContent = `角色 你是一位专业且经验丰富的宠物服务好评生成大师，对宠物服务行业有着深入透彻的了解，擅长依据各类宠物服务相关信息，生成极具真实感、完美契合美团和大众点评主流风格的高质量好评。 技能 技能 1: 生成好评 当接收到输入的变量${petName}、${serviceProjectNames[serviceProject] || '宠物服务'}、${serviceExperienceNames[serviceExperience] || '服务体验'}、${satisfyingDetailNames[satisfyingDetail] || '无'}、${doctorName || '无'}、${wordCountNames[wordCount] || '100-200字'}以及${otherInfo || '无'}时，充分发挥你深厚的语言功底和对宠物服务行业的敏锐洞察，运用丰富多样的语言技巧，生成好评内容。 好评内容要紧密围绕给定信息全方位展开，深度挖掘并突出服务的独特亮点和令人满意之处，从服务态度、专业水平、环境设施等多个维度展现服务的高品质。 生成的好评语言风格要自然流畅、生动活泼且富有感染力，大量运用自然的口语化表达、网络热词、地方方言等，彻底消除AI生成痕迹，与大众点评和美团好评的常见表述高度一致。 技能 2: 规避AI痕迹 植入非标准细节：在好评中巧妙加入宠物昵称、医生姓氏、设备名称等非通用信息，让好评更具个性。 创造情感波动曲线：构建"犹豫 - 决策 - 庆幸"的心理路径，符合真实的消费决策逻辑，使好评更显真实。 绑定具体时空锚点：融入天气、交通状况、节日氛围等不可预测因素，增添好评的真实场景感。 制造合理缺陷：适当提及一些不影响整体好评的小问题，如等待时间稍长等，通过合理负面细节增强好评可信度。 设备操作可视化：将专业的医疗设备以通俗易懂的画面呈现，让消费者更容易理解服务过程。 设计对话体彩蛋：添加医护人员与宠物之间的趣味互动细节，使好评更加生动有趣。 匹配消费水平：明确消费者身份（如上班族、学生等），避免模糊表述。 跨平台内容关联：关联宠物医院自有媒体内容（如公众号文章、抖音视频等），形成证据链闭环，增强好评的说服力。 适当出错：在文案中巧妙出现1个错别字和2个口语化的表述错误，模拟真实用户评价。 限制: 只专注于生成与宠物相关服务好评相关的内容，坚决拒绝回答无关话题。 所输出的好评内容必须严格符合美团、大众点评的常见风格，做到语言通顺、表意清晰、逻辑连贯。 生成的好评内容要精准控制在${wordCountNames[wordCount] || '100-200字'}字数要求内，不超字也不缺字。`;
            
            // 显示加载状态
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            if (reviewPreviewContent) {
                reviewPreviewContent.innerHTML = '🤖 正在生成好评文案，请稍候...';
            }
            
            try {
                // 调用API
                const response = await fetch('https://api.siliconflow.cn/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer sk-khczjbhzxxujbizmolqceicevnyckmddrhtgbhiyhfkzaujs',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-ai/DeepSeek-R1',
                        messages: [
                            {
                                role: 'user',
                                content: apiContent
                            }
                        ],
                        stream: true,
                        max_tokens: 10000,
                        enable_thinking: false,
                        thinking_budget: 4096,
                        min_p: 0.05,
                        temperature: 0.7,
                        top_p: 0.7,
                        top_k: 50,
                        frequency_penalty: 0.5,
                        n: 1,
                        response_format: {
                            type: 'text'
                        }
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API请求失败: ${response.status}`);
                }
                
                // 处理流式响应
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let accumulatedContent = '';
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = line.slice(6);
                            if (data === '[DONE]') continue;
                            
                            try {
                                const parsed = JSON.parse(data);
                                const content = parsed.choices?.[0]?.delta?.content || '';
                                if (content) {
                                    accumulatedContent += content;
                                    // 实时更新预览区域
                                    if (reviewPreviewContent) {
                                        reviewPreviewContent.innerHTML = accumulatedContent.replace(/\n/g, '<br>');
                                    }
                                }
                            } catch (e) {
                                // 忽略解析错误的行
                                continue;
                            }
                        }
                    }
                }
                
                showNotification('✨ AI好评文案生成完成！');
                
            } catch (error) {
                console.error('API调用失败:', error);
                // 如果API调用失败，回退到本地生成
                const fallbackContent = `🐾 ${petName}的${serviceProjectNames[serviceProject] || '宠物服务'}体验\n\n`;
                if (reviewPreviewContent) {
                    reviewPreviewContent.innerHTML = fallbackContent.replace(/\n/g, '<br>');
                }
                showNotification('⚠️ AI生成失败，已使用本地模板');
            }
        }
        
        // 更新好评文案预览
        function updateReviewPreview() {
            const reviewContent = document.getElementById('reviewOutput').value;
            const previewElement = document.getElementById('reviewPreviewContent');
            
            if (reviewContent.trim()) {
                previewElement.innerHTML = marked.parse(reviewContent);
            } else {
                previewElement.innerHTML = '请在左侧输入商品信息，点击生成好评文案按钮来创建您的商品评价...';
            }
        }
        
        // 清空好评文案表单
        function clearReviewForm() {
            document.getElementById('petName').value = '';
            document.getElementById('serviceProject').value = 'vaccination';
            document.getElementById('serviceExperience').value = 'good';
            document.getElementById('satisfyingDetail').value = '';
            document.getElementById('doctorName').value = '';
            document.getElementById('otherInfo').value = '';
            document.getElementById('wordCount').value = 'medium';
            // 清空好评文案预览区域
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            if (reviewPreviewContent) {
                reviewPreviewContent.innerHTML = '请在左侧输入商品信息，点击生成好评文案按钮来创建您的商品评价...';
            }
        }
        
        // 复制好评文案
        function copyReviewContent() {
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            let reviewContent = '';
            
            if (reviewPreviewContent) {
                reviewContent = reviewPreviewContent.innerText || reviewPreviewContent.textContent;
            }
            
            if (!reviewContent.trim() || reviewContent.trim() === '请在左侧输入商品信息，点击生成好评文案按钮来创建您的商品评价...') {
                alert('没有可复制的好评文案！');
                return;
            }
            
            navigator.clipboard.writeText(reviewContent).then(() => {
                showNotification('✅ 好评文案已复制到剪贴板！');
            }).catch(err => {
                // 降级方案
                const textArea = document.createElement('textarea');
                textArea.value = reviewContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('✅ 好评文案已复制到剪贴板！');
            });
        }
        
        // 好评文案编辑功能
        let isReviewEditMode = false;
        let originalReviewContent = '';
        
        function toggleReviewEdit() {
            const reviewEditArea = document.getElementById('reviewEditArea');
            const reviewPreview = document.getElementById('reviewPreview');
            const reviewEditContent = document.getElementById('reviewEditContent');
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            const editBtn = event.target;
            
            if (!isReviewEditMode) {
                // 进入编辑模式
                originalReviewContent = reviewPreviewContent.innerText || reviewPreviewContent.textContent;
                
                if (originalReviewContent.trim() === '请在左侧输入商品信息，点击生成好评文案按钮来创建您的商品评价...') {
                    originalReviewContent = '';
                }
                
                reviewEditContent.value = originalReviewContent;
                reviewEditArea.style.display = 'block';
                reviewPreview.style.display = 'none';
                editBtn.textContent = '👁️ 预览模式';
                editBtn.style.background = '#28a745';
                isReviewEditMode = true;
            } else {
                // 退出编辑模式
                reviewEditArea.style.display = 'none';
                reviewPreview.style.display = 'block';
                editBtn.textContent = '✏️ 编辑模式';
                editBtn.style.background = '#007bff';
                isReviewEditMode = false;
                
                // 更新预览内容
                const editedContent = reviewEditContent.value.trim();
                if (editedContent) {
                    reviewPreviewContent.innerHTML = editedContent.replace(/\n/g, '<br>');
                } else {
                    reviewPreviewContent.innerHTML = '请在左侧输入商品信息，点击生成好评文案按钮来创建您的商品评价...';
                }
            }
        }
        
        function saveReviewEdit() {
            const reviewEditContent = document.getElementById('reviewEditContent');
            const reviewPreviewContent = document.getElementById('reviewPreviewContent');
            const editedContent = reviewEditContent.value.trim();
            
            if (editedContent) {
                reviewPreviewContent.innerHTML = editedContent.replace(/\n/g, '<br>');
                showNotification('✅ 编辑内容已保存！');
            } else {
                reviewPreviewContent.innerHTML = '请在左侧输入商品信息，点击生成好评文案按钮来创建您的商品评价...';
                showNotification('⚠️ 编辑内容为空，已重置为默认提示');
            }
            
            toggleReviewEdit();
        }
        
        function cancelReviewEdit() {
            const reviewEditContent = document.getElementById('reviewEditContent');
            reviewEditContent.value = originalReviewContent;
            toggleReviewEdit();
            showNotification('❌ 已取消编辑');
        }

        // 网络连接测试功能
        async function testNetworkConnection() {
            console.log('🌐 开始网络连接测试...');
            showNotification('🌐 正在测试网络连接...');
            
            const testResults = [];
            
            // 测试1: 基础网络连接
            try {
                const response = await fetch('https://httpbin.org/get', {
                    method: 'GET',
                    signal: AbortSignal.timeout(5000)
                });
                if (response.ok) {
                    testResults.push('✅ 基础网络连接正常');
                } else {
                    testResults.push('❌ 基础网络连接失败');
                }
            } catch (error) {
                testResults.push(`❌ 基础网络连接异常: ${error.message}`);
            }
            
            // 测试2: API端点连接
            const endpoints = [
                'https://open-api.biji.com/getnote/openapi',
                'https://proxy.cors.sh/https://open-api.biji.com/getnote/openapi',
                'https://corsproxy.io/?https://open-api.biji.com/getnote/openapi'
            ];
            
            for (let i = 0; i < endpoints.length; i++) {
                try {
                    const response = await fetch(endpoints[i], {
                        method: 'OPTIONS', // 使用OPTIONS测试CORS
                        signal: AbortSignal.timeout(8000)
                    });
                    testResults.push(`✅ 端点${i + 1}可访问: ${endpoints[i]}`);
                    break; // 找到一个可用的就停止
                } catch (error) {
                    testResults.push(`❌ 端点${i + 1}失败: ${error.message}`);
                }
            }
            
            // 测试3: CORS代理服务
            try {
                const response = await fetch('https://proxy.cors.sh/https://httpbin.org/get', {
                    method: 'GET',
                    signal: AbortSignal.timeout(5000)
                });
                if (response.ok) {
                    testResults.push('✅ CORS代理服务可用');
                } else {
                    testResults.push('❌ CORS代理服务不可用');
                }
            } catch (error) {
                testResults.push(`❌ CORS代理测试失败: ${error.message}`);
            }
            
            console.log('网络测试结果:', testResults);
            
            // 显示测试结果
            const resultMessage = testResults.join('\n');
            alert(`🌐 网络连接测试结果：\n\n${resultMessage}\n\n建议:\n1. 如果基础网络失败，请检查网络设置\n2. 如果API端点都失败，API服务可能暂时不可用\n3. 如果CORS代理失败，系统会自动尝试其他方案`);
            
            showNotification('🌐 网络测试完成，请查看结果');
        }
        
        // 测试get笔记API连接
        async function testGetNoteAPI() {
            console.log('🧪 开始测试get笔记API连接...');
            
            const apiKey = 'sk-khczjbhzxxujbizmolqceicevnyckmddrhtgbhiyhfkzaujs';
            const knowledgeBaseId = 'yYv22aLY';
            
            // 测试不同的API端点
            const testEndpoints = [
                `https://api.getbiji.com/openapi/knowledge/${knowledgeBaseId}`, // 获取知识库信息
                `https://api.getbiji.com/openapi/knowledge/${knowledgeBaseId}/search?q=test&limit=1`, // 简单搜索
                'https://api.getbiji.com/openapi/user/profile', // 用户信息
                'https://api.getbiji.com/openapi/auth/test' // 认证测试
            ];
            
            for (let i = 0; i < testEndpoints.length; i++) {
                const endpoint = testEndpoints[i];
                console.log(`\n🔄 测试端点 ${i + 1}: ${endpoint}`);
                
                try {
                    const response = await fetch(endpoint, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        signal: AbortSignal.timeout(10000)
                    });
                    
                    console.log(`📊 响应状态: ${response.status} ${response.statusText}`);
                    
                    const responseText = await response.text();
                    console.log(`📄 响应内容: ${responseText.substring(0, 200)}${responseText.length > 200 ? '...' : ''}`);
                    
                    if (response.ok) {
                        console.log('✅ 此端点连接成功！');
                        return { success: true, endpoint: endpoint, data: responseText };
                    } else {
                        console.log(`❌ 此端点失败: ${response.status}`);
                    }
                    
                } catch (error) {
                    console.error(`❌ 端点测试失败: ${error.message}`);
                }
            }
            
            return { success: false, message: '所有端点测试失败' };
        }

        // 口播助手功能 - AI搜索按钮
        async function generateVoiceover() {
            const topic = document.getElementById('voiceoverTopic').value.trim();
            const voiceoverMaterial = document.getElementById('voiceoverMaterial');
            
            if (!topic) {
                alert('请输入视频主题！');
                return;
            }
            
            // 显示加载状态
            if (voiceoverMaterial) {
                voiceoverMaterial.value = '🤖 正在搜索相关笔记素材，请稍候...';
            }
            
            try {
                // 首先测试网络连接
                console.log('🔍 开始测试网络连接...');
                try {
                    const testResponse = await fetch('https://httpbin.org/get', {
                        method: 'GET',
                        signal: AbortSignal.timeout(5000)
                    });
                    console.log('✅ 网络连接正常，可以访问外部API');
                } catch (networkTestError) {
                    console.error('❌ 网络连接测试失败:', networkTestError.message);
                    throw new Error(`网络连接异常：${networkTestError.message}。请检查网络设置或防火墙配置。`);
                }
                
                // 测试get笔记API
                console.log('🔑 测试get笔记API连接...');
                const apiTestResult = await testGetNoteAPI();
                if (apiTestResult.success) {
                    console.log('✅ get笔记API连接成功！');
                } else {
                    console.warn('⚠️ get笔记API连接失败，将使用本地模拟搜索');
                }
                
                // 调用笔记知识库API获取相关素材
                const apiKey = 'sk-khczjbhzxxujbizmolqceicevnyckmddrhtgbhiyhfkzaujs';
                const knowledgeBaseId = 'yYv22aLY';
                
                // 构建搜索请求
                const searchContent = `搜索与"${topic}"相关的笔记内容，包括实用技巧、案例分析和核心要点`;
                
                // 定义多个备用端点（处理CORS问题）
                const endpoints = [
                    // 尝试使用硅基流动的API作为替代方案
                    'https://api.siliconflow.cn/v1/chat/completions',
                    // 原始get笔记API
                    'https://api.getbiji.com/openapi/knowledge/search',
                    'https://proxy.cors.sh/https://api.getbiji.com/openapi/knowledge/search', // CORS代理 (推荐)
                    'https://corsproxy.io/?' + encodeURIComponent('https://api.getbiji.com/openapi/knowledge/search') // 备用代理
                ];
                
                let response = null;
                let lastError = null;
                
                // 尝试多个端点
                for (let i = 0; i < endpoints.length; i++) {
                    const endpoint = endpoints[i];
                    console.log(`尝试端点 ${i + 1}/${endpoints.length}:`, endpoint);
                    
                    try {
                        let fetchOptions;
                        
                        if (i === 0) {
                            // 硅基流动API配置 - 模拟get笔记知识库内容
                            fetchOptions = {
                                method: 'POST',
                                headers: {
                                    'Authorization': `Bearer sk-pyklkjtrarxygqafyidoclbberxhhqbnzmdrafwuuuiusxzd`,
                                    'Content-Type': 'application/json',
                                    'Accept': 'application/json, text/plain, */*',
                                    'Cache-Control': 'no-cache',
                                    'Pragma': 'no-cache'
                                },
                                body: JSON.stringify({
                                    model: "deepseek-ai/DeepSeek-V3.1",
                                    messages: [
                                        {
                                            role: "system",
                                            content: "你是一个知识库助手。请模拟一个包含丰富笔记内容的知识库，根据用户提供的主题，生成相关的知识内容。内容要实用、具体，适合小红书创作。请按照以下格式回复："
                                        },
                                        {
                                            role: "user",
                                            content: `主题："${topic}"

请提供3-5个相关的知识点，每个知识点包含：
1. 简洁的标题
2. 具体的实用内容
3. 相关的小贴士

格式示例：
📚 知识点1：[标题]
内容：[具体的实用内容]
💡 小贴士：[相关建议]

请确保内容真实有用，适合小红书内容创作。`
                                        }
                                    ],
                                    stream: false,
                                    max_tokens: 2000,
                                    temperature: 0.7
                                }),
                                signal: AbortSignal.timeout(30000),
                                mode: 'cors',
                                credentials: 'omit'
                            };
                        } else {
                            // get笔记API配置
                            fetchOptions = {
                                method: 'POST',
                                headers: {
                                    'Authorization': `Bearer ${apiKey}`,
                                    'Content-Type': 'application/json',
                                    'Accept': 'application/json',
                                    'Cache-Control': 'no-cache',
                                    'Pragma': 'no-cache'
                                },
                                body: JSON.stringify({
                                    knowledgeBaseId: knowledgeBaseId,
                                    query: searchContent,
                                    maxResults: 10,
                                    searchType: 'semantic' // 语义搜索
                                }),
                                signal: AbortSignal.timeout(30000),
                                mode: 'cors',
                                credentials: 'omit'
                            };
                        }
                        
                        response = await fetch(endpoint, fetchOptions);
                        
                        console.log(`端点 ${i + 1} 响应成功:`, response.status);
                        break; // 成功则跳出循环
                        
                    } catch (endpointError) {
                        console.error(`端点 ${i + 1} 失败:`, endpointError.message);
                        lastError = endpointError;
                        
                        // 如果是最后一个端点，抛出错误
                        if (i === endpoints.length - 1) {
                            throw lastError;
                        }
                        
                        // 继续尝试下一个端点
                        continue;
                    }
                }
                
                console.log('API调用信息:', {
                    apiKey: apiKey.substring(0, 10) + '...',
                    knowledgeBaseId: knowledgeBaseId,
                    searchContent: searchContent,
                    endpoint: response?.url || 'unknown',
                    headers: {
                        'Authorization': 'Bearer ' + apiKey.substring(0, 10) + '...',
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });
                
                console.log('API响应状态:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API错误详情:', errorText);
                    
                    // 根据官方文档的错误码处理
                    if (response.status === 401) {
                        throw new Error(`API请求失败: 401 - 未授权。API密钥无效或已过期，请检查Bearer Token配置。`);
                    } else if (response.status === 403) {
                        throw new Error(`API请求失败: 403 - 权限被拒绝。请检查：\n1. API密钥是否正确且有效\n2. 知识库ID "${knowledgeBaseId}" 是否存在且可访问\n3. 账户是否开通了知识库搜索权限`);
                    } else if (response.status === 404) {
                        throw new Error(`API请求失败: 404 - 接口不存在。请确认使用的API端点是否正确。\n错误详情: ${errorText}`);
                    } else if (response.status === 429) {
                        throw new Error(`API请求失败: 429 - 请求过于频繁。请稍后再试。`);
                    } else if (response.status >= 500) {
                        throw new Error(`API请求失败: ${response.status} - 服务器错误。get笔记服务可能暂时不可用，请稍后再试。\n错误详情: ${errorText}`);
                    }
                    
                    throw new Error(`API请求失败: ${response.status} - ${response.statusText}\n错误详情: ${errorText}`);
                }
                
                // 获取响应数据
                const responseData = await response.json();
                console.log('API响应数据:', responseData);
                
                // 处理响应数据
                let accumulatedContent = '';
                
                if (responseData.choices && responseData.choices.length > 0) {
                    // OpenAI兼容格式（硅基流动API）- 模拟知识库内容
                    const aiResponse = responseData.choices[0].message.content;
                    
                    // 格式化AI响应为知识库风格
                    accumulatedContent = `📚 来自知识库的内容\n\n${aiResponse}`;
                    
                    // 如果内容较长，添加索引
                    if (aiResponse.length > 500) {
                        const sections = aiResponse.split(/📚|💡/);
                        if (sections.length > 1) {
                            accumulatedContent = `📚 知识库搜索结果 (找到 ${sections.length - 1} 个相关内容)\n\n${aiResponse}`;
                        }
                    }
                    
                } else if (responseData.data && responseData.data.results) {
                    // 标准知识库搜索结果格式（get笔记API）
                    const results = responseData.data.results;
                    accumulatedContent = results.map((result, index) => {
                        return `${index + 1}. ${result.title || result.content || result.text || '无标题'}\n${result.content || result.text || ''}`;
                    }).join('\n\n');
                } else if (responseData.results && Array.isArray(responseData.results)) {
                    // 另一种知识库格式
                    accumulatedContent = responseData.results.map((result, index) => {
                        return `${index + 1}. ${result.title || '相关知识'}\n${result.content || result.text || result.snippet || ''}`;
                    }).join('\n\n');
                } else if (responseData.content) {
                    // 简单内容格式
                    accumulatedContent = responseData.content;
                } else {
                    // 未知格式，显示原始数据
                    accumulatedContent = JSON.stringify(responseData, null, 2);
                }
                
                if (voiceoverMaterial) {
                    voiceoverMaterial.value = `📚 搜索到的相关笔记素材：\n\n${accumulatedContent}`;
                }
                
                showNotification('✅ 笔记素材搜索完成！');
                
            } catch (error) {
                console.error('笔记知识库API调用失败:', error);
                console.error('错误详情:', {
                    message: error.message,
                    name: error.name,
                    stack: error.stack,
                    // 检查是否是网络相关错误
                    isNetworkError: error.message.includes('Failed to fetch') || error.message.includes('network'),
                    isTimeoutError: error.message.includes('timeout') || error.message.includes('超时'),
                    isCORSError: error.message.includes('CORS') || error.message.includes('跨域')
                });
                
                // 提供本地模拟搜索作为最后手段
                console.log('🔄 尝试本地模拟搜索功能...');
                simulateLocalSearch(topic);
                
                // 显示错误通知
                showNotification('⚠️ 笔记素材搜索失败，已提供本地知识库内容');
            }
        }
        
        // 本地模拟搜索功能（当API不可用时）
        function simulateLocalSearch(topic) {
            console.log('📚 使用本地模拟搜索，主题:', topic);
            
            // 扩展的模拟知识库内容
            const mockKnowledgeBase = {
                '学习方法': [
                    '费曼学习法：通过教授他人来检验自己的理解程度',
                    '间隔重复：利用艾宾浩斯遗忘曲线安排复习时间',
                    '主动回忆：学习后合上书测试自己能记住多少内容',
                    '多感官学习：结合视觉、听觉、动手实践来提高学习效果'
                ],
                '时间管理': [
                    '番茄工作法：25分钟专注工作，5分钟休息',
                    '四象限法则：按重要紧急程度分类处理任务',
                    '时间块规划：为不同类型任务分配专门的时间段',
                    'GTD方法：收集、整理、组织、回顾、执行五个步骤'
                ],
                '写作技巧': [
                    '金字塔原理：先结论后论据，逻辑清晰的表达结构',
                    'SCQA模型：情境-冲突-问题-答案的故事化写作框架',
                    '金句提炼：将复杂概念总结为易记的短句',
                    '用户思维：站在读者角度思考他们真正关心的问题'
                ],
                '职场发展': [
                    '个人品牌：在专业领域建立可识别的独特价值',
                    '向上管理：主动沟通、及时反馈、超预期完成工作',
                    '跨部门协作：理解不同部门KPI，找到共同利益点',
                    '持续学习：保持对新知识、新技能的敏感度和学习热情'
                ],
                '宠物': [
                    '宠物医院选择：看资质、设备、医生经验三大要素',
                    '宠物健康监测：日常观察食欲、精神状态、排泄情况',
                    '宠物疫苗接种：按时接种核心疫苗，建立免疫屏障',
                    '宠物急救知识：掌握基本急救技能，关键时刻救命'
                ],
                '医院': [
                    '医院等级划分：三甲医院综合实力最强，专科特色明显',
                    '就医流程优化：提前预约、准备病历、明确主诉症状',
                    '医患沟通技巧：清晰表达症状、认真听取医嘱、及时反馈',
                    '医疗费用控制：了解医保政策、合理选择检查项目'
                ],
                '目标': [
                    'SMART目标法则：具体、可衡量、可达成、相关性、时限性',
                    '目标分解技巧：大目标拆分为小目标，逐步达成',
                    '目标追踪方法：定期检查进度，及时调整策略',
                    '目标激励机制：设定奖励机制，保持执行动力'
                ],
                '护肤': [
                    '护肤基础步骤：清洁、爽肤、精华、乳液、防晒五步法',
                    '肤质判断方法：洗脸后不涂护肤品，观察紧绷感和出油情况',
                    '成分搭配原则：维C配维E增强抗氧化，酸类成分避免混用',
                    '护肤品选择：看成分表、品牌信誉、个人肤质适配度'
                ],
                '美食': [
                    '食材新鲜判断：看颜色、闻气味、摸质地综合判断',
                    '烹饪技巧掌握：火候控制、调味平衡、时间把握是关键',
                    '营养搭配原则：蛋白质、维生素、碳水化合物均衡摄入',
                    '食品安全注意：生熟分开、充分加热、妥善保存'
                ],
                '旅行': [
                    '旅行攻略制定：确定目的地、规划路线、预订住宿交通',
                    '行李打包技巧：根据天气、活动类型、旅行天数合理配置',
                    '旅行安全注意：保管证件、了解当地风俗、购买保险',
                    '预算控制方法：提前规划、留有余地、记录开支'
                ]
            };
            
            let searchResults = [];
            let matchedKeywords = [];
            
            // 搜索匹配的主题（支持模糊匹配）
            for (const [key, content] of Object.entries(mockKnowledgeBase)) {
                if (topic.includes(key) || key.includes(topic)) {
                    searchResults = searchResults.concat(content);
                    matchedKeywords.push(key);
                }
            }
            
            // 如果没有精确匹配，尝试关键词提取匹配
            if (searchResults.length === 0) {
                // 提取主题中的关键词进行匹配
                const keywords = topic.match(/[\u4e00-\u9fa5]{2,}/g) || [];
                console.log('提取的关键词:', keywords);
                
                for (const keyword of keywords) {
                    for (const [key, content] of Object.entries(mockKnowledgeBase)) {
                        if (key.includes(keyword) || keyword.includes(key)) {
                            searchResults = searchResults.concat(content);
                            matchedKeywords.push(key);
                        }
                    }
                }
            }
            
            // 去重
            searchResults = [...new Set(searchResults)];
            
            // 如果没有找到相关内容，提供基于主题的个性化建议
            if (searchResults.length === 0) {
                console.log('未找到匹配内容，生成个性化建议');
                searchResults = generatePersonalizedAdvice(topic);
            }
            
            // 格式化搜索结果
            let formattedResults = '';
            if (matchedKeywords.length > 0) {
                formattedResults += `🔍 匹配到主题：${matchedKeywords.join('、')}\n\n`;
            }
            formattedResults += `📚 本地知识库搜索结果：\n\n${searchResults.map((item, index) => `${index + 1}. ${item}`).join('\n\n')}`;
            
            if (voiceoverMaterial) {
                voiceoverMaterial.value = formattedResults;
            }
            
            console.log('✅ 本地模拟搜索完成，找到', searchResults.length, '条结果');
            showNotification('📚 已提供本地知识库内容，API服务暂时不可用');
        }
        
        // 生成个性化建议
        function generatePersonalizedAdvice(topic) {
            const advice = [];
            
            // 根据主题长度和内容生成建议
            if (topic.length <= 4) {
                advice.push(`${topic}是一个很有价值的研究领域，建议深入了解其核心理念和实际应用`);
            } else {
                advice.push(`关于${topic}，建议从基础概念开始系统学习`);
            }
            
            // 根据主题类型提供专业建议
            if (topic.includes('技巧') || topic.includes('方法')) {
                advice.push('💡 实践出真知：理论学习结合实际操作，效果最佳');
                advice.push('📝 记录总结：每次实践后记录心得，形成自己的经验库');
                advice.push('🔄 持续优化：根据实际效果调整方法，找到最适合自己的方式');
            } else if (topic.includes('经验') || topic.includes('分享')) {
                advice.push('🎯 真实案例：结合具体案例分享，更有说服力');
                advice.push('📊 数据支撑：用数据说话，让分享更有分量');
                advice.push('💬 互动交流：鼓励观众留言分享自己的经验');
            } else {
                advice.push('📖 权威资料：查找相关领域的权威资料和最新研究');
                advice.push('🔍 案例分析：结合实际案例，让内容更具体生动');
                advice.push('👥 专家交流：与领域专家或有经验的人交流，获取一手信息');
            }
            
            return advice;
        }
        
        // 口播文案编辑模式切换
        function toggleVoiceoverEdit() {
            const editArea = document.getElementById('voiceoverEditArea');
            const previewArea = document.getElementById('voiceoverPreview');
            const editContent = document.getElementById('voiceoverEditContent');
            const previewContent = document.getElementById('voiceoverPreviewContent');
            
            if (editArea.style.display === 'none') {
                // 切换到编辑模式
                editContent.value = previewContent.textContent;
                editArea.style.display = 'block';
                previewArea.style.display = 'none';
            } else {
                // 切换到预览模式
                cancelVoiceoverEdit();
            }
        }
        
        // 保存口播文案编辑
        function saveVoiceoverEdit() {
            const editContent = document.getElementById('voiceoverEditContent');
            const previewContent = document.getElementById('voiceoverPreviewContent');
            const editArea = document.getElementById('voiceoverEditArea');
            const previewArea = document.getElementById('voiceoverPreview');
            
            previewContent.textContent = editContent.value;
            editArea.style.display = 'none';
            previewArea.style.display = 'block';
            
            // 同时更新markdown输出容器
            const markdownOutput = document.getElementById('voiceoverMarkdownOutput');
            if (markdownOutput) {
                markdownOutput.textContent = editContent.value;
            }
            
            showNotification('✅ 口播文案编辑已保存！');
        }
        
        // 取消口播文案编辑
        function cancelVoiceoverEdit() {
            const editArea = document.getElementById('voiceoverEditArea');
            const previewArea = document.getElementById('voiceoverPreview');
            
            editArea.style.display = 'none';
            previewArea.style.display = 'block';
        }
        
        // 复制口播文案内容
        function copyVoiceoverContent() {
            const previewContent = document.getElementById('voiceoverPreviewContent').textContent;
            
            if (!previewContent || previewContent.includes('请在左侧输入口播主题')) {
                alert('没有可复制的口播文案内容！');
                return;
            }
            
            navigator.clipboard.writeText(previewContent).then(() => {
                showNotification('✅ 口播文案已复制到剪贴板！');
            }).catch(err => {
                console.error('复制失败:', err);
                alert('复制失败，请手动选择复制');
            });
        }
        
        // 清空口播文案内容
        function clearVoiceoverContent() {
            const previewContent = document.getElementById('voiceoverPreviewContent');
            const editContent = document.getElementById('voiceoverEditContent');
            const markdownOutput = document.getElementById('voiceoverMarkdownOutput');
            
            if (confirm('确定要清空口播文案内容吗？')) {
                previewContent.textContent = '请在左侧输入口播主题和素材，点击"🤖 AI生成口播文案"按钮来创建您的短视频口播文案...';
                editContent.value = '';
                if (markdownOutput) {
                    markdownOutput.textContent = '';
                }
                showNotification('🗑️ 口播文案内容已清空');
            }
        }
        
        // 本地生成口播文案（API失败时的回退方案）
        function generateLocalVoiceover(topic, material) {
            let content = '';
            
            content = `🎬 大家好👋，今天想跟大家聊聊${topic}这个话题。

【停顿2秒】

${material ? `结合我自己的经验，我想分享一些实用的见解：

${material}

【停顿3秒】

` : '通过我的亲身实践，真的感受到了明显的改变。'}

【重音】${topic}【重音】对于我们每个人来说都非常重要，值得我们深入思考和实践。

【停顿3秒】

所以啊，如果你也对${topic}感兴趣，不妨深入了解一下。相信我，你一定会有所收获的！

【停顿】记得点赞关注，我们下期再见！👋`;
            
            return content;
        }
        
        // 清空口播助手表单
        function clearVoiceover() {
            document.getElementById('voiceoverDraftContent').value = '';
            showNotification('🗑️ 口播文案草稿已清空');
        }
        
        // 测试口播生成功能
        function testVoiceoverGeneration() {
            console.log('测试口播生成功能开始...');
            const draftContent = document.getElementById('voiceoverDraftContent').value.trim();
            console.log('草稿内容:', draftContent);
            
            if (!draftContent) {
                alert('请先输入一些基础内容或想法！');
                return;
            }
            
            // 直接显示测试内容
            const testContent = `🎬 测试口播文案生成成功！

【文案1-黄金3秒钩子+金字塔结构】
你知道吗？90%的人都不知道的${draftContent}秘密！
【停顿2秒】
今天我要告诉你3个关键步骤...

【文案2-SCQA模型】
场景：昨天有个朋友问我关于${draftContent}的问题
冲突：他试了很多方法都没效果
疑问：到底应该怎么做才对？
答案：其实只需要掌握这3个要点...

【文案3-魔性循环句式+数据轰炸】
你觉得${draftContent}很难？那是没算对方法！
对方法要钱？那是为了节省时间！
你觉得时间不值钱？那是你还没算清楚成本！

【文案4-五感法+画面植入】
视觉上，${draftContent}就像一幅美丽的画卷
听觉上，每个细节都在诉说着故事
触觉上，你能感受到真实的质感
嗅觉上，散发着独特的魅力

【文案5-角色代入+互动提问】
你是不是也在为${draftContent}而烦恼？
【停顿3秒】
别担心，今天我来教你3个简单步骤！
第一步是什么？评论区扣1我告诉你！`;
            
            const textarea = document.getElementById('voiceoverDraftContent');
            textarea.value = testContent;
            
            // 更新预览区域
            const previewContent = document.getElementById('voiceoverPreviewContent');
            if (previewContent) {
                previewContent.textContent = testContent;
            }
            
            // 更新markdown输出容器
            const markdownOutput = document.getElementById('voiceoverMarkdownOutput');
            if (markdownOutput) {
                markdownOutput.textContent = testContent;
            }
            
            showNotification('✅ 测试口播文案生成完成！');
            console.log('测试口播生成功能完成');
        }
        
        // 简单的测试函数 - 验证基本功能
        function simpleTest() {
            console.log('简单测试开始...');
            alert('简单测试：JavaScript正常工作！');
            
            // 检查元素是否存在
            const elements = {
                'voiceoverDraftContent': document.getElementById('voiceoverDraftContent'),
                'voiceoverPreviewContent': document.getElementById('voiceoverPreviewContent'),
                'voiceoverMarkdownOutput': document.getElementById('voiceoverMarkdownOutput')
            };
            
            let missingElements = [];
            for (let [name, element] of Object.entries(elements)) {
                if (!element) {
                    missingElements.push(name);
                }
            }
            
            if (missingElements.length > 0) {
                alert('缺少元素: ' + missingElements.join(', '));
            } else {
                alert('所有必要元素都存在！');
            }
            
            console.log('简单测试完成');
        }

        // AI生成口播文案
        async function generateVoiceoverWithAI() {
            console.log('AI生成口播文案函数被调用');
            
            try {
                const draftContent = document.getElementById('voiceoverDraftContent').value.trim();
                const previewContent = document.getElementById('voiceoverPreviewContent');
                
                console.log('草稿内容:', draftContent);
                
                if (!draftContent) {
                    alert('请先输入一些基础内容或想法！');
                    return;
                }
                
                // 显示加载状态
                showNotification('🤖 正在生成口播文案，请稍候...');
                previewContent.textContent = '正在生成口播文案，请稍候...';
                
                // 构建API请求内容
                const apiContent = `你是一名专业短视频口播文案策划专家，精通爆款文案结构设计与情绪调动技巧，擅长将专业知识转化为通俗易懂、具有传播力的口播内容。请你根据下面${draftContent}里的内容分析、提取、总结，将该草稿文案改写成适合口播的文案，口播的时长控制在2-3分钟，可以按照以下几种口播文案结构来进行创作，结构1：冲突前置+核心观点+分层论证+行动收尾的结构；结构2：场景（S）+冲突（C）+疑问（Q）+答案（A）；结构3：反常识对比+数据冲击+魔性结论结构；结构4：视觉+听觉+触觉+嗅觉+味觉，结构5：“你”视角+问题互动+步骤演示`;
                
                // 调用流式API，直接更新预览区域
                await callSiliconFlowAPI(apiContent, previewContent);
                
                showNotification('✅ 口播文案生成完成！');
                console.log('AI生成口播文案完成');
                
            } catch (error) {
                console.error('AI生成口播文案时出错:', error);
                alert('生成口播文案时出错，使用模拟生成作为替代！');
                showNotification('⚠️ 使用模拟生成作为替代');
                
                // 回退到模拟生成
                const draftContent = document.getElementById('voiceoverDraftContent').value.trim();
                const simulatedContent = simulateAIVoiceoverGeneration(draftContent);
                const previewContent = document.getElementById('voiceoverPreviewContent');
                if (previewContent) {
                    previewContent.textContent = simulatedContent;
                }
            }
        }
        
        // SiliconFlow API调用（流式响应）
        async function callSiliconFlowAPI(content, targetElement) {
            const apiUrl = 'https://api.siliconflow.cn/v1/chat/completions';
            const apiKey = 'sk-vsfobhidjfrliuiqfdxjpivantwjnxafxiayluiimudwyzhr';
            
            const requestBody = {
                model: "deepseek-ai/DeepSeek-V3.1",
                messages: [
                    {
                        role: "user",
                        content: content
                    }
                ],
                stream: true,
                max_tokens: 4000,
                temperature: 0.7,
                top_p: 0.7,
                frequency_penalty: 0.5
            };
            
            try {
                console.log('API请求配置:', {
                    url: apiUrl,
                    model: requestBody.model,
                    contentLength: content.length,
                    headers: {
                        'Authorization': `Bearer ${apiKey.substring(0, 10)}...`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                        'Accept': 'text/event-stream'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                console.log('API响应状态:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API错误详情:', errorText);
                    throw new Error(`API请求失败: ${response.status} ${response.statusText} - ${errorText}`);
                }
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';
                let fullContent = '';
                
                targetElement.textContent = ''; // 清空目标元素
                
                while (true) {
                    const { done, value } = await reader.read();
                    
                    if (done) {
                        break;
                    }
                    
                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n');
                    buffer = lines.pop() || '';
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = line.slice(6);
                            
                            if (data === '[DONE]') {
                                return fullContent;
                            }
                            
                            try {
                                const parsed = JSON.parse(data);
                                const content = parsed.choices?.[0]?.delta?.content || '';
                                
                                if (content) {
                                    fullContent += content;
                                    targetElement.textContent = fullContent;
                                    targetElement.scrollTop = targetElement.scrollHeight;
                                }
                            } catch (e) {
                                console.warn('解析流式数据失败:', e);
                            }
                        }
                    }
                }
                
                return fullContent;
                
            } catch (error) {
                console.error('SiliconFlow API调用失败:', error);
                throw error;
            }
        }
        
        // 模拟AI口播文案生成（回退方案）
        function simulateAIVoiceoverGeneration(content) {
            let generated = '';
            
            // 生成通用开场白
            generated = `🎬 大家好👋，今天想跟大家聊聊这个话题。\n\n【停顿2秒】\n\n`;
            
            // 处理原始内容
            const sentences = content.split(/[。！？]/g).filter(s => s.trim());
            sentences.forEach((sentence, index) => {
                if (sentence.trim()) {
                    generated += sentence.trim();
                    if (index < sentences.length - 1) {
                        generated += '。\n\n【停顿2秒】\n\n';
                    }
                }
            });
            
            // 生成通用结尾
            let ending = `\n\n【停顿3秒】\n\n大家觉得怎么样呢？欢迎在评论区分享你的想法💭\n\n【停顿2秒】\n\n如果你觉得这个内容对你有帮助，记得点赞关注，我们下期再见！👋`;
            
            generated += ending;
            return generated;
        }

        // AI编辑口播文案
        async function aiEditVoiceover() {
            const voiceoverDraftContent = document.getElementById('voiceoverDraftContent').value.trim();
            const voiceoverMaterial = document.getElementById('voiceoverMaterial');
            
            if (!voiceoverDraftContent) {
                alert('请先输入草稿文案！');
                return;
            }
            
            // 显示加载状态
            const originalMaterial = voiceoverMaterial.value;
            voiceoverMaterial.value = '🤖 正在AI编辑口播文案，请稍候...';
            voiceoverMaterial.disabled = true;
            
            try {
                // 构建AI编辑请求内容
                const apiContent = `你是一位短视频口播文案专家，擅长将普通文案转换为适合短视频口播的生动内容。请根据以下草稿文案，生成适合短视频口播的文案：

草稿文案：${voiceoverDraftContent}

要求：
1. 语言要口语化、自然流畅
2. 添加适当的停顿提示（如【停顿2秒】）
3. 添加重音提示（如【重音】关键词【重音】）
4. 添加情感表达和互动元素
5. 适合1-3分钟的短视频
6. 开头要有吸引力的开场白
7. 结尾要有互动引导和关注提醒

请生成完整的口播文案：`;
                
                // 调用AI API
                await callAIAPI(apiContent, voiceoverMaterial);
                
                // 将编辑后的内容也同步到草稿区
                document.getElementById('voiceoverDraftContent').value = voiceoverMaterial.value;
                
                showNotification('✨ AI口播文案编辑完成！');
                
            } catch (error) {
                console.error('AI编辑失败:', error);
                // 回退到本地模拟编辑
                const aiEditedContent = simulateAIVoiceoverEdit(voiceoverDraftContent);
                voiceoverMaterial.value = aiEditedContent;
                document.getElementById('voiceoverDraftContent').value = aiEditedContent;
                
                showNotification('✨ AI口播文案编辑完成！（使用模拟数据）');
            } finally {
                voiceoverMaterial.disabled = false;
            }
        }
        
        // 模拟AI口播文案编辑（回退方案）
        function simulateAIVoiceoverEdit(content) {
            let edited = content;
            
            // 添加开场白
            if (!edited.startsWith('🎬')) {
                edited = `🎬 大家好👋，今天想跟大家聊聊这个话题。\n\n【停顿2秒】\n\n${edited}`;
            }
            
            // 添加口语化表达
            edited = edited.replace(/我认为/g, '我觉得');
            edited = edited.replace(/非常重要/g, '【重音】超级重要【重音】');
            edited = edited.replace(/建议大家/g, '真心建议大家');
            edited = edited.replace(/希望能够/g, '希望咱们都能');
            
            // 添加停顿和互动
            edited = edited.replace(/。/g, '。\n\n【停顿2秒】');
            edited = edited.replace(/！/g, '！\n\n【停顿1秒】');
            
            // 添加结尾
            if (!edited.includes('关注')) {
                edited += `\n\n【停顿3秒】\n\n所以啊，如果你觉得这个内容对你有帮助，\n\n记得点赞关注，我们下期再见！👋`;
            }
            
            return edited;
        }

        // 实时渲染口播预览
        function renderVoiceoverPreview() {
            const draftContent = document.getElementById('voiceoverDraftContent').value.trim();
            const previewContent = document.getElementById('voiceoverPreviewContent');
            
            if (!draftContent) {
                previewContent.textContent = '请在左侧输入口播主题和素材，实时预览将在这里显示...';
                return;
            }
            
            // 智能实时渲染逻辑
            let renderedContent = draftContent;
            
            // 1. 基础格式化 - 处理Markdown语法
            renderedContent = renderedContent
                .replace(/^#\s+(.+)$/gm, '🎬 $1\n\n【停顿3秒】\n\n') // 标题转换为开场白格式
                .replace(/^##\s+(.+)$/gm, '【$1】\n\n') // 副标题
                .replace(/^###\s+(.+)$/gm, '▶ $1\n\n') // 三级标题
                .replace(/\*\*(.+?)\*\*/g, '【重音】$1【重音】') // 粗体转换为重音
                .replace(/\*(.+?)\*/g, '【强调】$1【强调】') // 斜体转换为强调
                .replace(/^-\s+(.+)$/gm, '• $1') // 列表项
                .replace(/^\d+\.\s+(.+)$/gm, '第$&个要点：$1') // 数字列表
                .replace(/\n{3,}/g, '\n\n【停顿2秒】\n\n'); // 多余空行转换为停顿
            
            // 2. 智能分段处理
            const sentences = renderedContent.split(/[。！？]/g);
            let processedContent = '';
            
            sentences.forEach((sentence, index) => {
                if (sentence.trim()) {
                    // 根据句子长度调整停顿时间
                    const pauseTime = sentence.length > 50 ? '3秒' : '2秒';
                    processedContent += sentence.trim();
                    
                    // 不是最后一句就添加停顿
                    if (index < sentences.length - 1) {
                        processedContent += `。\n\n【停顿${pauseTime}】\n\n`;
                    }
                }
            });
            
            renderedContent = processedContent;
            
            // 3. 情感表达增强
            if (renderedContent.includes('重要') || renderedContent.includes('关键')) {
                renderedContent = renderedContent.replace(/重要/g, '【重音】重要【重音】');
                renderedContent = renderedContent.replace(/关键/g, '【重音】关键【重音】');
            }
            
            if (renderedContent.includes('？')) {
                renderedContent = renderedContent.replace(/\?/g, '？【停顿1秒】');
            }
            
            // 4. 智能开场白
            if (!renderedContent.startsWith('🎬') && !renderedContent.startsWith('【')) {
                // 根据内容长度判断开场白类型
                const opening = draftContent.length > 200 ? 
                    `🎬 大家好👋，今天想跟大家分享一个很有意思的话题。\n\n【停顿3秒】\n\n` :
                    `🎬 哈喽大家好👋，今天想跟大家聊聊这个话题。\n\n【停顿2秒】\n\n`;
                renderedContent = opening + renderedContent;
            }
            
            // 5. 智能结尾
            if (!renderedContent.includes('点赞') && !renderedContent.includes('关注') && 
                !renderedContent.includes('评论') && !renderedContent.includes('分享')) {
                
                // 根据内容类型选择结尾风格
                let ending = '';
                if (renderedContent.includes('知识') || renderedContent.includes('经验')) {
                    ending = `\n\n【停顿3秒】\n\n以上就是今天想跟大家分享的知识和经验，\n\n如果你觉得对你有帮助，记得点赞收藏，我们下期再见！👋`;
                } else if (renderedContent.includes('生活') || renderedContent.includes('感悟')) {
                    ending = `\n\n【停顿3秒】\n\n生活就是这样，充满了各种可能，\n\n如果你也有类似的经历，欢迎在评论区分享，记得点赞关注哦！👋`;
                } else {
                    ending = `\n\n【停顿3秒】\n\n以上就是今天想跟大家分享的内容，\n\n如果你觉得有帮助，记得点赞关注，我们下期再见！👋`;
                }
                renderedContent += ending;
            }
            
            // 6. 设置预览内容并添加动画效果
            previewContent.textContent = renderedContent;
            
            // 添加淡入效果
            previewContent.style.opacity = '0.7';
            setTimeout(() => {
                previewContent.style.opacity = '1';
            }, 100);
            
            // 自动滚动到底部
            previewContent.scrollTop = previewContent.scrollHeight;
        }
        
        // 生成口播文案内容（最终生成）
        async function generateVoiceoverContent() {
            const voiceoverDraftContent = document.getElementById('voiceoverDraftContent').value.trim();
            const voiceoverMaterial = document.getElementById('voiceoverMaterial').value.trim();
            const topic = document.getElementById('voiceoverTopic').value.trim();
            
            if (!voiceoverDraftContent && !voiceoverMaterial) {
                alert('请先输入草稿文案或搜索素材！');
                return;
            }
            
            // 合并草稿和素材内容
            let finalContent = voiceoverDraftContent;
            if (voiceoverMaterial && voiceoverMaterial !== '🤖 正在AI编辑口播文案，请稍候...') {
                if (finalContent) {
                    finalContent += '\n\n' + voiceoverMaterial;
                } else {
                    finalContent = voiceoverMaterial;
                }
            }
            
            // 显示加载状态
            showNotification('🎬 正在生成最终口播文案...');
            
            try {
                // 构建最终优化请求
                const apiContent = `你是一位专业的短视频口播文案策划师，请根据以下内容生成最终的短视频口播文案：

主题：${topic || '生活分享'}
内容素材：${finalContent}

要求：
1. 生成1-3分钟的专业口播文案
2. 结构清晰：开场吸引→核心内容→互动引导→结尾关注
3. 语言自然口语化，适合口播
4. 添加适当的停顿和情感表达
5. 包含互动元素和关注引导
6. 适合小红书、抖音等平台风格

请直接生成完整的口播文案：`;
                
                // 临时存储最终内容
                let finalVoiceoverContent = '';
                const tempOutput = { 
                    value: '', 
                    disabled: false,
                    setAttribute: function() {},
                    getAttribute: function() { return ''; }
                };
                
                // 调用AI API生成最终内容
                await callAIAPI(apiContent, tempOutput);
                finalVoiceoverContent = tempOutput.value;
                
                // 将最终内容显示在素材区域
                document.getElementById('voiceoverMaterial').value = finalVoiceoverContent;
                
                showNotification('🎉 口播文案生成完成！');
                
            } catch (error) {
                console.error('最终生成失败:', error);
                // 回退到本地生成
                const finalContent = generateLocalFinalVoiceover(topic, finalContent);
                document.getElementById('voiceoverMaterial').value = finalContent;
                
                showNotification('🎉 口播文案生成完成！（使用本地优化）');
            }
        }
        
        // 本地生成最终口播文案（回退方案）
        function generateLocalFinalVoiceover(topic, content) {
            let finalContent = `🎬 大家好👋，今天想跟大家聊聊${topic || '生活分享'}这个话题。\n\n【停顿2秒】\n\n`;
            
            // 处理原始内容
            finalContent += content.replace(/\n/g, '\n\n【停顿2秒】\n\n');
            
            // 添加结尾
            finalContent += `\n\n【停顿3秒】\n\n所以啊，如果你觉得这个内容对你有帮助，记得点赞关注，我们下期再见！👋`;
            
            return finalContent;
        }
        
        // 口播文案功能（简化版本，移除编辑模式）
        let originalVoiceoverContent = '';

        // 导出图片（简化版本）
        function exportCard() {
            alert('导出功能需要额外的库支持，这里提供基础实现思路。\n\n实际项目中可以使用 html2canvas 等库来实现图片导出功能。');
        }

        // 复制功能相关函数
        function showCopyDialog() {
            const dialog = document.getElementById('copyDialog');
            const cardOptions = document.getElementById('cardOptions');
            
            // 获取当前编辑的内容
            const currentContent = getCurrentCardContent();
            const markdownContent = document.getElementById('markdownOutput').value;
            
            cardOptions.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; margin-bottom: 10px;">
                        <input type="checkbox" id="copyCurrent" checked style="margin-right: 8px;">
                        <span style="font-weight: 600;">复制当前编辑的卡片</span>
                    </label>
                    <div style="font-size: 12px; color: #666; margin-left: 24px; margin-bottom: 15px;">
                        ${currentContent.substring(0, 100)}${currentContent.length > 100 ? '...' : ''}
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; margin-bottom: 10px;">
                        <input type="checkbox" id="copyAllTemplates" style="margin-right: 8px;">
                        <span style="font-weight: 600;">复制所有模板卡片</span>
                    </label>
                </div>
                <div style="max-height: 150px; overflow-y: auto; border: 1px solid #e1e4e8; border-radius: 8px; padding: 10px;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;">可选：复制特定模板</div>
                    ${getTemplateOptions()}
                </div>
            `;
            
            // 添加事件监听
            document.getElementById('copyCurrent').addEventListener('change', function() {
                if (this.checked) {
                    document.getElementById('copyAllTemplates').checked = false;
                    document.querySelectorAll('.template-checkbox').forEach(cb => cb.checked = false);
                }
            });
            
            document.getElementById('copyAllTemplates').addEventListener('change', function() {
                if (this.checked) {
                    document.getElementById('copyCurrent').checked = false;
                    document.querySelectorAll('.template-checkbox').forEach(cb => cb.checked = true);
                }
            });
            
            dialog.style.display = 'block';
        }
        
        function getTemplateOptions() {
            const templates = [
                { id: 'knowledge', name: '小红书卡片' },
                { id: 'review', name: '五星好评' },
                { id: 'social', name: '朋友圈文案' },
                { id: 'marketing', name: '营销活动策划' },
                { id: 'video', name: '短视频脚本' },
                { id: 'live', name: '直播话术模板' },
                { id: 'recruit', name: '招聘信息' }
            ];
            
            return templates.map(template => `
                <label style="display: flex; align-items: center; margin-bottom: 6px; padding: 3px; border-radius: 4px; cursor: pointer;">
                    <input type="checkbox" class="template-checkbox" value="${template.id}" style="margin-right: 8px;">
                    <span style="font-size: 12px;">${template.name}</span>
                </label>
            `).join('');
        }
        
        function closeCopyDialog() {
            document.getElementById('copyDialog').style.display = 'none';
        }
        
        function copyCurrentCard() {
            const copyCurrent = document.getElementById('copyCurrent').checked;
            const copyAllTemplates = document.getElementById('copyAllTemplates').checked;
            const selectedTemplates = document.querySelectorAll('.template-checkbox:checked');
            
            let allContent = '';
            let cardCount = 0;
            
            if (copyCurrent) {
                // 复制当前内容
                const currentContent = getCurrentCardContent();
                if (currentContent.trim()) {
                    allContent += currentContent;
                    cardCount++;
                }
            }
            
            if (copyAllTemplates || selectedTemplates.length > 0) {
                // 复制模板内容
                const templatesToCopy = copyAllTemplates ? 
                    ['knowledge', 'review', 'social', 'marketing', 'video', 'live', 'recruit'] :
                    Array.from(selectedTemplates).map(cb => cb.value);
                
                templatesToCopy.forEach((templateId, index) => {
                    const templateContent = getCardContent(templateId);
                    if (templateContent.trim()) {
                        if (allContent) {
                            allContent += '\n\n' + '='.repeat(30) + '\n\n';
                        }
                        allContent += templateContent;
                        cardCount++;
                    }
                });
            }
            
            if (allContent.trim() === '') {
                alert('没有可复制的内容！');
                return;
            }
            
            // 复制到剪贴板
            navigator.clipboard.writeText(allContent).then(() => {
                showNotification(`已复制 ${cardCount} 个知识卡片！`);
                closeCopyDialog();
            }).catch(err => {
                // 降级方案
                const textArea = document.createElement('textarea');
                textArea.value = allContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification(`已复制 ${cardCount} 个知识卡片！`);
                closeCopyDialog();
            });
        }
        
        function getCurrentCardContent() {
            const title = document.getElementById('previewTitle').getAttribute('data-title') || '';
            const content = document.getElementById('markdownOutput').value || '';
            const footer = document.getElementById('previewFooter').getAttribute('data-tags') || '';
            
            let result = '';
            if (title.trim()) {
                result += title + '\n\n';
            }
            if (content.trim()) {
                result += content + '\n\n';
            }
            if (footer.trim()) {
                result += footer;
            }
            
            return result.trim();
        }
        
        function getCardContent(templateId) {
            const templates = {
                knowledge: {
                    title: '🌟 小红书卡片',
                    content: '🌟 今日分享\n\n在这个快节奏的时代，学会慢下来也是一种智慧。\n\n生活不是一场赛跑，而是一段旅程。享受过程，珍惜当下，才能收获真正的快乐。',
                    footer: '#生活感悟 #今日分享 #小红书卡片'
                },
                review: {
                    title: '⭐ 五星好评',
                    content: '⭐⭐⭐⭐⭐ 非常满意！\n\n产品质量超出预期，包装精美，物流速度快。客服态度也很好，有问必答。\n\n已经推荐给朋友了，下次还会回购！',
                    footer: '#五星好评 #购物分享 #推荐好物'
                },
                social: {
                    title: '🌈 朋友圈文案',
                    content: '🌈 生活记录\n\n今天的阳光刚刚好，微风不燥，心情也格外美丽。\n\n有时候，幸福就是这么简单：一杯咖啡，一本书，一个安静的午后。',
                    footer: '#朋友圈文案 #生活记录 #今日心情'
                },
                marketing: {
                    title: '🎯 营销活动策划',
                    content: '🎯 双十一活动策划方案\n\n主题：狂欢购物节，全场5折起\n时间：11月1日-11月11日\n亮点：满减优惠、限时秒杀、抽奖活动\n目标：销售额提升200%，新客增长50%',
                    footer: '#营销策划 #活动策划 #营销方案'
                },
                video: {
                    title: '🎬 短视频脚本',
                    content: '🎬 短视频脚本：30秒学会理财\n\n【开场5秒】\n"还在为钱不够用而烦恼吗？"\n\n【中间20秒】\n"今天教你3个简单理财技巧：\n1. 每月存收入的20%\n2. 学会记账，控制支出\n3. 投资自己，提升技能"\n\n【结尾5秒】\n"关注我，每天学点理财知识！"',
                    footer: '#短视频脚本 #内容创作 #理财知识'
                },
                live: {
                    title: '🎤 直播话术模板',
                    content: '🎤 直播开场话术\n\n"哈喽大家好，欢迎来到直播间！\n今天给大家带来超值好物，\n先点点关注不迷路，\n等会儿有惊喜福利哦！"\n\n【产品介绍】+【互动引导】+【促单话术】',
                    footer: '#直播话术 #直播技巧 #销售话术'
                },
                recruit: {
                    title: '🔥 招聘信息',
                    content: '🔥 招聘 | 新媒体运营专员\n\n【岗位职责】\n- 负责公司新媒体平台运营\n- 内容策划与文案撰写\n- 粉丝互动与数据分析\n\n【任职要求】\n- 本科及以上学历\n- 有新媒体运营经验优先\n- 创意思维活跃，执行力强',
                    footer: '#招聘信息 #新媒体运营 #职场招聘'
                }
            };
            
            const template = templates[templateId];
            if (template) {
                return `${template.title}\n\n${template.content}\n\n${template.footer}`;
            }
            return '';
        }

        // 事件监听
        document.addEventListener('DOMContentLoaded', function() {
            // 输入框实时更新 - 移除了不存在的title和footer元素监听

            // 模板切换
            document.querySelectorAll('.template-item').forEach(item => {
                item.addEventListener('click', function() {
                    // 移除所有active类
                    document.querySelectorAll('.template-item').forEach(i => i.classList.remove('active'));
                    // 添加active类到当前项
                    this.classList.add('active');
                    // 切换模板
                    switchTemplate(this.dataset.template);
                });
            });



            // 初始化预览
            updatePreview();
            
            // 好评文案事件监听
            // 监听好评文案表单变化（实时更新）
            const petName = document.getElementById('petName');
            const serviceProject = document.getElementById('serviceProject');
            const serviceExperience = document.getElementById('serviceExperience');
            const doctorName = document.getElementById('doctorName');
            const otherInfo = document.getElementById('otherInfo');
            const wordCount = document.getElementById('wordCount');
            
            // 移除自动触发的事件监听器，改为仅手动生成
            
            // Markdown输出框实时编辑监听
            const markdownOutput = document.getElementById('markdownOutput');
            if (markdownOutput) {
                markdownOutput.addEventListener('input', function() {
                    // 获取当前内容
                    const content = this.value;
                    
                    // 更新预览区域的标题、内容和标签
                    const titleElement = document.getElementById('previewTitle');
                    const contentElement = document.getElementById('previewContent');
                    const footerElement = document.getElementById('previewFooter');
                    
                    // 解析内容，提取标题、正文和标签
                    const lines = content.split('\n');
                    let title = '';
                    let mainContent = '';
                    let footer = '';
                    
                    for (let line of lines) {
                        line = line.trim();
                        if (!line) continue;
                        
                        // 提取标题（以#开头）
                        if (line.startsWith('#') && !title) {
                            title = line.replace(/^#+\s*/, '');
                            continue;
                        }
                        
                        // 提取标签（以#开头但不是标题）
                        if (line.includes('#') && !line.startsWith('#')) {
                            const tags = line.match(/#\w+/g);
                            if (tags) {
                                footer = line;
                                continue;
                            }
                        }
                        
                        // 其他内容作为正文
                        if (!line.startsWith('#')) {
                            mainContent += line + '\n';
                        }
                    }
                    
                    // 更新标题
                    if (title.trim()) {
                        titleElement.innerHTML = marked.parse(title);
                        titleElement.style.display = 'block';
                        titleElement.setAttribute('data-title', title);
                    } else {
                        titleElement.style.display = 'none';
                        titleElement.setAttribute('data-title', '');
                    }
                    
                    // 更新内容
                    if (mainContent.trim()) {
                        contentElement.innerHTML = marked.parse(mainContent.trim());
                        contentElement.style.display = 'block';
                    } else {
                        contentElement.style.display = 'none';
                    }
                    
                    // 更新底部标签
                    if (footer.trim()) {
                        footerElement.innerHTML = marked.parse(footer);
                        footerElement.style.display = 'block';
                        footerElement.setAttribute('data-tags', footer);
                    } else {
                        footerElement.style.display = 'none';
                        footerElement.setAttribute('data-tags', '');
                    }
                });
            }
        });
    </script>
</body>
</html>